import e from"helmet";import t from"express";import r from"compression";import n from"cors";import i from"express-fileupload";import o from"url";import s from"lodash";import a from"fs";import u from"util";import c from"crypto";import l from"chokidar";import f from"buffer";import h from"stream";import*as p from"uuid";import v from"http";import d from"https";import m from"path";import y from"cluster";import{Server as g}from"socket.io";import E from"os";import{EventEmitter as w}from"events";import b from"cluster-messages";import S from"log4js";import{pathToRegexp as R}from"path-to-regexp";import I from"moment";import{FQLParser as A,KnexParser as P}from"@landra_sistemas/fql-parser";import $ from"knex";import O from"net";import N from"repl";import T from"yargs/yargs";import{hideBin as j}from"yargs/helpers";function L(){return L=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},L.apply(this,arguments)}function x(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,k(e,t)}function k(e,t){return k=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},k(e,t)}function D(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function _(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(r)return(r=r.call(e)).next.bind(r);if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return D(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?D(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0;return function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var C=/*#__PURE__*/function(){function e(){}return e.arrayToLower=function(e){return e.join("~").toLowerCase().split("~")},e.replaceAll=function(e,t,r){return e.replace(new RegExp(t.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&"),"g"),r)},e.encrypt=function(e){var t=Buffer.from(process.env.CRYPT_SECRET,"hex"),r=Buffer.from(process.env.CRYPT_IV,"hex"),n=c.createCipheriv("aes-256-cbc",t,r),i=n.update(e);return(i=Buffer.concat([i,n.final()])).toString("hex")},e.decrypt=function(e){var t=Buffer.from(process.env.CRYPT_SECRET,"hex"),r=Buffer.from(process.env.CRYPT_IV,"hex"),n=Buffer.from(e,"hex"),i=c.createDecipheriv("aes-256-cbc",t,r),o=i.update(n);return(o=Buffer.concat([o,i.final()])).toString()},e.sleep=function(e){return u.promisify(setTimeout)(e)},e.generateKeys=function(){return{key:c.randomBytes(32).toString("hex"),iv:c.randomBytes(16).toString("hex")}},e.flattenObject=function(t){var r,n={};for(var i in t)if(t.hasOwnProperty(i))if(t[i]&&Array===t[i].constructor)n[i]=t[i];else if("object"==typeof t[i])for(var o in r=e.flattenObject(t[i]))r.hasOwnProperty(o)&&(r[o]&&Array===r.constructor||(n[i+(isNaN(o)?"."+o:"")]=r[o]));else n[i]=t[i];return n},e.unflatten=function(e){var t={};for(var r in e){var n=r.split(".");n.reduce(function(t,i,o){return t[i]||(t[i]=isNaN(Number(n[o+1]))?n.length-1==o?e[r]:{}:[])},t)}return t},e.expressHandler=function(){return function(e){return function(){var t=[].slice.call(arguments),r=e.apply(void 0,t),n=t[t.length-1];return Promise.resolve(r).catch(function(e){return n(e)})}}},e}(),F=/*#__PURE__*/function(){function e(e){this.watcher={},this.disableWatchers=e}var t=e.prototype;return t.load=function(e){try{var t=this,r=e||process.env.DEFAULT_LANG;t.currentData||(t.currentData={}),t.currentDataFlat||(t.currentDataFlat={});var n=process.cwd()+"/i18n/lang_"+r+".json";return t.disableWatchers||(t.watcher[r]=l.watch(n,{ignored:/(^|[/\\])\../,persistent:!0}),t.watcher[r].on("change",function(e){return t.loadFile(e,r)})),Promise.resolve(t.loadFile(n,r)).then(function(){})}catch(e){return Promise.reject(e)}},t.loadFile=function(e,t){try{var r=this,n=u.promisify(a.readFile);return Promise.resolve(function(i,o){try{var s=Promise.resolve(n(e,"utf8")).then(function(e){var n=JSON.parse(e);r.currentDataFlat[t]=C.flattenObject(n),r.currentData[t]=n})}catch(e){return o(e)}return s&&s.then?s.then(void 0,o):s}(0,function(e){if("ENOENT"===(null==e?void 0:e.code))return console.log("Lang file does not exist. Create it on ./i18n/lang_{xx}.json");console.error(e)}))}catch(e){return Promise.reject(e)}},t.translate=function(e,t){try{var r,n=function(t){return r?t:"undefined."+e},i=this;if(t||(t=process.env.DEFAULT_LANG),i.currentDataFlat&&i.currentDataFlat[t]&&i.currentDataFlat[t][e])return Promise.resolve(i.currentData[t][e]);var o=function(){if(!i.currentDataFlat||!i.currentDataFlat[t])return Promise.resolve(i.load(t)).then(function(){if(i.currentDataFlat&&i.currentDataFlat[t]&&i.currentDataFlat[e])return r=1,i.currentDataFlat[t][e]})}();return Promise.resolve(o&&o.then?o.then(n):n(o))}catch(e){return Promise.reject(e)}},e}(),G=/*#__PURE__*/function(){function e(e,t,r,n){this.data=t,this.success=e,this.total=n,this.message=r||""}return e.prototype.toJson=function(){return this},e}();function B(e){var t={exports:{}};return e(t,t.exports),t.exports}var M=B(function(e,t){var r=f.Buffer;function n(e,t){for(var r in e)t[r]=e[r]}function i(e,t,n){return r(e,t,n)}r.from&&r.alloc&&r.allocUnsafe&&r.allocUnsafeSlow?e.exports=f:(n(f,t),t.Buffer=i),n(r,i),i.from=function(e,t,n){if("number"==typeof e)throw new TypeError("Argument must not be a number");return r(e,t,n)},i.alloc=function(e,t,n){if("number"!=typeof e)throw new TypeError("Argument must be a number");var i=r(e);return void 0!==t?"string"==typeof n?i.fill(t,n):i.fill(t):i.fill(0),i},i.allocUnsafe=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return r(e)},i.allocUnsafeSlow=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return f.SlowBuffer(e)}}),U=M.Buffer;function K(e){if(this.buffer=null,this.writable=!0,this.readable=!0,!e)return this.buffer=U.alloc(0),this;if("function"==typeof e.pipe)return this.buffer=U.alloc(0),e.pipe(this),this;if(e.length||"object"==typeof e)return this.buffer=e,this.writable=!1,process.nextTick(function(){this.emit("end",e),this.readable=!1,this.emit("close")}.bind(this)),this;throw new TypeError("Unexpected data type ("+typeof e+")")}u.inherits(K,h),K.prototype.write=function(e){this.buffer=U.concat([this.buffer,U.from(e)]),this.emit("data",e)},K.prototype.end=function(e){e&&this.write(e),this.emit("end",e),this.emit("close"),this.writable=!1,this.readable=!1};var H=K,V=f.Buffer,X=f.SlowBuffer,z=J;function J(e,t){if(!V.isBuffer(e)||!V.isBuffer(t))return!1;if(e.length!==t.length)return!1;for(var r=0,n=0;n<e.length;n++)r|=e[n]^t[n];return 0===r}J.install=function(){V.prototype.equal=X.prototype.equal=function(e){return J(this,e)}};var W=V.prototype.equal,q=X.prototype.equal;function Y(e){return(e/8|0)+(e%8==0?0:1)}J.restore=function(){V.prototype.equal=W,X.prototype.equal=q};var Z={ES256:Y(256),ES384:Y(384),ES512:Y(521)},Q=function(e){var t=Z[e];if(t)return t;throw new Error('Unknown algorithm "'+e+'"')},ee=M.Buffer;function te(e){if(ee.isBuffer(e))return e;if("string"==typeof e)return ee.from(e,"base64");throw new TypeError("ECDSA signature must be a Base64 string or a Buffer")}function re(e,t,r){for(var n=0;t+n<r&&0===e[t+n];)++n;return e[t+n]>=128&&--n,n}var ne=function(e,t){e=te(e);var r=Q(t),n=r+1,i=e.length,o=0;if(48!==e[o++])throw new Error('Could not find expected "seq"');var s=e[o++];if(129===s&&(s=e[o++]),i-o<s)throw new Error('"seq" specified length of "'+s+'", only "'+(i-o)+'" remaining');if(2!==e[o++])throw new Error('Could not find expected "int" for "r"');var a=e[o++];if(i-o-2<a)throw new Error('"r" specified length of "'+a+'", only "'+(i-o-2)+'" available');if(n<a)throw new Error('"r" specified length of "'+a+'", max of "'+n+'" is acceptable');var u=o;if(o+=a,2!==e[o++])throw new Error('Could not find expected "int" for "s"');var c=e[o++];if(i-o!==c)throw new Error('"s" specified length of "'+c+'", expected "'+(i-o)+'"');if(n<c)throw new Error('"s" specified length of "'+c+'", max of "'+n+'" is acceptable');var l=o;if((o+=c)!==i)throw new Error('Expected to consume entire buffer, but "'+(i-o)+'" bytes remain');var f=r-a,h=r-c,p=ee.allocUnsafe(f+a+h+c);for(o=0;o<f;++o)p[o]=0;e.copy(p,o,u+Math.max(-f,0),u+a);for(var v=o=r;o<v+h;++o)p[o]=0;return e.copy(p,o,l+Math.max(-h,0),l+c),(p=p.toString("base64")).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")},ie=M.Buffer,oe="secret must be a string or buffer",se="key must be a string or a buffer",ae="function"==typeof c.createPublicKey;function ue(e){if(!ie.isBuffer(e)&&"string"!=typeof e){if(!ae)throw he(se);if("object"!=typeof e)throw he(se);if("string"!=typeof e.type)throw he(se);if("string"!=typeof e.asymmetricKeyType)throw he(se);if("function"!=typeof e.export)throw he(se)}}function ce(e){if(!ie.isBuffer(e)&&"string"!=typeof e&&"object"!=typeof e)throw he("key must be a string, a buffer or an object")}function le(e){return e.replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function fe(e){var t=4-(e=e.toString()).length%4;if(4!==t)for(var r=0;r<t;++r)e+="=";return e.replace(/\-/g,"+").replace(/_/g,"/")}function he(e){var t=[].slice.call(arguments,1),r=u.format.bind(u,e).apply(null,t);return new TypeError(r)}function pe(e){var t;return ie.isBuffer(t=e)||"string"==typeof t||(e=JSON.stringify(e)),e}function ve(e){return function(t,r){!function(e){if(!ie.isBuffer(e)){if("string"==typeof e)return e;if(!ae)throw he(oe);if("object"!=typeof e)throw he(oe);if("secret"!==e.type)throw he(oe);if("function"!=typeof e.export)throw he(oe)}}(r),t=pe(t);var n=c.createHmac("sha"+e,r);return le((n.update(t),n.digest("base64")))}}function de(e){return function(t,r,n){var i=ve(e)(t,n);return z(ie.from(r),ie.from(i))}}function me(e){return function(t,r){ce(r),t=pe(t);var n=c.createSign("RSA-SHA"+e);return le((n.update(t),n.sign(r,"base64")))}}function ye(e){return function(t,r,n){ue(n),t=pe(t),r=fe(r);var i=c.createVerify("RSA-SHA"+e);return i.update(t),i.verify(n,r,"base64")}}function ge(e){return function(t,r){ce(r),t=pe(t);var n=c.createSign("RSA-SHA"+e);return le((n.update(t),n.sign({key:r,padding:c.constants.RSA_PKCS1_PSS_PADDING,saltLength:c.constants.RSA_PSS_SALTLEN_DIGEST},"base64")))}}function Ee(e){return function(t,r,n){ue(n),t=pe(t),r=fe(r);var i=c.createVerify("RSA-SHA"+e);return i.update(t),i.verify({key:n,padding:c.constants.RSA_PKCS1_PSS_PADDING,saltLength:c.constants.RSA_PSS_SALTLEN_DIGEST},r,"base64")}}function we(e){var t=me(e);return function(){var r=t.apply(null,arguments);return ne(r,"ES"+e)}}function be(e){var t=ye(e);return function(r,n,i){return n=function(e,t){e=te(e);var r=Q(t),n=e.length;if(n!==2*r)throw new TypeError('"'+t+'" signatures must be "'+2*r+'" bytes, saw "'+n+'"');var i=re(e,0,r),o=re(e,r,e.length),s=r-i,a=r-o,u=2+s+1+1+a,c=u<128,l=ee.allocUnsafe((c?2:3)+u),f=0;return l[f++]=48,c?l[f++]=u:(l[f++]=129,l[f++]=255&u),l[f++]=2,l[f++]=s,i<0?(l[f++]=0,f+=e.copy(l,f,0,r)):f+=e.copy(l,f,i,r),l[f++]=2,l[f++]=a,o<0?(l[f++]=0,e.copy(l,f,r)):e.copy(l,f,r+o),l}(n,"ES"+e).toString("base64"),t(r,n,i)}}function Se(){return function(){return""}}function Re(){return function(e,t){return""===t}}ae&&(se+=" or a KeyObject",oe+="or a KeyObject");var Ie=function(e){var t={hs:ve,rs:me,ps:ge,es:we,none:Se},r={hs:de,rs:ye,ps:Ee,es:be,none:Re},n=e.match(/^(RS|PS|ES|HS)(256|384|512)$|^(none)$/i);if(!n)throw he('"%s" is not a valid algorithm.\n  Supported algorithms are:\n  "HS256", "HS384", "HS512", "RS256", "RS384", "RS512", "PS256", "PS384", "PS512", "ES256", "ES384", "ES512" and "none".',e);var i=(n[1]||n[3]).toLowerCase(),o=n[2];return{sign:t[i](o),verify:r[i](o)}},Ae=f.Buffer,Pe=function(e){return"string"==typeof e?e:"number"==typeof e||Ae.isBuffer(e)?e.toString():JSON.stringify(e)},$e=M.Buffer;function Oe(e,t){return $e.from(e,t).toString("base64").replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function Ne(e){var t=e.header,r=e.payload,n=e.secret||e.privateKey,i=e.encoding,o=Ie(t.alg),s=function(e,t,r){r=r||"utf8";var n=Oe(Pe(e),"binary"),i=Oe(Pe(t),r);return u.format("%s.%s",n,i)}(t,r,i),a=o.sign(s,n);return u.format("%s.%s",s,a)}function Te(e){var t=new H(e.secret||e.privateKey||e.key);this.readable=!0,this.header=e.header,this.encoding=e.encoding,this.secret=this.privateKey=this.key=t,this.payload=new H(e.payload),this.secret.once("close",function(){!this.payload.writable&&this.readable&&this.sign()}.bind(this)),this.payload.once("close",function(){!this.secret.writable&&this.readable&&this.sign()}.bind(this))}u.inherits(Te,h),Te.prototype.sign=function(){try{var e=Ne({header:this.header,payload:this.payload.buffer,secret:this.secret.buffer,encoding:this.encoding});return this.emit("done",e),this.emit("data",e),this.emit("end"),this.readable=!1,e}catch(e){this.readable=!1,this.emit("error",e),this.emit("close")}},Te.sign=Ne;var je=Te,Le=M.Buffer,xe=/^[a-zA-Z0-9\-_]+?\.[a-zA-Z0-9\-_]+?\.([a-zA-Z0-9\-_]+)?$/;function ke(e){var t=e.split(".",1)[0];return function(e){if(function(e){return"[object Object]"===Object.prototype.toString.call(e)}(e))return e;try{return JSON.parse(e)}catch(e){return}}(Le.from(t,"base64").toString("binary"))}function De(e){return e.split(".")[2]}function _e(e){return xe.test(e)&&!!ke(e)}function Ce(e,t,r){if(!t){var n=new Error("Missing algorithm parameter for jws.verify");throw n.code="MISSING_ALGORITHM",n}var i=De(e=Pe(e)),o=function(e){return e.split(".",2).join(".")}(e);return Ie(t).verify(o,i,r)}function Fe(e,t){if(t=t||{},!_e(e=Pe(e)))return null;var r=ke(e);if(!r)return null;var n=function(e,t){t=t||"utf8";var r=e.split(".")[1];return Le.from(r,"base64").toString(t)}(e);return("JWT"===r.typ||t.json)&&(n=JSON.parse(n,t.encoding)),{header:r,payload:n,signature:De(e)}}function Ge(e){var t=new H((e=e||{}).secret||e.publicKey||e.key);this.readable=!0,this.algorithm=e.algorithm,this.encoding=e.encoding,this.secret=this.publicKey=this.key=t,this.signature=new H(e.signature),this.secret.once("close",function(){!this.signature.writable&&this.readable&&this.verify()}.bind(this)),this.signature.once("close",function(){!this.secret.writable&&this.readable&&this.verify()}.bind(this))}u.inherits(Ge,h),Ge.prototype.verify=function(){try{var e=Ce(this.signature.buffer,this.algorithm,this.key.buffer),t=Fe(this.signature.buffer,this.encoding);return this.emit("done",e,t),this.emit("data",e),this.emit("end"),this.readable=!1,e}catch(e){this.readable=!1,this.emit("error",e),this.emit("close")}},Ge.decode=Fe,Ge.isValid=_e,Ge.verify=Ce;var Be=Ge,Me={ALGORITHMS:["HS256","HS384","HS512","RS256","RS384","RS512","PS256","PS384","PS512","ES256","ES384","ES512"],sign:je.sign,verify:Be.verify,decode:Be.decode,isValid:Be.isValid,createSign:function(e){return new je(e)},createVerify:function(e){return new Be(e)}},Ue=function(e,t){Error.call(this,e),Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor),this.name="JsonWebTokenError",this.message=e,t&&(this.inner=t)};(Ue.prototype=Object.create(Error.prototype)).constructor=Ue;var Ke=Ue,He=function(e,t){Ke.call(this,e),this.name="NotBeforeError",this.date=t};(He.prototype=Object.create(Ke.prototype)).constructor=He;var Ve=He,Xe=function(e,t){Ke.call(this,e),this.name="TokenExpiredError",this.expiredAt=t};(Xe.prototype=Object.create(Ke.prototype)).constructor=Xe;var ze=Xe,Je=1e3,We=60*Je,qe=60*We,Ye=24*qe;function Ze(e,t,r,n){var i=t>=1.5*r;return Math.round(e/r)+" "+n+(i?"s":"")}var Qe=function(e,t){var r=t||Math.floor(Date.now()/1e3);if("string"==typeof e){var n=function(e,t){t=t||{};var r,n,i=typeof e;if("string"===i&&e.length>0)return function(e){if(!((e=String(e)).length>100)){var t=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(t){var r=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*r;case"weeks":case"week":case"w":return 6048e5*r;case"days":case"day":case"d":return r*Ye;case"hours":case"hour":case"hrs":case"hr":case"h":return r*qe;case"minutes":case"minute":case"mins":case"min":case"m":return r*We;case"seconds":case"second":case"secs":case"sec":case"s":return r*Je;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return r;default:return}}}}(e);if("number"===i&&isFinite(e))return t.long?(r=e,(n=Math.abs(r))>=Ye?Ze(r,n,Ye,"day"):n>=qe?Ze(r,n,qe,"hour"):n>=We?Ze(r,n,We,"minute"):n>=Je?Ze(r,n,Je,"second"):r+" ms"):function(e){var t=Math.abs(e);return t>=Ye?Math.round(e/Ye)+"d":t>=qe?Math.round(e/qe)+"h":t>=We?Math.round(e/We)+"m":t>=Je?Math.round(e/Je)+"s":e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}(e);if(void 0===n)return;return Math.floor(r+n/1e3)}return"number"==typeof e?r+e:void 0},et={MAX_LENGTH:256,MAX_SAFE_COMPONENT_LENGTH:16,MAX_SAFE_BUILD_LENGTH:250,MAX_SAFE_INTEGER:Number.MAX_SAFE_INTEGER||9007199254740991,RELEASE_TYPES:["major","premajor","minor","preminor","patch","prepatch","prerelease"],SEMVER_SPEC_VERSION:"2.0.0",FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2},tt="object"==typeof process&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG)?(...e)=>console.error("SEMVER",...e):()=>{},rt=B(function(e,t){const{MAX_SAFE_COMPONENT_LENGTH:r,MAX_SAFE_BUILD_LENGTH:n,MAX_LENGTH:i}=et,o=(t=e.exports={}).re=[],s=t.safeRe=[],a=t.src=[],u=t.t={};let c=0;const l=[["\\s",1],["\\d",i],["[a-zA-Z0-9-]",n]],f=(e,t,r)=>{const n=(e=>{for(const[t,r]of l)e=e.split(`${t}*`).join(`${t}{0,${r}}`).split(`${t}+`).join(`${t}{1,${r}}`);return e})(t),i=c++;tt(e,i,t),u[e]=i,a[i]=t,o[i]=new RegExp(t,r?"g":void 0),s[i]=new RegExp(n,r?"g":void 0)};f("NUMERICIDENTIFIER","0|[1-9]\\d*"),f("NUMERICIDENTIFIERLOOSE","\\d+"),f("NONNUMERICIDENTIFIER","\\d*[a-zA-Z-][a-zA-Z0-9-]*"),f("MAINVERSION",`(${a[u.NUMERICIDENTIFIER]})\\.(${a[u.NUMERICIDENTIFIER]})\\.(${a[u.NUMERICIDENTIFIER]})`),f("MAINVERSIONLOOSE",`(${a[u.NUMERICIDENTIFIERLOOSE]})\\.(${a[u.NUMERICIDENTIFIERLOOSE]})\\.(${a[u.NUMERICIDENTIFIERLOOSE]})`),f("PRERELEASEIDENTIFIER",`(?:${a[u.NUMERICIDENTIFIER]}|${a[u.NONNUMERICIDENTIFIER]})`),f("PRERELEASEIDENTIFIERLOOSE",`(?:${a[u.NUMERICIDENTIFIERLOOSE]}|${a[u.NONNUMERICIDENTIFIER]})`),f("PRERELEASE",`(?:-(${a[u.PRERELEASEIDENTIFIER]}(?:\\.${a[u.PRERELEASEIDENTIFIER]})*))`),f("PRERELEASELOOSE",`(?:-?(${a[u.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${a[u.PRERELEASEIDENTIFIERLOOSE]})*))`),f("BUILDIDENTIFIER","[a-zA-Z0-9-]+"),f("BUILD",`(?:\\+(${a[u.BUILDIDENTIFIER]}(?:\\.${a[u.BUILDIDENTIFIER]})*))`),f("FULLPLAIN",`v?${a[u.MAINVERSION]}${a[u.PRERELEASE]}?${a[u.BUILD]}?`),f("FULL",`^${a[u.FULLPLAIN]}$`),f("LOOSEPLAIN",`[v=\\s]*${a[u.MAINVERSIONLOOSE]}${a[u.PRERELEASELOOSE]}?${a[u.BUILD]}?`),f("LOOSE",`^${a[u.LOOSEPLAIN]}$`),f("GTLT","((?:<|>)?=?)"),f("XRANGEIDENTIFIERLOOSE",`${a[u.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`),f("XRANGEIDENTIFIER",`${a[u.NUMERICIDENTIFIER]}|x|X|\\*`),f("XRANGEPLAIN",`[v=\\s]*(${a[u.XRANGEIDENTIFIER]})(?:\\.(${a[u.XRANGEIDENTIFIER]})(?:\\.(${a[u.XRANGEIDENTIFIER]})(?:${a[u.PRERELEASE]})?${a[u.BUILD]}?)?)?`),f("XRANGEPLAINLOOSE",`[v=\\s]*(${a[u.XRANGEIDENTIFIERLOOSE]})(?:\\.(${a[u.XRANGEIDENTIFIERLOOSE]})(?:\\.(${a[u.XRANGEIDENTIFIERLOOSE]})(?:${a[u.PRERELEASELOOSE]})?${a[u.BUILD]}?)?)?`),f("XRANGE",`^${a[u.GTLT]}\\s*${a[u.XRANGEPLAIN]}$`),f("XRANGELOOSE",`^${a[u.GTLT]}\\s*${a[u.XRANGEPLAINLOOSE]}$`),f("COERCE",`(^|[^\\d])(\\d{1,${r}})(?:\\.(\\d{1,${r}}))?(?:\\.(\\d{1,${r}}))?(?:$|[^\\d])`),f("COERCERTL",a[u.COERCE],!0),f("LONETILDE","(?:~>?)"),f("TILDETRIM",`(\\s*)${a[u.LONETILDE]}\\s+`,!0),t.tildeTrimReplace="$1~",f("TILDE",`^${a[u.LONETILDE]}${a[u.XRANGEPLAIN]}$`),f("TILDELOOSE",`^${a[u.LONETILDE]}${a[u.XRANGEPLAINLOOSE]}$`),f("LONECARET","(?:\\^)"),f("CARETTRIM",`(\\s*)${a[u.LONECARET]}\\s+`,!0),t.caretTrimReplace="$1^",f("CARET",`^${a[u.LONECARET]}${a[u.XRANGEPLAIN]}$`),f("CARETLOOSE",`^${a[u.LONECARET]}${a[u.XRANGEPLAINLOOSE]}$`),f("COMPARATORLOOSE",`^${a[u.GTLT]}\\s*(${a[u.LOOSEPLAIN]})$|^$`),f("COMPARATOR",`^${a[u.GTLT]}\\s*(${a[u.FULLPLAIN]})$|^$`),f("COMPARATORTRIM",`(\\s*)${a[u.GTLT]}\\s*(${a[u.LOOSEPLAIN]}|${a[u.XRANGEPLAIN]})`,!0),t.comparatorTrimReplace="$1$2$3",f("HYPHENRANGE",`^\\s*(${a[u.XRANGEPLAIN]})\\s+-\\s+(${a[u.XRANGEPLAIN]})\\s*$`),f("HYPHENRANGELOOSE",`^\\s*(${a[u.XRANGEPLAINLOOSE]})\\s+-\\s+(${a[u.XRANGEPLAINLOOSE]})\\s*$`),f("STAR","(<|>)?=?\\s*\\*"),f("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$"),f("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")});const nt=Object.freeze({loose:!0}),it=Object.freeze({});var ot=e=>e?"object"!=typeof e?nt:e:it;const st=/^[0-9]+$/,at=(e,t)=>{const r=st.test(e),n=st.test(t);return r&&n&&(e=+e,t=+t),e===t?0:r&&!n?-1:n&&!r?1:e<t?-1:1};var ut={compareIdentifiers:at,rcompareIdentifiers:(e,t)=>at(t,e)};const{MAX_LENGTH:ct,MAX_SAFE_INTEGER:lt}=et,{safeRe:ft,t:ht}=rt,{compareIdentifiers:pt}=ut;class vt{constructor(e,t){if(t=ot(t),e instanceof vt){if(e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease)return e;e=e.version}else if("string"!=typeof e)throw new TypeError(`Invalid version. Must be a string. Got type "${typeof e}".`);if(e.length>ct)throw new TypeError(`version is longer than ${ct} characters`);tt("SemVer",e,t),this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease;const r=e.trim().match(t.loose?ft[ht.LOOSE]:ft[ht.FULL]);if(!r)throw new TypeError(`Invalid Version: ${e}`);if(this.raw=e,this.major=+r[1],this.minor=+r[2],this.patch=+r[3],this.major>lt||this.major<0)throw new TypeError("Invalid major version");if(this.minor>lt||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>lt||this.patch<0)throw new TypeError("Invalid patch version");this.prerelease=r[4]?r[4].split(".").map(e=>{if(/^[0-9]+$/.test(e)){const t=+e;if(t>=0&&t<lt)return t}return e}):[],this.build=r[5]?r[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(e){if(tt("SemVer.compare",this.version,this.options,e),!(e instanceof vt)){if("string"==typeof e&&e===this.version)return 0;e=new vt(e,this.options)}return e.version===this.version?0:this.compareMain(e)||this.comparePre(e)}compareMain(e){return e instanceof vt||(e=new vt(e,this.options)),pt(this.major,e.major)||pt(this.minor,e.minor)||pt(this.patch,e.patch)}comparePre(e){if(e instanceof vt||(e=new vt(e,this.options)),this.prerelease.length&&!e.prerelease.length)return-1;if(!this.prerelease.length&&e.prerelease.length)return 1;if(!this.prerelease.length&&!e.prerelease.length)return 0;let t=0;do{const r=this.prerelease[t],n=e.prerelease[t];if(tt("prerelease compare",t,r,n),void 0===r&&void 0===n)return 0;if(void 0===n)return 1;if(void 0===r)return-1;if(r!==n)return pt(r,n)}while(++t)}compareBuild(e){e instanceof vt||(e=new vt(e,this.options));let t=0;do{const r=this.build[t],n=e.build[t];if(tt("prerelease compare",t,r,n),void 0===r&&void 0===n)return 0;if(void 0===n)return 1;if(void 0===r)return-1;if(r!==n)return pt(r,n)}while(++t)}inc(e,t,r){switch(e){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",t,r);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",t,r);break;case"prepatch":this.prerelease.length=0,this.inc("patch",t,r),this.inc("pre",t,r);break;case"prerelease":0===this.prerelease.length&&this.inc("patch",t,r),this.inc("pre",t,r);break;case"major":0===this.minor&&0===this.patch&&0!==this.prerelease.length||this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":0===this.patch&&0!==this.prerelease.length||this.minor++,this.patch=0,this.prerelease=[];break;case"patch":0===this.prerelease.length&&this.patch++,this.prerelease=[];break;case"pre":{const e=Number(r)?1:0;if(!t&&!1===r)throw new Error("invalid increment argument: identifier is empty");if(0===this.prerelease.length)this.prerelease=[e];else{let n=this.prerelease.length;for(;--n>=0;)"number"==typeof this.prerelease[n]&&(this.prerelease[n]++,n=-2);if(-1===n){if(t===this.prerelease.join(".")&&!1===r)throw new Error("invalid increment argument: identifier already exists");this.prerelease.push(e)}}if(t){let n=[t,e];!1===r&&(n=[t]),0===pt(this.prerelease[0],t)?isNaN(this.prerelease[1])&&(this.prerelease=n):this.prerelease=n}break}default:throw new Error(`invalid increment argument: ${e}`)}return this.raw=this.format(),this.build.length&&(this.raw+=`+${this.build.join(".")}`),this}}var dt=vt,mt=(e,t,r)=>new dt(e,r).compare(new dt(t,r)),yt=(e,t,r,n)=>{switch(t){case"===":return"object"==typeof e&&(e=e.version),"object"==typeof r&&(r=r.version),e===r;case"!==":return"object"==typeof e&&(e=e.version),"object"==typeof r&&(r=r.version),e!==r;case"":case"=":case"==":return((e,t,r)=>0===mt(e,t,r))(e,r,n);case"!=":return((e,t,r)=>0!==mt(e,t,r))(e,r,n);case">":return((e,t,r)=>mt(e,t,r)>0)(e,r,n);case">=":return((e,t,r)=>mt(e,t,r)>=0)(e,r,n);case"<":return((e,t,r)=>mt(e,t,r)<0)(e,r,n);case"<=":return((e,t,r)=>mt(e,t,r)<=0)(e,r,n);default:throw new TypeError(`Invalid operator: ${t}`)}},gt=Et;function Et(e){var t=this;if(t instanceof Et||(t=new Et),t.tail=null,t.head=null,t.length=0,e&&"function"==typeof e.forEach)e.forEach(function(e){t.push(e)});else if(arguments.length>0)for(var r=0,n=arguments.length;r<n;r++)t.push(arguments[r]);return t}function wt(e,t){e.tail=new St(t,e.tail,null,e),e.head||(e.head=e.tail),e.length++}function bt(e,t){e.head=new St(t,null,e.head,e),e.tail||(e.tail=e.head),e.length++}function St(e,t,r,n){if(!(this instanceof St))return new St(e,t,r,n);this.list=n,this.value=e,t?(t.next=this,this.prev=t):this.prev=null,r?(r.prev=this,this.next=r):this.next=null}Et.Node=St,Et.create=Et,Et.prototype.removeNode=function(e){if(e.list!==this)throw new Error("removing node which does not belong to this list");var t=e.next,r=e.prev;return t&&(t.prev=r),r&&(r.next=t),e===this.head&&(this.head=t),e===this.tail&&(this.tail=r),e.list.length--,e.next=null,e.prev=null,e.list=null,t},Et.prototype.unshiftNode=function(e){if(e!==this.head){e.list&&e.list.removeNode(e);var t=this.head;e.list=this,e.next=t,t&&(t.prev=e),this.head=e,this.tail||(this.tail=e),this.length++}},Et.prototype.pushNode=function(e){if(e!==this.tail){e.list&&e.list.removeNode(e);var t=this.tail;e.list=this,e.prev=t,t&&(t.next=e),this.tail=e,this.head||(this.head=e),this.length++}},Et.prototype.push=function(){for(var e=0,t=arguments.length;e<t;e++)wt(this,arguments[e]);return this.length},Et.prototype.unshift=function(){for(var e=0,t=arguments.length;e<t;e++)bt(this,arguments[e]);return this.length},Et.prototype.pop=function(){if(this.tail){var e=this.tail.value;return this.tail=this.tail.prev,this.tail?this.tail.next=null:this.head=null,this.length--,e}},Et.prototype.shift=function(){if(this.head){var e=this.head.value;return this.head=this.head.next,this.head?this.head.prev=null:this.tail=null,this.length--,e}},Et.prototype.forEach=function(e,t){t=t||this;for(var r=this.head,n=0;null!==r;n++)e.call(t,r.value,n,this),r=r.next},Et.prototype.forEachReverse=function(e,t){t=t||this;for(var r=this.tail,n=this.length-1;null!==r;n--)e.call(t,r.value,n,this),r=r.prev},Et.prototype.get=function(e){for(var t=0,r=this.head;null!==r&&t<e;t++)r=r.next;if(t===e&&null!==r)return r.value},Et.prototype.getReverse=function(e){for(var t=0,r=this.tail;null!==r&&t<e;t++)r=r.prev;if(t===e&&null!==r)return r.value},Et.prototype.map=function(e,t){t=t||this;for(var r=new Et,n=this.head;null!==n;)r.push(e.call(t,n.value,this)),n=n.next;return r},Et.prototype.mapReverse=function(e,t){t=t||this;for(var r=new Et,n=this.tail;null!==n;)r.push(e.call(t,n.value,this)),n=n.prev;return r},Et.prototype.reduce=function(e,t){var r,n=this.head;if(arguments.length>1)r=t;else{if(!this.head)throw new TypeError("Reduce of empty list with no initial value");n=this.head.next,r=this.head.value}for(var i=0;null!==n;i++)r=e(r,n.value,i),n=n.next;return r},Et.prototype.reduceReverse=function(e,t){var r,n=this.tail;if(arguments.length>1)r=t;else{if(!this.tail)throw new TypeError("Reduce of empty list with no initial value");n=this.tail.prev,r=this.tail.value}for(var i=this.length-1;null!==n;i--)r=e(r,n.value,i),n=n.prev;return r},Et.prototype.toArray=function(){for(var e=new Array(this.length),t=0,r=this.head;null!==r;t++)e[t]=r.value,r=r.next;return e},Et.prototype.toArrayReverse=function(){for(var e=new Array(this.length),t=0,r=this.tail;null!==r;t++)e[t]=r.value,r=r.prev;return e},Et.prototype.slice=function(e,t){(t=t||this.length)<0&&(t+=this.length),(e=e||0)<0&&(e+=this.length);var r=new Et;if(t<e||t<0)return r;e<0&&(e=0),t>this.length&&(t=this.length);for(var n=0,i=this.head;null!==i&&n<e;n++)i=i.next;for(;null!==i&&n<t;n++,i=i.next)r.push(i.value);return r},Et.prototype.sliceReverse=function(e,t){(t=t||this.length)<0&&(t+=this.length),(e=e||0)<0&&(e+=this.length);var r=new Et;if(t<e||t<0)return r;e<0&&(e=0),t>this.length&&(t=this.length);for(var n=this.length,i=this.tail;null!==i&&n>t;n--)i=i.prev;for(;null!==i&&n>e;n--,i=i.prev)r.push(i.value);return r},Et.prototype.splice=function(e,t,...r){e>this.length&&(e=this.length-1),e<0&&(e=this.length+e);for(var n=0,i=this.head;null!==i&&n<e;n++)i=i.next;var o,s,a,u,c=[];for(n=0;i&&n<t;n++)c.push(i.value),i=this.removeNode(i);for(null===i&&(i=this.tail),i!==this.head&&i!==this.tail&&(i=i.prev),n=0;n<r.length;n++)a=r[n],null===(u=(s=i)===(o=this).head?new St(a,null,s,o):new St(a,s,s.next,o)).next&&(o.tail=u),null===u.prev&&(o.head=u),o.length++,i=u;return c},Et.prototype.reverse=function(){for(var e=this.head,t=this.tail,r=e;null!==r;r=r.prev){var n=r.prev;r.prev=r.next,r.next=n}return this.head=t,this.tail=e,this};try{!function(e){e.prototype[Symbol.iterator]=function*(){for(let e=this.head;e;e=e.next)yield e.value}}(Et)}catch(e){}const Rt=Symbol("max"),It=Symbol("length"),At=Symbol("lengthCalculator"),Pt=Symbol("allowStale"),$t=Symbol("maxAge"),Ot=Symbol("dispose"),Nt=Symbol("noDisposeOnSet"),Tt=Symbol("lruList"),jt=Symbol("cache"),Lt=Symbol("updateAgeOnGet"),xt=()=>1,kt=(e,t,r)=>{const n=e[jt].get(t);if(n){const t=n.value;if(Dt(e,t)){if(Ct(e,n),!e[Pt])return}else r&&(e[Lt]&&(n.value.now=Date.now()),e[Tt].unshiftNode(n));return t.value}},Dt=(e,t)=>{if(!t||!t.maxAge&&!e[$t])return!1;const r=Date.now()-t.now;return t.maxAge?r>t.maxAge:e[$t]&&r>e[$t]},_t=e=>{if(e[It]>e[Rt])for(let t=e[Tt].tail;e[It]>e[Rt]&&null!==t;){const r=t.prev;Ct(e,t),t=r}},Ct=(e,t)=>{if(t){const r=t.value;e[Ot]&&e[Ot](r.key,r.value),e[It]-=r.length,e[jt].delete(r.key),e[Tt].removeNode(t)}};class Ft{constructor(e,t,r,n,i){this.key=e,this.value=t,this.length=r,this.now=n,this.maxAge=i||0}}const Gt=(e,t,r,n)=>{let i=r.value;Dt(e,i)&&(Ct(e,r),e[Pt]||(i=void 0)),i&&t.call(n,i.value,i.key,e)};var Bt=vr;class Mt{constructor(e,t){if(t=ot(t),e instanceof Mt)return e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease?e:new Mt(e.raw,t);if(e instanceof Bt)return this.raw=e.value,this.set=[[e]],this.format(),this;if(this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease,this.raw=e.trim().split(/\s+/).join(" "),this.set=this.raw.split("||").map(e=>this.parseRange(e.trim())).filter(e=>e.length),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${this.raw}`);if(this.set.length>1){const e=this.set[0];if(this.set=this.set.filter(e=>!Yt(e[0])),0===this.set.length)this.set=[e];else if(this.set.length>1)for(const e of this.set)if(1===e.length&&Zt(e[0])){this.set=[e];break}}this.format()}format(){return this.range=this.set.map(e=>e.join(" ").trim()).join("||").trim(),this.range}toString(){return this.range}parseRange(e){const t=((this.options.includePrerelease&&Wt)|(this.options.loose&&qt))+":"+e,r=Kt.get(t);if(r)return r;const n=this.options.loose;e=e.replace(n?Ht[Vt.HYPHENRANGELOOSE]:Ht[Vt.HYPHENRANGE],lr(this.options.includePrerelease)),tt("hyphen replace",e),e=e.replace(Ht[Vt.COMPARATORTRIM],Xt),tt("comparator trim",e),e=e.replace(Ht[Vt.TILDETRIM],zt),tt("tilde trim",e),e=e.replace(Ht[Vt.CARETTRIM],Jt),tt("caret trim",e);let i=e.split(" ").map(e=>er(e,this.options)).join(" ").split(/\s+/).map(e=>cr(e,this.options));n&&(i=i.filter(e=>(tt("loose invalid filter",e,this.options),!!e.match(Ht[Vt.COMPARATORLOOSE])))),tt("range list",i);const o=new Map,s=i.map(e=>new Bt(e,this.options));for(const e of s){if(Yt(e))return[e];o.set(e.value,e)}o.size>1&&o.has("")&&o.delete("");const a=[...o.values()];return Kt.set(t,a),a}intersects(e,t){if(!(e instanceof Mt))throw new TypeError("a Range is required");return this.set.some(r=>Qt(r,t)&&e.set.some(e=>Qt(e,t)&&r.every(r=>e.every(e=>r.intersects(e,t)))))}test(e){if(!e)return!1;if("string"==typeof e)try{e=new dt(e,this.options)}catch(e){return!1}for(let t=0;t<this.set.length;t++)if(fr(this.set[t],e,this.options))return!0;return!1}}var Ut=Mt;const Kt=new class{constructor(e){if("number"==typeof e&&(e={max:e}),e||(e={}),e.max&&("number"!=typeof e.max||e.max<0))throw new TypeError("max must be a non-negative number");this[Rt]=e.max||Infinity;const t=e.length||xt;if(this[At]="function"!=typeof t?xt:t,this[Pt]=e.stale||!1,e.maxAge&&"number"!=typeof e.maxAge)throw new TypeError("maxAge must be a number");this[$t]=e.maxAge||0,this[Ot]=e.dispose,this[Nt]=e.noDisposeOnSet||!1,this[Lt]=e.updateAgeOnGet||!1,this.reset()}set max(e){if("number"!=typeof e||e<0)throw new TypeError("max must be a non-negative number");this[Rt]=e||Infinity,_t(this)}get max(){return this[Rt]}set allowStale(e){this[Pt]=!!e}get allowStale(){return this[Pt]}set maxAge(e){if("number"!=typeof e)throw new TypeError("maxAge must be a non-negative number");this[$t]=e,_t(this)}get maxAge(){return this[$t]}set lengthCalculator(e){"function"!=typeof e&&(e=xt),e!==this[At]&&(this[At]=e,this[It]=0,this[Tt].forEach(e=>{e.length=this[At](e.value,e.key),this[It]+=e.length})),_t(this)}get lengthCalculator(){return this[At]}get length(){return this[It]}get itemCount(){return this[Tt].length}rforEach(e,t){t=t||this;for(let r=this[Tt].tail;null!==r;){const n=r.prev;Gt(this,e,r,t),r=n}}forEach(e,t){t=t||this;for(let r=this[Tt].head;null!==r;){const n=r.next;Gt(this,e,r,t),r=n}}keys(){return this[Tt].toArray().map(e=>e.key)}values(){return this[Tt].toArray().map(e=>e.value)}reset(){this[Ot]&&this[Tt]&&this[Tt].length&&this[Tt].forEach(e=>this[Ot](e.key,e.value)),this[jt]=new Map,this[Tt]=new gt,this[It]=0}dump(){return this[Tt].map(e=>!Dt(this,e)&&{k:e.key,v:e.value,e:e.now+(e.maxAge||0)}).toArray().filter(e=>e)}dumpLru(){return this[Tt]}set(e,t,r){if((r=r||this[$t])&&"number"!=typeof r)throw new TypeError("maxAge must be a number");const n=r?Date.now():0,i=this[At](t,e);if(this[jt].has(e)){if(i>this[Rt])return Ct(this,this[jt].get(e)),!1;const o=this[jt].get(e).value;return this[Ot]&&(this[Nt]||this[Ot](e,o.value)),o.now=n,o.maxAge=r,o.value=t,this[It]+=i-o.length,o.length=i,this.get(e),_t(this),!0}const o=new Ft(e,t,i,n,r);return o.length>this[Rt]?(this[Ot]&&this[Ot](e,t),!1):(this[It]+=o.length,this[Tt].unshift(o),this[jt].set(e,this[Tt].head),_t(this),!0)}has(e){if(!this[jt].has(e))return!1;const t=this[jt].get(e).value;return!Dt(this,t)}get(e){return kt(this,e,!0)}peek(e){return kt(this,e,!1)}pop(){const e=this[Tt].tail;return e?(Ct(this,e),e.value):null}del(e){Ct(this,this[jt].get(e))}load(e){this.reset();const t=Date.now();for(let r=e.length-1;r>=0;r--){const n=e[r],i=n.e||0;if(0===i)this.set(n.k,n.v);else{const e=i-t;e>0&&this.set(n.k,n.v,e)}}}prune(){this[jt].forEach((e,t)=>kt(this,t,!1))}}({max:1e3}),{safeRe:Ht,t:Vt,comparatorTrimReplace:Xt,tildeTrimReplace:zt,caretTrimReplace:Jt}=rt,{FLAG_INCLUDE_PRERELEASE:Wt,FLAG_LOOSE:qt}=et,Yt=e=>"<0.0.0-0"===e.value,Zt=e=>""===e.value,Qt=(e,t)=>{let r=!0;const n=e.slice();let i=n.pop();for(;r&&n.length;)r=n.every(e=>i.intersects(e,t)),i=n.pop();return r},er=(e,t)=>(tt("comp",e,t),e=ir(e,t),tt("caret",e),e=rr(e,t),tt("tildes",e),e=sr(e,t),tt("xrange",e),e=ur(e,t),tt("stars",e),e),tr=e=>!e||"x"===e.toLowerCase()||"*"===e,rr=(e,t)=>e.trim().split(/\s+/).map(e=>nr(e,t)).join(" "),nr=(e,t)=>e.replace(t.loose?Ht[Vt.TILDELOOSE]:Ht[Vt.TILDE],(t,r,n,i,o)=>{let s;return tt("tilde",e,t,r,n,i,o),tr(r)?s="":tr(n)?s=`>=${r}.0.0 <${+r+1}.0.0-0`:tr(i)?s=`>=${r}.${n}.0 <${r}.${+n+1}.0-0`:o?(tt("replaceTilde pr",o),s=`>=${r}.${n}.${i}-${o} <${r}.${+n+1}.0-0`):s=`>=${r}.${n}.${i} <${r}.${+n+1}.0-0`,tt("tilde return",s),s}),ir=(e,t)=>e.trim().split(/\s+/).map(e=>or(e,t)).join(" "),or=(e,t)=>{tt("caret",e,t);const r=t.includePrerelease?"-0":"";return e.replace(t.loose?Ht[Vt.CARETLOOSE]:Ht[Vt.CARET],(t,n,i,o,s)=>{let a;return tt("caret",e,t,n,i,o,s),tr(n)?a="":tr(i)?a=`>=${n}.0.0${r} <${+n+1}.0.0-0`:tr(o)?a="0"===n?`>=${n}.${i}.0${r} <${n}.${+i+1}.0-0`:`>=${n}.${i}.0${r} <${+n+1}.0.0-0`:s?(tt("replaceCaret pr",s),a="0"===n?"0"===i?`>=${n}.${i}.${o}-${s} <${n}.${i}.${+o+1}-0`:`>=${n}.${i}.${o}-${s} <${n}.${+i+1}.0-0`:`>=${n}.${i}.${o}-${s} <${+n+1}.0.0-0`):(tt("no pr"),a="0"===n?"0"===i?`>=${n}.${i}.${o}${r} <${n}.${i}.${+o+1}-0`:`>=${n}.${i}.${o}${r} <${n}.${+i+1}.0-0`:`>=${n}.${i}.${o} <${+n+1}.0.0-0`),tt("caret return",a),a})},sr=(e,t)=>(tt("replaceXRanges",e,t),e.split(/\s+/).map(e=>ar(e,t)).join(" ")),ar=(e,t)=>(e=e.trim()).replace(t.loose?Ht[Vt.XRANGELOOSE]:Ht[Vt.XRANGE],(r,n,i,o,s,a)=>{tt("xRange",e,r,n,i,o,s,a);const u=tr(i),c=u||tr(o),l=c||tr(s);return"="===n&&l&&(n=""),a=t.includePrerelease?"-0":"",u?r=">"===n||"<"===n?"<0.0.0-0":"*":n&&l?(c&&(o=0),s=0,">"===n?(n=">=",c?(i=+i+1,o=0,s=0):(o=+o+1,s=0)):"<="===n&&(n="<",c?i=+i+1:o=+o+1),"<"===n&&(a="-0"),r=`${n+i}.${o}.${s}${a}`):c?r=`>=${i}.0.0${a} <${+i+1}.0.0-0`:l&&(r=`>=${i}.${o}.0${a} <${i}.${+o+1}.0-0`),tt("xRange return",r),r}),ur=(e,t)=>(tt("replaceStars",e,t),e.trim().replace(Ht[Vt.STAR],"")),cr=(e,t)=>(tt("replaceGTE0",e,t),e.trim().replace(Ht[t.includePrerelease?Vt.GTE0PRE:Vt.GTE0],"")),lr=e=>(t,r,n,i,o,s,a,u,c,l,f,h,p)=>`${r=tr(n)?"":tr(i)?`>=${n}.0.0${e?"-0":""}`:tr(o)?`>=${n}.${i}.0${e?"-0":""}`:s?`>=${r}`:`>=${r}${e?"-0":""}`} ${u=tr(c)?"":tr(l)?`<${+c+1}.0.0-0`:tr(f)?`<${c}.${+l+1}.0-0`:h?`<=${c}.${l}.${f}-${h}`:e?`<${c}.${l}.${+f+1}-0`:`<=${u}`}`.trim(),fr=(e,t,r)=>{for(let r=0;r<e.length;r++)if(!e[r].test(t))return!1;if(t.prerelease.length&&!r.includePrerelease){for(let r=0;r<e.length;r++)if(tt(e[r].semver),e[r].semver!==Bt.ANY&&e[r].semver.prerelease.length>0){const n=e[r].semver;if(n.major===t.major&&n.minor===t.minor&&n.patch===t.patch)return!0}return!1}return!0},hr=Symbol("SemVer ANY");class pr{static get ANY(){return hr}constructor(e,t){if(t=ot(t),e instanceof pr){if(e.loose===!!t.loose)return e;e=e.value}e=e.trim().split(/\s+/).join(" "),tt("comparator",e,t),this.options=t,this.loose=!!t.loose,this.parse(e),this.value=this.semver===hr?"":this.operator+this.semver.version,tt("comp",this)}parse(e){const t=e.match(this.options.loose?dr[mr.COMPARATORLOOSE]:dr[mr.COMPARATOR]);if(!t)throw new TypeError(`Invalid comparator: ${e}`);this.operator=void 0!==t[1]?t[1]:"","="===this.operator&&(this.operator=""),this.semver=t[2]?new dt(t[2],this.options.loose):hr}toString(){return this.value}test(e){if(tt("Comparator.test",e,this.options.loose),this.semver===hr||e===hr)return!0;if("string"==typeof e)try{e=new dt(e,this.options)}catch(e){return!1}return yt(e,this.operator,this.semver,this.options)}intersects(e,t){if(!(e instanceof pr))throw new TypeError("a Comparator is required");return""===this.operator?""===this.value||new Ut(e.value,t).test(this.value):""===e.operator?""===e.value||new Ut(this.value,t).test(e.semver):!((t=ot(t)).includePrerelease&&("<0.0.0-0"===this.value||"<0.0.0-0"===e.value)||!t.includePrerelease&&(this.value.startsWith("<0.0.0")||e.value.startsWith("<0.0.0"))||(!this.operator.startsWith(">")||!e.operator.startsWith(">"))&&(!this.operator.startsWith("<")||!e.operator.startsWith("<"))&&(this.semver.version!==e.semver.version||!this.operator.includes("=")||!e.operator.includes("="))&&!(yt(this.semver,"<",e.semver,t)&&this.operator.startsWith(">")&&e.operator.startsWith("<"))&&!(yt(this.semver,">",e.semver,t)&&this.operator.startsWith("<")&&e.operator.startsWith(">")))}}var vr=pr;const{safeRe:dr,t:mr}=rt;new Bt(">=0.0.0-0"),new Bt(">=0.0.0");var yr=(e,t,r)=>{try{t=new Ut(t,r)}catch(e){return!1}return t.test(e)},gr=yr(process.version,">=15.7.0"),Er=yr(process.version,">=16.9.0");const wr={ec:["ES256","ES384","ES512"],rsa:["RS256","PS256","RS384","PS384","RS512","PS512"],"rsa-pss":["PS256","PS384","PS512"]},br={ES256:"prime256v1",ES384:"secp384r1",ES512:"secp521r1"};var Sr=function(e,t){if(!e||!t)return;const r=t.asymmetricKeyType;if(!r)return;const n=wr[r];if(!n)throw new Error(`Unknown key type "${r}".`);if(!n.includes(e))throw new Error(`"alg" parameter for "${r}" key type must be one of: ${n.join(", ")}.`);if(gr)switch(r){case"ec":const r=br[e];if(t.asymmetricKeyDetails.namedCurve!==r)throw new Error(`"alg" parameter "${e}" requires curve "${r}".`);break;case"rsa-pss":if(Er){const r=parseInt(e.slice(-3),10),{hashAlgorithm:n,mgf1HashAlgorithm:i,saltLength:o}=t.asymmetricKeyDetails;if(n!==`sha${r}`||i!==n)throw new Error(`Invalid key for this operation, its RSA-PSS parameters do not meet the requirements of "alg" ${e}.`);if(void 0!==o&&o>r>>3)throw new Error(`Invalid key for this operation, its RSA-PSS parameter saltLength does not meet the requirements of "alg" ${e}.`)}}},Rr=yr(process.version,"^6.12.0 || >=8.0.0");const{KeyObject:Ir,createSecretKey:Ar,createPublicKey:Pr}=c,$r=["RS256","RS384","RS512"],Or=["ES256","ES384","ES512"],Nr=["RS256","RS384","RS512"],Tr=["HS256","HS384","HS512"];Rr&&($r.splice($r.length,0,"PS256","PS384","PS512"),Nr.splice(Nr.length,0,"PS256","PS384","PS512"));var jr=/^\s+|\s+$/g,Lr=/^[-+]0x[0-9a-f]+$/i,xr=/^0b[01]+$/i,kr=/^0o[0-7]+$/i,Dr=/^(?:0|[1-9]\d*)$/,_r=parseInt;function Cr(e){return e!=e}var Fr,Gr,Br=Object.prototype,Mr=Br.hasOwnProperty,Ur=Br.toString,Kr=Br.propertyIsEnumerable,Hr=(Fr=Object.keys,Gr=Object,function(e){return Fr(Gr(e))}),Vr=Math.max;function Xr(e,t){return!!(t=null==t?9007199254740991:t)&&("number"==typeof e||Dr.test(e))&&e>-1&&e%1==0&&e<t}var zr=Array.isArray;function Jr(e){return null!=e&&function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991}(e.length)&&!function(e){var t=Wr(e)?Ur.call(e):"";return"[object Function]"==t||"[object GeneratorFunction]"==t}(e)}function Wr(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function qr(e){return!!e&&"object"==typeof e}var Yr=Object.prototype.toString,Zr=function(e){return!0===e||!1===e||function(e){return!!e&&"object"==typeof e}(e)&&"[object Boolean]"==Yr.call(e)},Qr=/^\s+|\s+$/g,en=/^[-+]0x[0-9a-f]+$/i,tn=/^0b[01]+$/i,rn=/^0o[0-7]+$/i,nn=parseInt,on=Object.prototype.toString;function sn(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}var an=function(e){return"number"==typeof e&&e==function(e){var t=function(e){return e?Infinity===(e=function(e){if("number"==typeof e)return e;if(function(e){return"symbol"==typeof e||function(e){return!!e&&"object"==typeof e}(e)&&"[object Symbol]"==on.call(e)}(e))return NaN;if(sn(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=sn(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(Qr,"");var r=tn.test(e);return r||rn.test(e)?nn(e.slice(2),r?2:8):en.test(e)?NaN:+e}(e))||-Infinity===e?17976931348623157e292*(e<0?-1:1):e==e?e:0:0===e?e:0}(e),r=t%1;return t==t?r?t-r:t:0}(e)},un=Object.prototype.toString,cn=function(e){return"number"==typeof e||function(e){return!!e&&"object"==typeof e}(e)&&"[object Number]"==un.call(e)},ln=Object.prototype,fn=Function.prototype.toString,hn=ln.hasOwnProperty,pn=fn.call(Object),vn=ln.toString,dn=function(e,t){return function(r){return e(t(r))}}(Object.getPrototypeOf,Object),mn=function(e){if(!function(e){return!!e&&"object"==typeof e}(e)||"[object Object]"!=vn.call(e)||function(e){var t=!1;if(null!=e&&"function"!=typeof e.toString)try{t=!!(e+"")}catch(e){}return t}(e))return!1;var t=dn(e);if(null===t)return!0;var r=hn.call(t,"constructor")&&t.constructor;return"function"==typeof r&&r instanceof r&&fn.call(r)==pn},yn=Object.prototype.toString,gn=Array.isArray,En=function(e){return"string"==typeof e||!gn(e)&&function(e){return!!e&&"object"==typeof e}(e)&&"[object String]"==yn.call(e)},wn=/^\s+|\s+$/g,bn=/^[-+]0x[0-9a-f]+$/i,Sn=/^0b[01]+$/i,Rn=/^0o[0-7]+$/i,In=parseInt,An=Object.prototype.toString;function Pn(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}const{KeyObject:$n,createSecretKey:On,createPrivateKey:Nn}=c,Tn=["RS256","RS384","RS512","ES256","ES384","ES512","HS256","HS384","HS512","none"];Rr&&Tn.splice(3,0,"PS256","PS384","PS512");const jn={expiresIn:{isValid:function(e){return an(e)||En(e)&&e},message:'"expiresIn" should be a number of seconds or string representing a timespan'},notBefore:{isValid:function(e){return an(e)||En(e)&&e},message:'"notBefore" should be a number of seconds or string representing a timespan'},audience:{isValid:function(e){return En(e)||Array.isArray(e)},message:'"audience" must be a string or array'},algorithm:{isValid:function(e,t,r,n){var i;e=Jr(e)?e:(i=e)?function(e,t){return function(t,r){for(var n=-1,i=t?t.length:0,o=Array(i);++n<i;)o[n]=e[t[n]];return o}(t)}(i,function(e){return Jr(e)?function(e,t){var r=zr(e)||function(e){return function(e){return qr(e)&&Jr(e)}(e)&&Mr.call(e,"callee")&&(!Kr.call(e,"callee")||"[object Arguments]"==Ur.call(e))}(e)?function(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n}(e.length,String):[],n=r.length,i=!!n;for(var o in e)!Mr.call(e,o)||i&&("length"==o||Xr(o,n))||r.push(o);return r}(e):function(e){if((t=e)!==("function"==typeof(r=t&&t.constructor)&&r.prototype||Br))return Hr(e);var t,r,n=[];for(var i in Object(e))Mr.call(e,i)&&"constructor"!=i&&n.push(i);return n}(e)}(i)):[],r=r&&!n?function(e){var t=function(e){return e?Infinity===(e=function(e){if("number"==typeof e)return e;if(function(e){return"symbol"==typeof e||qr(e)&&"[object Symbol]"==Ur.call(e)}(e))return NaN;if(Wr(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=Wr(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(jr,"");var r=xr.test(e);return r||kr.test(e)?_r(e.slice(2),r?2:8):Lr.test(e)?NaN:+e}(e))||-Infinity===e?17976931348623157e292*(e<0?-1:1):e==e?e:0:0===e?e:0}(e),r=t%1;return t==t?r?t-r:t:0}(r):0;var o=e.length;return r<0&&(r=Vr(o+r,0)),function(e){return"string"==typeof e||!zr(e)&&qr(e)&&"[object String]"==Ur.call(e)}(e)?r<=o&&e.indexOf(t,r)>-1:!!o&&function(e,t,r){if(t!=t)return function(e,t,r,n){for(var i=e.length,o=r+-1;++o<i;)if(t(e[o],o,e))return o;return-1}(e,Cr,r);for(var n=r-1,i=e.length;++n<i;)if(e[n]===t)return n;return-1}(e,t,r)>-1}.bind(null,Tn),message:'"algorithm" must be a valid string enum value'},header:{isValid:mn,message:'"header" must be an object'},encoding:{isValid:En,message:'"encoding" must be a string'},issuer:{isValid:En,message:'"issuer" must be a string'},subject:{isValid:En,message:'"subject" must be a string'},jwtid:{isValid:En,message:'"jwtid" must be a string'},noTimestamp:{isValid:Zr,message:'"noTimestamp" must be a boolean'},keyid:{isValid:En,message:'"keyid" must be a string'},mutatePayload:{isValid:Zr,message:'"mutatePayload" must be a boolean'},allowInsecureKeySizes:{isValid:Zr,message:'"allowInsecureKeySizes" must be a boolean'},allowInvalidAsymmetricKeyTypes:{isValid:Zr,message:'"allowInvalidAsymmetricKeyTypes" must be a boolean'}},Ln={iat:{isValid:cn,message:'"iat" should be a number of seconds'},exp:{isValid:cn,message:'"exp" should be a number of seconds'},nbf:{isValid:cn,message:'"nbf" should be a number of seconds'}};function xn(e,t,r,n){if(!mn(r))throw new Error('Expected "'+n+'" to be a plain object.');Object.keys(r).forEach(function(i){const o=e[i];if(o){if(!o.isValid(r[i]))throw new Error(o.message)}else if(!t)throw new Error('"'+i+'" is not allowed in "'+n+'"')})}const kn={audience:"aud",issuer:"iss",subject:"sub",jwtid:"jti"},Dn=["expiresIn","notBefore","noTimestamp","audience","issuer","subject","jwtid"];var _n=function(e,t,r,n){let i;if("function"!=typeof r||n||(n=r,r={}),r||(r={}),r=Object.assign({},r),i=n||function(e,t){if(e)throw e;return t},r.clockTimestamp&&"number"!=typeof r.clockTimestamp)return i(new Ke("clockTimestamp must be a number"));if(void 0!==r.nonce&&("string"!=typeof r.nonce||""===r.nonce.trim()))return i(new Ke("nonce must be a non-empty string"));if(void 0!==r.allowInvalidAsymmetricKeyTypes&&"boolean"!=typeof r.allowInvalidAsymmetricKeyTypes)return i(new Ke("allowInvalidAsymmetricKeyTypes must be a boolean"));const o=r.clockTimestamp||Math.floor(Date.now()/1e3);if(!e)return i(new Ke("jwt must be provided"));if("string"!=typeof e)return i(new Ke("jwt must be a string"));const s=e.split(".");if(3!==s.length)return i(new Ke("jwt malformed"));let a;try{a=function(e,t){var r=Me.decode(e,t=t||{});if(!r)return null;var n=r.payload;if("string"==typeof n)try{var i=JSON.parse(n);null!==i&&"object"==typeof i&&(n=i)}catch(e){}return!0===t.complete?{header:r.header,payload:n,signature:r.signature}:n}(e,{complete:!0})}catch(e){return i(e)}if(!a)return i(new Ke("invalid token"));const u=a.header;let c;if("function"==typeof t){if(!n)return i(new Ke("verify must be called asynchronous if secret or public key is provided as a callback"));c=t}else c=function(e,r){return r(null,t)};return c(u,function(t,n){if(t)return i(new Ke("error in secret or public key callback: "+t.message));const c=""!==s[2].trim();if(!c&&n)return i(new Ke("jwt signature is required"));if(c&&!n)return i(new Ke("secret or public key must be provided"));if(!c&&!r.algorithms)return i(new Ke('please specify "none" in "algorithms" to verify unsigned tokens'));if(null!=n&&!(n instanceof Ir))try{n=Pr(n)}catch(e){try{n=Ar("string"==typeof n?Buffer.from(n):n)}catch(e){return i(new Ke("secretOrPublicKey is not valid key material"))}}if(r.algorithms||(r.algorithms="secret"===n.type?Tr:["rsa","rsa-pss"].includes(n.asymmetricKeyType)?Nr:"ec"===n.asymmetricKeyType?Or:$r),-1===r.algorithms.indexOf(a.header.alg))return i(new Ke("invalid algorithm"));if(u.alg.startsWith("HS")&&"secret"!==n.type)return i(new Ke(`secretOrPublicKey must be a symmetric key when using ${u.alg}`));if(/^(?:RS|PS|ES)/.test(u.alg)&&"public"!==n.type)return i(new Ke(`secretOrPublicKey must be an asymmetric key when using ${u.alg}`));if(!r.allowInvalidAsymmetricKeyTypes)try{Sr(u.alg,n)}catch(e){return i(e)}let l;try{l=Me.verify(e,a.header.alg,n)}catch(e){return i(e)}if(!l)return i(new Ke("invalid signature"));const f=a.payload;if(void 0!==f.nbf&&!r.ignoreNotBefore){if("number"!=typeof f.nbf)return i(new Ke("invalid nbf value"));if(f.nbf>o+(r.clockTolerance||0))return i(new Ve("jwt not active",new Date(1e3*f.nbf)))}if(void 0!==f.exp&&!r.ignoreExpiration){if("number"!=typeof f.exp)return i(new Ke("invalid exp value"));if(o>=f.exp+(r.clockTolerance||0))return i(new ze("jwt expired",new Date(1e3*f.exp)))}if(r.audience){const e=Array.isArray(r.audience)?r.audience:[r.audience];if(!(Array.isArray(f.aud)?f.aud:[f.aud]).some(function(t){return e.some(function(e){return e instanceof RegExp?e.test(t):e===t})}))return i(new Ke("jwt audience invalid. expected: "+e.join(" or ")))}if(r.issuer&&("string"==typeof r.issuer&&f.iss!==r.issuer||Array.isArray(r.issuer)&&-1===r.issuer.indexOf(f.iss)))return i(new Ke("jwt issuer invalid. expected: "+r.issuer));if(r.subject&&f.sub!==r.subject)return i(new Ke("jwt subject invalid. expected: "+r.subject));if(r.jwtid&&f.jti!==r.jwtid)return i(new Ke("jwt jwtid invalid. expected: "+r.jwtid));if(r.nonce&&f.nonce!==r.nonce)return i(new Ke("jwt nonce invalid. expected: "+r.nonce));if(r.maxAge){if("number"!=typeof f.iat)return i(new Ke("iat required when maxAge is specified"));const e=Qe(r.maxAge,f.iat);if(void 0===e)return i(new Ke('"maxAge" should be a number of seconds or string representing a timespan eg: "1d", "20h", 60'));if(o>=e+(r.clockTolerance||0))return i(new ze("maxAge exceeded",new Date(1e3*e)))}return i(null,!0===r.complete?{header:u,payload:f,signature:a.signature}:f)})},Cn=function(e,t,r,n){"function"==typeof r?(n=r,r={}):r=r||{};const i="object"==typeof e&&!Buffer.isBuffer(e),o=Object.assign({alg:r.algorithm||"HS256",typ:i?"JWT":void 0,kid:r.keyid},r.header);function s(e){if(n)return n(e);throw e}if(!t&&"none"!==r.algorithm)return s(new Error("secretOrPrivateKey must have a value"));if(null!=t&&!(t instanceof $n))try{t=Nn(t)}catch(e){try{t=On("string"==typeof t?Buffer.from(t):t)}catch(e){return s(new Error("secretOrPrivateKey is not valid key material"))}}if(o.alg.startsWith("HS")&&"secret"!==t.type)return s(new Error(`secretOrPrivateKey must be a symmetric key when using ${o.alg}`));if(/^(?:RS|PS|ES)/.test(o.alg)){if("private"!==t.type)return s(new Error(`secretOrPrivateKey must be an asymmetric key when using ${o.alg}`));if(!r.allowInsecureKeySizes&&!o.alg.startsWith("ES")&&void 0!==t.asymmetricKeyDetails&&t.asymmetricKeyDetails.modulusLength<2048)return s(new Error(`secretOrPrivateKey has a minimum key size of 2048 bits for ${o.alg}`))}if(void 0===e)return s(new Error("payload is required"));if(i){try{!function(e){xn(Ln,!0,e,"payload")}(e)}catch(e){return s(e)}r.mutatePayload||(e=Object.assign({},e))}else{const t=Dn.filter(function(e){return void 0!==r[e]});if(t.length>0)return s(new Error("invalid "+t.join(",")+" option for "+typeof e+" payload"))}if(void 0!==e.exp&&void 0!==r.expiresIn)return s(new Error('Bad "options.expiresIn" option the payload already has an "exp" property.'));if(void 0!==e.nbf&&void 0!==r.notBefore)return s(new Error('Bad "options.notBefore" option the payload already has an "nbf" property.'));try{!function(e){xn(jn,!1,e,"options")}(r)}catch(e){return s(e)}if(!r.allowInvalidAsymmetricKeyTypes)try{Sr(o.alg,t)}catch(e){return s(e)}const a=e.iat||Math.floor(Date.now()/1e3);if(r.noTimestamp?delete e.iat:i&&(e.iat=a),void 0!==r.notBefore){try{e.nbf=Qe(r.notBefore,a)}catch(e){return s(e)}if(void 0===e.nbf)return s(new Error('"notBefore" should be a number of seconds or string representing a timespan eg: "1d", "20h", 60'))}if(void 0!==r.expiresIn&&"object"==typeof e){try{e.exp=Qe(r.expiresIn,a)}catch(e){return s(e)}if(void 0===e.exp)return s(new Error('"expiresIn" should be a number of seconds or string representing a timespan eg: "1d", "20h", 60'))}Object.keys(kn).forEach(function(t){const n=kn[t];if(void 0!==r[t]){if(void 0!==e[n])return s(new Error('Bad "options.'+t+'" option. The payload already has an "'+n+'" property.'));e[n]=r[t]}});const u=r.encoding||"utf8";if("function"!=typeof n){let n=Me.sign({header:o,payload:e,secret:t,encoding:u});if(!r.allowInsecureKeySizes&&/^(?:RS|PS)/.test(o.alg)&&n.length<256)throw new Error(`secretOrPrivateKey has a minimum key size of 2048 bits for ${o.alg}`);return n}n=n&&function(e){return function(e,t){var r;if("function"!=typeof t)throw new TypeError("Expected a function");return e=function(e){var t=function(e){return e?Infinity===(e=function(e){if("number"==typeof e)return e;if(function(e){return"symbol"==typeof e||function(e){return!!e&&"object"==typeof e}(e)&&"[object Symbol]"==An.call(e)}(e))return NaN;if(Pn(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=Pn(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(wn,"");var r=Sn.test(e);return r||Rn.test(e)?In(e.slice(2),r?2:8):bn.test(e)?NaN:+e}(e))||-Infinity===e?17976931348623157e292*(e<0?-1:1):e==e?e:0:0===e?e:0}(e),r=t%1;return t==t?r?t-r:t:0}(e),function(){return--e>0&&(r=t.apply(this,arguments)),e<=1&&(t=void 0),r}}(2,e)}(n),Me.createSign({header:o,privateKey:t,payload:e,encoding:u}).once("error",n).once("done",function(e){if(!r.allowInsecureKeySizes&&/^(?:RS|PS)/.test(o.alg)&&e.length<256)return n(new Error(`secretOrPrivateKey has a minimum key size of 2048 bits for ${o.alg}`));n(null,e)})},Fn=/*#__PURE__*/function(){function e(e,t){this.privateKey=e,this.options=t}var t=e.prototype;return t.sign=function(e){var t=L({},this.options,{jwtid:p.v4()});return Cn(e,this.privateKey,t)},t.verify=function(e){return _n(e,this.privateKey,this.options)},t.refresh=function(e){var t=_n(e,this.privateKey,this.options);delete t.sub,delete t.iss,delete t.aud,delete t.iat,delete t.exp,delete t.nbf,delete t.jti;var r=L({},this.options,{jwtid:p.v4()});return Cn(t,this.privateKey,r)},e}(),Gn=/*#__PURE__*/function(){function a(e,r,n){this.app=t(),this.express_config=s.defaultsDeep(e,{helmet:!0,json:!0,urlencoded:!0,compression:!0,cors:{origin:!0,credentials:!0},fileupload:!0,socketio:{transports:["websocket"]},traceRequests:!1}),this.statics=r,this.routes=n}var u=a.prototype;return u.initialize=function(){try{var e=function(){return Promise.resolve(t.configureRoutes(t.routes)).then(function(){return Promise.resolve(t.errorHandler()).then(function(){})})},t=this;t.config(t.express_config);var r=function(){if(t.customizeExpress)return Promise.resolve(t.customizeExpress(t.app)).then(function(){})}();return Promise.resolve(r&&r.then?r.then(e):e())}catch(e){return Promise.reject(e)}},u.customizeExpress=function(){},u.config=function(a){if(a&&a.helmet&&this.app.use(e(a&&s.isObject(a.helmet)&&a.helmet)),a&&a.json&&this.app.use(t.json()),a&&a.urlencoded&&this.app.use(t.urlencoded({extended:!0})),a&&a.compression&&this.app.use(r()),a&&a.cors&&(this.app.options("*",n(a&&s.isObject(a.cors)&&a.cors)),this.app.use(n(a&&s.isObject(a.cors)&&a.cors))),a&&a.fileupload&&this.app.use(i()),this.statics)for(var u in this.statics)this.app.use(u,t.static(this.statics[u]));a&&!0===a.traceRequests&&"true"!=process.env.DISABLE_LOGGER&&this.app.use(function(e,t,r){e.requestTime=Date.now(),t.on("finish",function(){var t=o.parse(e.url).pathname,r=Date.now()-e.requestTime;console.debug("APIRequest["+process.pid+"]::. ["+e.method+"] (user:"+(e&&e.session&&e.session.user_id||"")+")  "+t+" |-> took: "+r+" ms"),console.debug(JSON.stringify(e.body))}),r()})},u.configureRoutes=function(e){var r=t.Router();this.app.use(r),this.loadRoutes(this.app,e)},u.loadRoutes=function(e,t){if(t)for(var r,n=_(t);!(r=n()).done;){var i=r.value;if(i){var o=i.configure();if(i.entity&&(o=i.configure(i.entity,{service:i.service,table:i.table})),!s.isEmpty(i.routes)){var a=C.expressHandler();for(var u in i.routes){var c=i.routes[u];for(var l in c){var f=c[l];Array.isArray(f)?o[l](u,f[0],a(f[1])):o[l](u,a(f))}}}o&&e.use(o)}else console.warn("Empty route")}},u.errorHandler=function(){this.app.use(function(e,t,r,n){var i=new G;i.success=!1,i.message=e.message,console.error(e),r.status(500).json(i.toJson())})},a}(),Bn=/*#__PURE__*/function(e){function t(t){var r;return r=e.call(this)||this,process.env.PORT||console.log("Using 3000 as default port. Customize via env PORT."),r.port=r.normalizePort(process.env.PORT||3e3),r.clustered=process.env.CLUSTERED,r.workers=[],r.app=t,r.executeOnlyMain=function(){},r}x(t,e);var r=t.prototype;return r.setServerCls=function(e){this.server=e},r.start=function(){try{var e=this,t=function(){if("true"!=e.clustered)return e.configureSocketIO(),e.executeOnlyMain(),Promise.resolve(e.initUnclustered()).then(function(){});e.initClustered()}();return Promise.resolve(t&&t.then?t.then(function(){}):void 0)}catch(e){return Promise.reject(e)}},r.configureSocketIO=function(){this.server.express_config&&this.server.express_config.socketio&&(this.app.io=new g(this.server.express_config&&this.server.express_config.socketio),this.app.io.listen(this.port+1))},r.initClustered=function(){try{var e=this,t=function(){if(!y.isPrimary)return Promise.resolve(e.initUnclustered()).then(function(){console.log("Worker "+process.pid+" started")});e.configureSocketIO(),e.executeOnlyMain(),(new b).on("event",function(t,r){t&&t.event&&(1==process.env.DEBUG_EVENTS&&console.debug("Received '"+t.event+"' from "+t.props.owner+" at Master"),e.app.events.emit(t.event,t.props,r))});for(var t=E.cpus().length,r=0;r<t;r+=1)e.initWorker();y.on("exit",function(t){console.log("Worker "+t.id+" died :("),e.initWorker()})}();return Promise.resolve(t&&t.then?t.then(function(){}):void 0)}catch(e){return Promise.reject(e)}},r.initWorker=function(){var e=y.fork();console.log("Running worker "+e.process.pid),this.workers.push(e)},r.initUnclustered=function(){try{var e=this;e.server.port=e.port;var t=v.Server(e.server.app);return Promise.resolve(e.server.initialize()).then(function(){function r(){function r(){if(t.on("error",function(t){e.handleErrors(t,e.server.port)}),t.on("listening",function(){console.log("Server Worker running on port: "+e.port+"!"),e.emit("listening",e.port)}),process.env.SSL&&"true"==process.env.SSL){process.env.SSL_KEY&&process.env.SSL_CERT&&process.env.SSL_PASS||(console.error("Invalid SSL configuration. SLL_KEY, SSL_CERT and SSL_PASS needed"),process.exit(0));var r={key:a.readFileSync(m.resolve(process.cwd(),process.env.SSL_KEY||"key.pem")),cert:a.readFileSync(m.resolve(process.cwd(),process.env.SSL_CERT||"cert.pem")),passphrase:process.env.SSL_PASS};process.env.SSL_PORT||console.log("Using 3443 as ssl default port. Customize via env SSL_PORT.");var n=e.normalizePort(process.env.SSL_PORT||3443),i=d.createServer(r,e.server.app);i.listen(n),i.on("error",function(t){e.handleErrors(t,n)}),i.on("listening",function(){console.log("Server Worker running on port: "+n+"!"),e.emit("listening_ssl",n)})}}t.listen(e.server.port);var n=function(){if(e.server.afterListen)return Promise.resolve(e.server.afterListen()).then(function(){})}();return n&&n.then?n.then(r):r()}var n=function(){if(e.server.beforeListen)return Promise.resolve(e.server.beforeListen()).then(function(){})}();return n&&n.then?n.then(r):r()})}catch(e){return Promise.reject(e)}},r.normalizePort=function(e){var t=parseInt(e,10);return isNaN(t)?e:t>=0&&t},r.handleErrors=function(e,t){if("listen"!==e.syscall)throw e;var r="string"==typeof t?"Pipe "+t:"Port "+t;switch(e.code){case"EACCES":console.error(r+" requires elevated privileges"),process.exit(1);break;case"EADDRINUSE":console.error(r+" is already in use"),process.exit(1);break;default:throw e}},t}(w),Mn=/*#__PURE__*/function(e){function t(t){var r;return(r=e.call(this)||this).messages=new b,r.app=t,y.isWorker&&r.messages.on("event",function(t,n){t&&t.event&&process.pid!==t.props.owner&&(1==process.env.DEBUG_EVENTS&&console.debug("Receiving broadcast "+t.event+" - "+process.pid),e.prototype.emit.call(function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(r),t.event,L({},t.props),n))}),r}return x(t,e),t.prototype.emit=function(t,r,n){e.prototype.emit.call(this,t,r,n),t&&r&&y.isWorker&&process.pid!==r.owner&&(1==process.env.DEBUG_EVENTS&&console.debug(t+" -> Firing from "+process.pid+" to master"),r||(r={}),r.owner=process.pid,this.messages.send("event",{event:t,props:L({},r)},n)),t&&r&&y.isPrimary&&this.app&&this.app.server&&this.app.server.workers&&(1==process.env.DEBUG_EVENTS&&console.debug(t+" -> Firing from master to workers"),this.messages.send("event",{event:t,props:L({},r)},n))},t}(w),Un=S.configure,Kn=S.getLogger,Hn=/*#__PURE__*/function(){function e(){}return e.configure=function(){try{var e=u.promisify(a.readFile);return Promise.resolve(e(m.resolve(process.cwd(),"./log4js.json"),"utf8")).then(function(e){var t,r,n;Un(JSON.parse(e)),t=Kn("log"),r=Kn("error"),n=Kn("debug"),console.log=function(){var e=Array.prototype.slice.call(arguments);t.log("info",e[0])},console.error=function(){var e=Array.prototype.slice.call(arguments);r.log("error",e[0])},console.info=function(){var e=Array.prototype.slice.call(arguments);t.log("info",e[0])},console.debug=function(){var e=Array.prototype.slice.call(arguments);n.log("debug",e[0])},console.custom=function(e,t,r){Kn(e).log(t,r)}})}catch(e){return Promise.reject(e)}},e}();function Vn(e,t){try{var r=e()}catch(e){return t(e)}return r&&r.then?r.then(void 0,t):r}var Xn=/*#__PURE__*/function(){function e(e,r){this.router=t.Router(),this.publicPathsList=[].concat(e,["/login"]),this.AuthHandler=r}var r=e.prototype;return r.configure=function(){var e=this,t=C.expressHandler();return this.router.use(t(function(){return e.check.apply(e,[].slice.call(arguments))})),this.router.post("/login",t(function(){return e.loginPost.apply(e,[].slice.call(arguments))})),this.router.post("/logout",t(function(){return e.logout.apply(e,[].slice.call(arguments))})),this.router},r.check=function(e,t,r){try{var n=this;return Promise.resolve(Vn(function(){for(var i,s=_(n.publicPathsList);!(i=s()).done;)if(null!==R(i.value).exec(o.parse(e.url).pathname))return r();return Promise.resolve(n.AuthHandler.check(e)).then(function(e){return e?r():t.status(403).json(new G(!1,null,"Forbidden").toJson())})},function(e){return console.error(e),t.status(403).json(new G(!1,null,"Forbidden").toJson())}))}catch(e){return Promise.reject(e)}},r.loginPost=function(e,t){try{var r,n=function(e){return r?e:t.status(401).json(new G(!1,null,"Unauthorized - Missing parameters").toJson())},i=this,o=function(){if(e.body.username)return Vn(function(){return Promise.resolve(i.AuthHandler.validate(e,e.body.username,e.body.password)).then(function(e){if(e){var n=t.status(200).json(new G(!0,e).toJson());return r=1,n}var i=t.status(401).json(new G(!1,null,"Unauthorized - Incorrect credentials").toJson());return r=1,i})},function(e){console.error(e);var n=t.status(401).json(new G(!1,null,"Unauthorized - Error, check log").toJson());return r=1,n})}();return Promise.resolve(o&&o.then?o.then(n):n(o))}catch(e){return Promise.reject(e)}},r.logout=function(e,t){try{var r,n=function(e){return r?e:t.status(200).json(new G(!0).toJson())},i=this,o=function(){if(i.AuthHandler.logout)return Vn(function(){return Promise.resolve(i.AuthHandler.logout(e)).then(function(){var e=t.status(200).json(new G(!0).toJson());return r=1,e})},function(e){console.error(e);var n=t.status(500).json(new G(!1,null,e).toJson());return r=1,n})}();return Promise.resolve(o&&o.then?o.then(n):n(o))}catch(e){return Promise.reject(e)}},e}(),zn=function(){if(!this.check)throw new Error("AuthHandler must have 'check' vethod");if(!this.validate)throw new Error("AuthHandler must have 'validate' vethod")},Jn=/*#__PURE__*/function(e){function t(t){var r;if((r=e.call(this)||this).tokenGenerator=new Fn(process.env.JWT_SECRET,{audience:process.env.JWT_AUDIENCE,issuer:process.env.JWT_ISSUER,subject:process.env.JWT_SUBJECT,algorithm:process.env.JWT_ALGORITHM,expiresIn:process.env.JWT_EXPIRES}),!t)throw new Error("Need 'UserDao' for user validation. Create 'UserDao' class extending 'IUserDao'");return r.userDao=t,r}x(t,e);var r=t.prototype;return r.check=function(e){try{if(e.headers.authorization){var t=(e.headers.authorization||"").split(" ")[1]||"";if(!t)return console.error("Token needed"),Promise.resolve(!1);try{var r=this.tokenGenerator.verify(t);return r.sub&&r.username&&!I(r.exp).isAfter(new Date)?(e.session=L({},e.session,r),Promise.resolve(!0)):Promise.resolve(!1)}catch(e){return console.error(e),Promise.resolve(!1)}}return Promise.resolve(!1)}catch(e){return Promise.reject(e)}},r.validate=function(e,t,r){try{var n=this;return Promise.resolve(n.userDao.findByUsername(t)).then(function(e){return!(!e||e.username!==t||e.password!==C.encrypt(r))&&n.tokenGenerator.sign(s.omit(e,["password"]))})}catch(e){return Promise.reject(e)}},t}(zn),Wn=/*#__PURE__*/function(e){function t(t){var r;if(r=e.call(this)||this,!t)throw new Error("Need 'UserDao' for user validation. Create 'UserDao' class extending 'IUserDao'");return r.userDao=t,r}x(t,e);var r=t.prototype;return r.check=function(e){try{var t,r=function(r){return t?r:!(!e.session||!e.session.username)},n=this,i=function(){if(e.headers.authorization){var r=(e.headers.authorization||"").split(" ")[1]||"",i=Buffer.from(r,"base64").toString().split(":");return Promise.resolve(n.validate(e,i[0],i[1])).then(function(e){return e?t=!0:(t=1,!1)})}}();return Promise.resolve(i&&i.then?i.then(r):r(i))}catch(e){return Promise.reject(e)}},r.validate=function(e,t,r){try{return Promise.resolve(this.userDao.findByUsername(t)).then(function(n){return!(!n||n.username!==t||n.password!==C.encrypt(r)||(e.session=L({},e.session,s.omit(n,["password"])),0))})}catch(e){return Promise.reject(e)}},r.logout=function(e){return new Promise(function(t){e.session&&e.session.destroy(t)})},t}(zn),qn=new(/*#__PURE__*/function(){function e(){}var t=e.prototype;return t.init=function(e){this.connection=$(e)},t.setColumnAliases=function(e){this.columnAliases=e},t.test=function(){return this.connection.raw("select 1+1 as result")},e}()),Yn=/*#__PURE__*/function(){function e(){}return e.parseQueryString=function(e,t,r){var n={allowGlobalSearch:!0,caseInsensitive:!0};qn.columnAliases&&qn.columnAliases[r]&&(n.aliases=qn.columnAliases[r]),void 0!==qn.caseInsensitive&&(n.caseInsensitive=qn.caseInsensitive),void 0!==qn.allowGlobalSearch&&(n.allowGlobalSearch=qn.allowGlobalSearch);var i=new A(n).parse(t);return new P(r).toKnex(e,i)},e.parseFilters=function(t,r,n){var i=t;for(var o in r){var s=r[o];if("object"==typeof s)switch(s.type){case"fql":i=e.parseQueryString(i,s.value,n);break;case"date":case"between":s.start&&s.end&&(i=i.whereBetween(o,[s.start,s.end])),s.start&&!s.end&&(i=i.where(o,">=",s.start)),!s.start&&s.end&&(i=i.where(o,">=",s.end));break;case"dateraw":case"betweenraw":s.start&&s.end&&(i=i.whereRaw(o+" BETWEEN ? AND ?",[s.start,s.end])),s.start&&!s.end&&(i=i.whereRaw(o+" >= ?",[s.start])),!s.start&&s.end&&(i=i.whereRaw(o+" >= ?",[s.end]));break;case"jsonb":i=i.whereRaw(o+" ILIKE ?",["%"+s.value+"%"]);break;case"full-text-psql":i=i.whereRaw("to_tsvector("+o+"::text) @@ to_tsquery(?)",[s.value]);break;case"greater":case"greaterraw":i=i.whereRaw(o+" > ?",[s.value]);break;case"greaterEq":case"greaterEqraw":i=i.whereRaw(o+" >= ?",[s.value]);break;case"less":case"lessraw":i=i.whereRaw(o+" < ?",[s.value]);break;case"lessEq":case"lessEqraw":i=i.whereRaw(o+" <= ?",[s.value]);break;case"exists":i=i.whereExists(o);break;case"notexists":i=i.whereNotExists(o);break;case"exact":case"exactraw":i=i.whereRaw(o+" = ?",[s.value]);break;case"in":var a=o;a.includes(",")&&(a=o.split(",")),Array.isArray(s.value)||null==s.value?null!=s.value&&(i=i.whereIn(a,s.value)):i=i.whereIn(a,s.value.split(","));break;case"inraw":Array.isArray(s.value)||null==s.value?null!=s.value&&(i=i.whereRaw(o+" IN (?)",[s.value.map(function(e){return"'"+e+"'"}).join(",")])):i=i.whereRaw(o+" IN (?)",[s.value.split(",").map(function(e){return"'"+e+"'"}).join(",")]);break;case"not":case"notraw":i=i.whereRaw(o+" != ?",[s.value]);break;case"like":case"likeraw":var u=C.replaceAll(s.value,"*","%");i=i.whereRaw(" "+o+" LIKE ?",[u]);break;case"notlike":case"notlikeraw":var c=C.replaceAll(s.value,"*","%");i=i.whereRaw(" "+o+" NOT LIKE ?",[c]);break;case"likeI":var l=C.replaceAll(s.value,"*","%");i=i.whereRaw(" "+o+" ILIKE ?",[l]);break;case"notlikeI":var f=C.replaceAll(s.value,"*","%");i=i.whereRaw(" "+o+" NOT ILIKE ?",[f]);break;case"null":case"nullraw":i=i.whereRaw(o+" is NULL");break;case"notnull":case"notnullraw":i=i.whereRaw(o+" is not NULL")}else i=i.where(o,s)}return i},e.parseSort=function(e){if(!e.field||!e.direction)return 1;var t="ASC";return"descend"===e.direction&&(t="DESC"),e.field+" "+t},e}(),Zn=/*#__PURE__*/function(){function e(){this.tableName=""}var t=e.prototype;return t.loadAllData=function(e,t){return qn.connection.select("*").from(this.tableName).limit(t||1e4).offset(e)},t.loadFilteredData=function(e,t,r){try{var n=this,i=1;return e.sort&&(i=Yn.parseSort(e.sort)),Promise.resolve(qn.connection.from(n.tableName).where(function(t){return Yn.parseFilters(t,s.omit(e,["sort","start","limit"]),n.tableName)}).orderByRaw(i).limit(r).offset(t))}catch(e){return Promise.reject(e)}},t.countFilteredData=function(e){try{var t=this;return Promise.resolve(qn.connection.from(t.tableName).where(function(r){return Yn.parseFilters(r,s.omit(e,["sort","start","limit"]),t.tableName)}).count("id",{as:"total"})).then(function(e){return e&&e[0].total})}catch(e){return Promise.reject(e)}},t.loadById=function(e){try{return Promise.resolve(qn.connection.from(this.tableName).where("id",e)).then(function(e){return e&&e[0]?e[0]:null})}catch(e){return Promise.reject(e)}},t.save=function(e){return qn.connection.from(this.tableName).insert(e).returning("*")},t.update=function(e,t){return qn.connection.from(this.tableName).where("id",e).update(t).returning("*")},t.delete=function(e){try{var t=this;return Promise.resolve(t.loadById(e)).then(function(r){if(!r)throw"NotFound";return qn.connection.from(t.tableName).where("id",e).delete()})}catch(e){return Promise.reject(e)}},e}(),Qn=/*#__PURE__*/function(e){function t(t){var r;if(!(r=e.call(this,t)||this).findByUsername)throw new Error("AuthHandler must have 'findByUsername' method");return r}return x(t,e),t}(Zn);function ei(e,t){try{var r=e()}catch(e){return t(e)}return r&&r.then?r.then(void 0,t):r}var ti=/*#__PURE__*/function(){function e(){this.router=t.Router(),this.routes={}}var r=e.prototype;return r.configure=function(e,t){var r=this;if(!e)return this.router;var n=C.expressHandler();return this.router.get("/"+e,n(function(){return r.listEntidad.apply(r,[].slice.call(arguments))})),this.router.post("/"+e+"/list",n(function(){return r.listEntidad.apply(r,[].slice.call(arguments))})),this.router.get("/"+e+"/:id",n(function(){return r.getEntidad.apply(r,[].slice.call(arguments))})),this.router.post("/"+e,n(function(){return r.saveEntidad.apply(r,[].slice.call(arguments))})),this.router.put("/"+e+"/:id",n(function(){return r.updateEntidad.apply(r,[].slice.call(arguments))})),this.router.delete("/"+e+"/:id",n(function(){return r.deleteEntidad.apply(r,[].slice.call(arguments))})),this.service=t.service,this.table=t.table,this.router},r.listEntidad=function(e,t,r){try{var n=this,i=ei(function(){var r=new n.service(null,n.table),i="POST"===e.method?e.body:e.query&&e.query.filters?JSON.parse(e.query.filters):{};return Promise.resolve(r.list(i,i.start,i.limit)).then(function(e){var r=new G(!0,e.data,null,e.total);t.json(r.toJson())})},function(e){r(e)});return Promise.resolve(i&&i.then?i.then(function(){}):void 0)}catch(e){return Promise.reject(e)}},r.getEntidad=function(e,t,r){try{var n=this,i=ei(function(){var r=new n.service(null,n.table);return Promise.resolve(r.loadById(e.params.id)).then(function(e){var r=new G(!0,e),n=200;null==e&&(n=404,r=new G(!1,null,"Element not found",0)),t.status(n).json(r.toJson())})},function(e){console.error(e);var r="";"22P02"==e.code&&(r="Expected uiid");var n=new G(!1,null,r,0);t.status(400).json(n.toJson())});return Promise.resolve(i&&i.then?i.then(function(){}):void 0)}catch(e){return Promise.reject(e)}},r.saveEntidad=function(e,t,r){try{var n=this,i=ei(function(){var r=new n.service(null,n.table);return Promise.resolve(r.save(e.body)).then(function(r){var n=new G(!0,r&&r[0]||{id:e.body.id});t.setHeader("Location","/entity/"+n.data.id),t.status(201).json(n.toJson())})},function(e){r(e)});return Promise.resolve(i&&i.then?i.then(function(){}):void 0)}catch(e){return Promise.reject(e)}},r.updateEntidad=function(e,t,r){try{var n=this,i=ei(function(){var r=new n.service(null,n.table);return Promise.resolve(r.update(e.params.id,e.body)).then(function(r){var n=new G(!0,r&&r[0]||{id:e.body.id});t.json(n.toJson())})},function(e){r(e)});return Promise.resolve(i&&i.then?i.then(function(){}):void 0)}catch(e){return Promise.reject(e)}},r.deleteEntidad=function(e,t,r){try{var n=this,i=ei(function(){var r=new n.service(null,n.table);return Promise.resolve(r.delete(e.params.id)).then(function(e){var r=new G(!0,e);t.status(204).json(r.toJson())})},function(e){if(console.error(e),"NotFound"==e){var n=new G(!1,null,"Element not found",0);t.status(404).json(n.toJson())}else r(e)});return Promise.resolve(i&&i.then?i.then(function(){}):void 0)}catch(e){return Promise.reject(e)}},e}(),ri=/*#__PURE__*/function(){function e(e,t){this.dao=e?new e:new Zn,t&&(this.dao.tableName=t)}var t=e.prototype;return t.list=function(e,t,r){try{var n=this,i=t||0,o=r||1e3,s={};return Promise.resolve(n.dao.countFilteredData(e,i,o)).then(function(a){var u;function c(e){return u?e:Promise.resolve(n.dao.loadAllData(t,r)).then(function(e){return s.data=e,s})}s.total=a;var l=function(){if(e&&0!==Object.keys(e).length)return Promise.resolve(n.dao.loadFilteredData(e,i,o)).then(function(e){return s.data=e,u=1,s})}();return l&&l.then?l.then(c):c(l)})}catch(e){return Promise.reject(e)}},t.loadById=function(e){return this.dao.loadById(e)},t.save=function(e){return this.dao.save(e)},t.update=function(e,t){if(e)return this.dao.update(e,t)},t.delete=function(e){if(e)return this.dao.delete(e)},e}();function ni(e,t,r){if(!e.s){if(r instanceof ii){if(!r.s)return void(r.o=ni.bind(null,e,t));1&t&&(t=r.s),r=r.v}if(r&&r.then)return void r.then(ni.bind(null,e,t),ni.bind(null,e,2));e.s=t,e.v=r;var n=e.o;n&&n(e)}}const ii=/*#__PURE__*/function(){function e(){}return e.prototype.then=function(t,r){const n=new e,i=this.s;if(i){const e=1&i?t:r;if(e){try{ni(n,1,e(this.v))}catch(e){ni(n,2,e)}return n}return this}return this.o=function(e){try{const i=e.v;1&e.s?ni(n,1,t?t(i):i):r?ni(n,1,r(i)):ni(n,2,i)}catch(e){ni(n,2,e)}},n},e}();function oi(e){return e instanceof ii&&1&e.s}var si=new(/*#__PURE__*/function(){function e(){this.serverClass=Gn,this.clusterClass=Bn}var t=e.prototype;return t.runtime=function(e){return function(e){try{var t,r,n,i,o,s,a,u=T(j(process.argv)).usage("Como usar: \n            node $0 [options] \n            \n            ** Si no se especifican parmetros el servidor arrancar normalmente. **").alias("g","generateKeys").describe("g","Genera unas claves para la aplicacin").alias("c","encrypt").describe("c","Codifica el String proporcionado en base a la contrasea de .env").nargs("c",1).help("h").alias("h","help"),c=[];if(e)for(r=_(e);!(n=r()).done;)u.alias((i=n.value).key,i.alias),i.describe&&u.describe(i.key,i.describe),0!==i.nargs&&u.nargs(i.key,i.nargs),i.boolean&&u.boolean(i.key),i.choices&&u.choices(i.key,i.choices),i.required&&c.push(i.key);0!==c.length&&u.demandOption(c);var l=u.argv;return l.generateKeys?(console.log("Generando claves para encriptacin:"),console.log(C.generateKeys()),Promise.resolve(process.exit(1))):l.encrypt?(console.log("Resultado encryptacin:"),console.log(C.encrypt(l.encrypt)),Promise.resolve(process.exit(1))):Promise.resolve(function(){if(e)return o=_(e),function(e,t,r){for(var n;;){var i=e();if(oi(i)&&(i=i.v),!i)return o;if(i.then){n=0;break}var o=r();if(o&&o.then){if(!oi(o)){n=1;break}o=o.s}}var s=new ii,a=ni.bind(null,s,2);return(0===n?i.then(c):1===n?o.then(u):(void 0).then(function(){(i=e())?i.then?i.then(c).then(void 0,a):c(i):ni(s,1,o)})).then(void 0,a),s;function u(t){o=t;do{if(!(i=e())||oi(i)&&!i.v)return void ni(s,1,o);if(i.then)return void i.then(c).then(void 0,a);oi(o=r())&&(o=o.v)}while(!o||!o.then);o.then(u).then(void 0,a)}function c(e){e?(o=r())&&o.then?o.then(u).then(void 0,a):u(o):ni(s,1,o)}}(function(){return!t&&!(s=o()).done},0,function(){return a=s.value,function(){if(l[a.key])return Promise.resolve(a.fn(l)).then(function(){var e=process.exit(1);return t=1,e})}()})}())}catch(e){return Promise.reject(e)}}(e)},t.init=function(e){try{var t=function(){var t=new r.serverClass(e,r.statics,r.routes);return r.customizeExpress&&(t.customizeExpress=r.customizeExpress),r.beforeListen&&(t.beforeListen=r.beforeListen),r.afterListen&&(t.afterListen=r.afterListen),r.events=new Mn(r),r.i18n=new F(null==e?void 0:e.disableI18nWatcher),Promise.resolve(r.i18n.load()).then(function(){r.server=new r.clusterClass(r),r.server.setServerCls(t),r.server.executeOnlyMain=function(){r.executeOnlyMain&&r.executeOnlyMain(),"true"==process.env.REPL_ENABLED&&r.startRepl()}})},r=this,n=function(){if("true"!=process.env.DISABLE_LOGGER)return Promise.resolve(Hn.configure()).then(function(){})}();return Promise.resolve(n&&n.then?n.then(t):t())}catch(e){return Promise.reject(e)}},t.start=function(){try{if(!this.server)throw new Error("Call init first");return Promise.resolve(this.server.start()).then(function(){})}catch(e){return Promise.reject(e)}},t.startRepl=function(){var e=this;try{O.createServer(function(t){var r=N.start({prompt:"lisco::remote> ",input:t,output:t,terminal:!0,useColors:!0,preview:!1});r.context.app=e,r.context.Utils=C,r.context.db=qn.connection,r.on("exit",t.end.bind(t))}).listen(process.env.REPL_PORT||5001)}catch(e){console.log("Remote REPL Conn: "+e)}console.log("Remote REPL started on port "+(process.env.REPL_PORT||5001))},e}());export{si as App,Xn as AuthController,ti as BaseController,Zn as BaseKnexDao,ri as BaseService,Bn as ClusterServer,Wn as CookieAuthHandler,Mn as EventHandler,F as I18nLoader,zn as IAuthHandler,Qn as IUserDao,G as JsonResponse,Jn as JwtAuthHandler,qn as KnexConnector,Yn as KnexFilterParser,Hn as Logger,Gn as Server,Fn as TokenGenerator,C as Utils};
//# sourceMappingURL=lisco.esm.js.map
