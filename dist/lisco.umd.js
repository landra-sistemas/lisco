!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("helmet"),require("express"),require("compression"),require("cors"),require("express-fileupload"),require("url"),require("lodash"),require("fs"),require("util"),require("crypto"),require("chokidar"),require("buffer"),require("stream"),require("uuid"),require("http"),require("https"),require("path"),require("cluster"),require("socket.io"),require("os"),require("events"),require("cluster-messages"),require("log4js"),require("path-to-regexp"),require("moment"),require("@landra_sistemas/fql-parser"),require("knex"),require("net"),require("repl"),require("yargs/yargs"),require("yargs/helpers")):"function"==typeof define&&define.amd?define(["exports","helmet","express","compression","cors","express-fileupload","url","lodash","fs","util","crypto","chokidar","buffer","stream","uuid","http","https","path","cluster","socket.io","os","events","cluster-messages","log4js","path-to-regexp","moment","@landra_sistemas/fql-parser","knex","net","repl","yargs/yargs","yargs/helpers"],t):t((e||self).lisco={},e.helmet,e.express,e.compression,e.cors,e.expressFileupload,e.url,e.lodash,e.fs,e.util,e.crypto,e.chokidar,e.buffer,e.Stream,e.uuid,e.http,e.https,e.path,e.cluster,e.socket_io,e.os,e.events,e.clusterMessages,e.log4Js,e.pathToRegexp,e.moment,e.fqlParser,e.knex,e.net,e.repl,e.yargs,e.helpers)}(this,function(e,t,r,n,i,s,o,a,u,c,l,f,h,p,d,v,m,y,g,E,w,b,S,R,I,A,P,O,$,N,j,T){function L(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}function x(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach(function(r){if("default"!==r){var n=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(t,r,n.get?n:{enumerable:!0,get:function(){return e[r]}})}}),t.default=e,t}var k=/*#__PURE__*/L(t),D=/*#__PURE__*/L(r),_=/*#__PURE__*/L(n),C=/*#__PURE__*/L(i),F=/*#__PURE__*/L(s),G=/*#__PURE__*/L(o),B=/*#__PURE__*/L(a),M=/*#__PURE__*/L(u),U=/*#__PURE__*/L(c),K=/*#__PURE__*/L(l),q=/*#__PURE__*/L(f),H=/*#__PURE__*/L(h),V=/*#__PURE__*/L(p),J=/*#__PURE__*/x(d),X=/*#__PURE__*/L(v),z=/*#__PURE__*/L(m),W=/*#__PURE__*/L(y),Y=/*#__PURE__*/L(g),Z=/*#__PURE__*/L(w),Q=/*#__PURE__*/L(S),ee=/*#__PURE__*/L(R),te=/*#__PURE__*/L(A),re=/*#__PURE__*/L(O),ne=/*#__PURE__*/L($),ie=/*#__PURE__*/L(N),se=/*#__PURE__*/L(j);function oe(){return oe=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},oe.apply(this,arguments)}function ae(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,ue(e,t)}function ue(e,t){return ue=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},ue(e,t)}function ce(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function le(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(r)return(r=r.call(e)).next.bind(r);if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return ce(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?ce(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0;return function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var fe=/*#__PURE__*/function(){function e(){}return e.arrayToLower=function(e){return e.join("~").toLowerCase().split("~")},e.replaceAll=function(e,t,r){return e.replace(new RegExp(t.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&"),"g"),r)},e.encrypt=function(e){var t=Buffer.from(process.env.CRYPT_SECRET,"hex"),r=Buffer.from(process.env.CRYPT_IV,"hex"),n=K.default.createCipheriv("aes-256-cbc",t,r),i=n.update(e);return(i=Buffer.concat([i,n.final()])).toString("hex")},e.decrypt=function(e){var t=Buffer.from(process.env.CRYPT_SECRET,"hex"),r=Buffer.from(process.env.CRYPT_IV,"hex"),n=Buffer.from(e,"hex"),i=K.default.createDecipheriv("aes-256-cbc",t,r),s=i.update(n);return(s=Buffer.concat([s,i.final()])).toString()},e.sleep=function(e){return U.default.promisify(setTimeout)(e)},e.generateKeys=function(){return{key:K.default.randomBytes(32).toString("hex"),iv:K.default.randomBytes(16).toString("hex")}},e.flattenObject=function(t){var r,n={};for(var i in t)if(t.hasOwnProperty(i))if(t[i]&&Array===t[i].constructor)n[i]=t[i];else if("object"==typeof t[i])for(var s in r=e.flattenObject(t[i]))r.hasOwnProperty(s)&&(r[s]&&Array===r.constructor||(n[i+(isNaN(s)?"."+s:"")]=r[s]));else n[i]=t[i];return n},e.unflatten=function(e){var t={};for(var r in e){var n=r.split(".");n.reduce(function(t,i,s){return t[i]||(t[i]=isNaN(Number(n[s+1]))?n.length-1==s?e[r]:{}:[])},t)}return t},e.expressHandler=function(){return function(e){return function(){var t=[].slice.call(arguments),r=e.apply(void 0,t),n=t[t.length-1];return Promise.resolve(r).catch(function(e){return n(e)})}}},e}(),he=/*#__PURE__*/function(){function e(e){this.watcher={},this.disableWatchers=e}var t=e.prototype;return t.load=function(e){try{var t=this,r=e||process.env.DEFAULT_LANG;t.currentData||(t.currentData={}),t.currentDataFlat||(t.currentDataFlat={});var n=process.cwd()+"/i18n/lang_"+r+".json";return t.disableWatchers||(t.watcher[r]=q.default.watch(n,{ignored:/(^|[/\\])\../,persistent:!0}),t.watcher[r].on("change",function(e){return t.loadFile(e,r)})),Promise.resolve(t.loadFile(n,r)).then(function(){})}catch(e){return Promise.reject(e)}},t.loadFile=function(e,t){try{var r=this,n=U.default.promisify(M.default.readFile);return Promise.resolve(function(i,s){try{var o=Promise.resolve(n(e,"utf8")).then(function(e){var n=JSON.parse(e);r.currentDataFlat[t]=fe.flattenObject(n),r.currentData[t]=n})}catch(e){return s(e)}return o&&o.then?o.then(void 0,s):o}(0,function(e){if("ENOENT"===(null==e?void 0:e.code))return console.log("Lang file does not exist. Create it on ./i18n/lang_{xx}.json");console.error(e)}))}catch(e){return Promise.reject(e)}},t.translate=function(e,t){try{var r,n=function(t){return r?t:"undefined."+e},i=this;if(t||(t=process.env.DEFAULT_LANG),i.currentDataFlat&&i.currentDataFlat[t]&&i.currentDataFlat[t][e])return Promise.resolve(i.currentData[t][e]);var s=function(){if(!i.currentDataFlat||!i.currentDataFlat[t])return Promise.resolve(i.load(t)).then(function(){if(i.currentDataFlat&&i.currentDataFlat[t]&&i.currentDataFlat[e])return r=1,i.currentDataFlat[t][e]})}();return Promise.resolve(s&&s.then?s.then(n):n(s))}catch(e){return Promise.reject(e)}},e}(),pe=/*#__PURE__*/function(){function e(e,t,r,n){this.data=t,this.success=e,this.total=n,this.message=r||""}return e.prototype.toJson=function(){return this},e}();function de(e){var t={exports:{}};return e(t,t.exports),t.exports}var ve=de(function(e,t){var r=H.default.Buffer;function n(e,t){for(var r in e)t[r]=e[r]}function i(e,t,n){return r(e,t,n)}r.from&&r.alloc&&r.allocUnsafe&&r.allocUnsafeSlow?e.exports=H.default:(n(H.default,t),t.Buffer=i),n(r,i),i.from=function(e,t,n){if("number"==typeof e)throw new TypeError("Argument must not be a number");return r(e,t,n)},i.alloc=function(e,t,n){if("number"!=typeof e)throw new TypeError("Argument must be a number");var i=r(e);return void 0!==t?"string"==typeof n?i.fill(t,n):i.fill(t):i.fill(0),i},i.allocUnsafe=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return r(e)},i.allocUnsafeSlow=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return H.default.SlowBuffer(e)}}),me=ve.Buffer;function ye(e){if(this.buffer=null,this.writable=!0,this.readable=!0,!e)return this.buffer=me.alloc(0),this;if("function"==typeof e.pipe)return this.buffer=me.alloc(0),e.pipe(this),this;if(e.length||"object"==typeof e)return this.buffer=e,this.writable=!1,process.nextTick(function(){this.emit("end",e),this.readable=!1,this.emit("close")}.bind(this)),this;throw new TypeError("Unexpected data type ("+typeof e+")")}U.default.inherits(ye,V.default),ye.prototype.write=function(e){this.buffer=me.concat([this.buffer,me.from(e)]),this.emit("data",e)},ye.prototype.end=function(e){e&&this.write(e),this.emit("end",e),this.emit("close"),this.writable=!1,this.readable=!1};var ge=ye,Ee=H.default.Buffer,we=H.default.SlowBuffer,be=Se;function Se(e,t){if(!Ee.isBuffer(e)||!Ee.isBuffer(t))return!1;if(e.length!==t.length)return!1;for(var r=0,n=0;n<e.length;n++)r|=e[n]^t[n];return 0===r}Se.install=function(){Ee.prototype.equal=we.prototype.equal=function(e){return Se(this,e)}};var Re=Ee.prototype.equal,Ie=we.prototype.equal;function Ae(e){return(e/8|0)+(e%8==0?0:1)}Se.restore=function(){Ee.prototype.equal=Re,we.prototype.equal=Ie};var Pe={ES256:Ae(256),ES384:Ae(384),ES512:Ae(521)},Oe=function(e){var t=Pe[e];if(t)return t;throw new Error('Unknown algorithm "'+e+'"')},$e=ve.Buffer;function Ne(e){if($e.isBuffer(e))return e;if("string"==typeof e)return $e.from(e,"base64");throw new TypeError("ECDSA signature must be a Base64 string or a Buffer")}function je(e,t,r){for(var n=0;t+n<r&&0===e[t+n];)++n;return e[t+n]>=128&&--n,n}var Te=function(e,t){e=Ne(e);var r=Oe(t),n=r+1,i=e.length,s=0;if(48!==e[s++])throw new Error('Could not find expected "seq"');var o=e[s++];if(129===o&&(o=e[s++]),i-s<o)throw new Error('"seq" specified length of "'+o+'", only "'+(i-s)+'" remaining');if(2!==e[s++])throw new Error('Could not find expected "int" for "r"');var a=e[s++];if(i-s-2<a)throw new Error('"r" specified length of "'+a+'", only "'+(i-s-2)+'" available');if(n<a)throw new Error('"r" specified length of "'+a+'", max of "'+n+'" is acceptable');var u=s;if(s+=a,2!==e[s++])throw new Error('Could not find expected "int" for "s"');var c=e[s++];if(i-s!==c)throw new Error('"s" specified length of "'+c+'", expected "'+(i-s)+'"');if(n<c)throw new Error('"s" specified length of "'+c+'", max of "'+n+'" is acceptable');var l=s;if((s+=c)!==i)throw new Error('Expected to consume entire buffer, but "'+(i-s)+'" bytes remain');var f=r-a,h=r-c,p=$e.allocUnsafe(f+a+h+c);for(s=0;s<f;++s)p[s]=0;e.copy(p,s,u+Math.max(-f,0),u+a);for(var d=s=r;s<d+h;++s)p[s]=0;return e.copy(p,s,l+Math.max(-h,0),l+c),(p=p.toString("base64")).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")},Le=ve.Buffer,xe="secret must be a string or buffer",ke="key must be a string or a buffer",De="function"==typeof K.default.createPublicKey;function _e(e){if(!Le.isBuffer(e)&&"string"!=typeof e){if(!De)throw Be(ke);if("object"!=typeof e)throw Be(ke);if("string"!=typeof e.type)throw Be(ke);if("string"!=typeof e.asymmetricKeyType)throw Be(ke);if("function"!=typeof e.export)throw Be(ke)}}function Ce(e){if(!Le.isBuffer(e)&&"string"!=typeof e&&"object"!=typeof e)throw Be("key must be a string, a buffer or an object")}function Fe(e){return e.replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function Ge(e){var t=4-(e=e.toString()).length%4;if(4!==t)for(var r=0;r<t;++r)e+="=";return e.replace(/\-/g,"+").replace(/_/g,"/")}function Be(e){var t=[].slice.call(arguments,1),r=U.default.format.bind(U.default,e).apply(null,t);return new TypeError(r)}function Me(e){var t;return Le.isBuffer(t=e)||"string"==typeof t||(e=JSON.stringify(e)),e}function Ue(e){return function(t,r){!function(e){if(!Le.isBuffer(e)){if("string"==typeof e)return e;if(!De)throw Be(xe);if("object"!=typeof e)throw Be(xe);if("secret"!==e.type)throw Be(xe);if("function"!=typeof e.export)throw Be(xe)}}(r),t=Me(t);var n=K.default.createHmac("sha"+e,r);return Fe((n.update(t),n.digest("base64")))}}function Ke(e){return function(t,r,n){var i=Ue(e)(t,n);return be(Le.from(r),Le.from(i))}}function qe(e){return function(t,r){Ce(r),t=Me(t);var n=K.default.createSign("RSA-SHA"+e);return Fe((n.update(t),n.sign(r,"base64")))}}function He(e){return function(t,r,n){_e(n),t=Me(t),r=Ge(r);var i=K.default.createVerify("RSA-SHA"+e);return i.update(t),i.verify(n,r,"base64")}}function Ve(e){return function(t,r){Ce(r),t=Me(t);var n=K.default.createSign("RSA-SHA"+e);return Fe((n.update(t),n.sign({key:r,padding:K.default.constants.RSA_PKCS1_PSS_PADDING,saltLength:K.default.constants.RSA_PSS_SALTLEN_DIGEST},"base64")))}}function Je(e){return function(t,r,n){_e(n),t=Me(t),r=Ge(r);var i=K.default.createVerify("RSA-SHA"+e);return i.update(t),i.verify({key:n,padding:K.default.constants.RSA_PKCS1_PSS_PADDING,saltLength:K.default.constants.RSA_PSS_SALTLEN_DIGEST},r,"base64")}}function Xe(e){var t=qe(e);return function(){var r=t.apply(null,arguments);return Te(r,"ES"+e)}}function ze(e){var t=He(e);return function(r,n,i){return n=function(e,t){e=Ne(e);var r=Oe(t),n=e.length;if(n!==2*r)throw new TypeError('"'+t+'" signatures must be "'+2*r+'" bytes, saw "'+n+'"');var i=je(e,0,r),s=je(e,r,e.length),o=r-i,a=r-s,u=2+o+1+1+a,c=u<128,l=$e.allocUnsafe((c?2:3)+u),f=0;return l[f++]=48,c?l[f++]=u:(l[f++]=129,l[f++]=255&u),l[f++]=2,l[f++]=o,i<0?(l[f++]=0,f+=e.copy(l,f,0,r)):f+=e.copy(l,f,i,r),l[f++]=2,l[f++]=a,s<0?(l[f++]=0,e.copy(l,f,r)):e.copy(l,f,r+s),l}(n,"ES"+e).toString("base64"),t(r,n,i)}}function We(){return function(){return""}}function Ye(){return function(e,t){return""===t}}De&&(ke+=" or a KeyObject",xe+="or a KeyObject");var Ze=function(e){var t={hs:Ue,rs:qe,ps:Ve,es:Xe,none:We},r={hs:Ke,rs:He,ps:Je,es:ze,none:Ye},n=e.match(/^(RS|PS|ES|HS)(256|384|512)$|^(none)$/i);if(!n)throw Be('"%s" is not a valid algorithm.\n  Supported algorithms are:\n  "HS256", "HS384", "HS512", "RS256", "RS384", "RS512", "PS256", "PS384", "PS512", "ES256", "ES384", "ES512" and "none".',e);var i=(n[1]||n[3]).toLowerCase(),s=n[2];return{sign:t[i](s),verify:r[i](s)}},Qe=H.default.Buffer,et=function(e){return"string"==typeof e?e:"number"==typeof e||Qe.isBuffer(e)?e.toString():JSON.stringify(e)},tt=ve.Buffer;function rt(e,t){return tt.from(e,t).toString("base64").replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function nt(e){var t=e.header,r=e.payload,n=e.secret||e.privateKey,i=e.encoding,s=Ze(t.alg),o=function(e,t,r){r=r||"utf8";var n=rt(et(e),"binary"),i=rt(et(t),r);return U.default.format("%s.%s",n,i)}(t,r,i),a=s.sign(o,n);return U.default.format("%s.%s",o,a)}function it(e){var t=new ge(e.secret||e.privateKey||e.key);this.readable=!0,this.header=e.header,this.encoding=e.encoding,this.secret=this.privateKey=this.key=t,this.payload=new ge(e.payload),this.secret.once("close",function(){!this.payload.writable&&this.readable&&this.sign()}.bind(this)),this.payload.once("close",function(){!this.secret.writable&&this.readable&&this.sign()}.bind(this))}U.default.inherits(it,V.default),it.prototype.sign=function(){try{var e=nt({header:this.header,payload:this.payload.buffer,secret:this.secret.buffer,encoding:this.encoding});return this.emit("done",e),this.emit("data",e),this.emit("end"),this.readable=!1,e}catch(e){this.readable=!1,this.emit("error",e),this.emit("close")}},it.sign=nt;var st=it,ot=ve.Buffer,at=/^[a-zA-Z0-9\-_]+?\.[a-zA-Z0-9\-_]+?\.([a-zA-Z0-9\-_]+)?$/;function ut(e){var t=e.split(".",1)[0];return function(e){if(function(e){return"[object Object]"===Object.prototype.toString.call(e)}(e))return e;try{return JSON.parse(e)}catch(e){return}}(ot.from(t,"base64").toString("binary"))}function ct(e){return e.split(".")[2]}function lt(e){return at.test(e)&&!!ut(e)}function ft(e,t,r){if(!t){var n=new Error("Missing algorithm parameter for jws.verify");throw n.code="MISSING_ALGORITHM",n}var i=ct(e=et(e)),s=function(e){return e.split(".",2).join(".")}(e);return Ze(t).verify(s,i,r)}function ht(e,t){if(t=t||{},!lt(e=et(e)))return null;var r=ut(e);if(!r)return null;var n=function(e,t){t=t||"utf8";var r=e.split(".")[1];return ot.from(r,"base64").toString(t)}(e);return("JWT"===r.typ||t.json)&&(n=JSON.parse(n,t.encoding)),{header:r,payload:n,signature:ct(e)}}function pt(e){var t=new ge((e=e||{}).secret||e.publicKey||e.key);this.readable=!0,this.algorithm=e.algorithm,this.encoding=e.encoding,this.secret=this.publicKey=this.key=t,this.signature=new ge(e.signature),this.secret.once("close",function(){!this.signature.writable&&this.readable&&this.verify()}.bind(this)),this.signature.once("close",function(){!this.secret.writable&&this.readable&&this.verify()}.bind(this))}U.default.inherits(pt,V.default),pt.prototype.verify=function(){try{var e=ft(this.signature.buffer,this.algorithm,this.key.buffer),t=ht(this.signature.buffer,this.encoding);return this.emit("done",e,t),this.emit("data",e),this.emit("end"),this.readable=!1,e}catch(e){this.readable=!1,this.emit("error",e),this.emit("close")}},pt.decode=ht,pt.isValid=lt,pt.verify=ft;var dt=pt,vt={ALGORITHMS:["HS256","HS384","HS512","RS256","RS384","RS512","PS256","PS384","PS512","ES256","ES384","ES512"],sign:st.sign,verify:dt.verify,decode:dt.decode,isValid:dt.isValid,createSign:function(e){return new st(e)},createVerify:function(e){return new dt(e)}},mt=function(e,t){Error.call(this,e),Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor),this.name="JsonWebTokenError",this.message=e,t&&(this.inner=t)};(mt.prototype=Object.create(Error.prototype)).constructor=mt;var yt=mt,gt=function(e,t){yt.call(this,e),this.name="NotBeforeError",this.date=t};(gt.prototype=Object.create(yt.prototype)).constructor=gt;var Et=gt,wt=function(e,t){yt.call(this,e),this.name="TokenExpiredError",this.expiredAt=t};(wt.prototype=Object.create(yt.prototype)).constructor=wt;var bt=wt,St=1e3,Rt=60*St,It=60*Rt,At=24*It;function Pt(e,t,r,n){var i=t>=1.5*r;return Math.round(e/r)+" "+n+(i?"s":"")}var Ot=function(e,t){var r=t||Math.floor(Date.now()/1e3);if("string"==typeof e){var n=function(e,t){t=t||{};var r,n,i=typeof e;if("string"===i&&e.length>0)return function(e){if(!((e=String(e)).length>100)){var t=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(t){var r=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*r;case"weeks":case"week":case"w":return 6048e5*r;case"days":case"day":case"d":return r*At;case"hours":case"hour":case"hrs":case"hr":case"h":return r*It;case"minutes":case"minute":case"mins":case"min":case"m":return r*Rt;case"seconds":case"second":case"secs":case"sec":case"s":return r*St;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return r;default:return}}}}(e);if("number"===i&&isFinite(e))return t.long?(r=e,(n=Math.abs(r))>=At?Pt(r,n,At,"day"):n>=It?Pt(r,n,It,"hour"):n>=Rt?Pt(r,n,Rt,"minute"):n>=St?Pt(r,n,St,"second"):r+" ms"):function(e){var t=Math.abs(e);return t>=At?Math.round(e/At)+"d":t>=It?Math.round(e/It)+"h":t>=Rt?Math.round(e/Rt)+"m":t>=St?Math.round(e/St)+"s":e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}(e);if(void 0===n)return;return Math.floor(r+n/1e3)}return"number"==typeof e?r+e:void 0},$t={MAX_LENGTH:256,MAX_SAFE_COMPONENT_LENGTH:16,MAX_SAFE_BUILD_LENGTH:250,MAX_SAFE_INTEGER:Number.MAX_SAFE_INTEGER||9007199254740991,RELEASE_TYPES:["major","premajor","minor","preminor","patch","prepatch","prerelease"],SEMVER_SPEC_VERSION:"2.0.0",FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2},Nt="object"==typeof process&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG)?(...e)=>console.error("SEMVER",...e):()=>{},jt=de(function(e,t){const{MAX_SAFE_COMPONENT_LENGTH:r,MAX_SAFE_BUILD_LENGTH:n,MAX_LENGTH:i}=$t,s=(t=e.exports={}).re=[],o=t.safeRe=[],a=t.src=[],u=t.t={};let c=0;const l=[["\\s",1],["\\d",i],["[a-zA-Z0-9-]",n]],f=(e,t,r)=>{const n=(e=>{for(const[t,r]of l)e=e.split(`${t}*`).join(`${t}{0,${r}}`).split(`${t}+`).join(`${t}{1,${r}}`);return e})(t),i=c++;Nt(e,i,t),u[e]=i,a[i]=t,s[i]=new RegExp(t,r?"g":void 0),o[i]=new RegExp(n,r?"g":void 0)};f("NUMERICIDENTIFIER","0|[1-9]\\d*"),f("NUMERICIDENTIFIERLOOSE","\\d+"),f("NONNUMERICIDENTIFIER","\\d*[a-zA-Z-][a-zA-Z0-9-]*"),f("MAINVERSION",`(${a[u.NUMERICIDENTIFIER]})\\.(${a[u.NUMERICIDENTIFIER]})\\.(${a[u.NUMERICIDENTIFIER]})`),f("MAINVERSIONLOOSE",`(${a[u.NUMERICIDENTIFIERLOOSE]})\\.(${a[u.NUMERICIDENTIFIERLOOSE]})\\.(${a[u.NUMERICIDENTIFIERLOOSE]})`),f("PRERELEASEIDENTIFIER",`(?:${a[u.NUMERICIDENTIFIER]}|${a[u.NONNUMERICIDENTIFIER]})`),f("PRERELEASEIDENTIFIERLOOSE",`(?:${a[u.NUMERICIDENTIFIERLOOSE]}|${a[u.NONNUMERICIDENTIFIER]})`),f("PRERELEASE",`(?:-(${a[u.PRERELEASEIDENTIFIER]}(?:\\.${a[u.PRERELEASEIDENTIFIER]})*))`),f("PRERELEASELOOSE",`(?:-?(${a[u.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${a[u.PRERELEASEIDENTIFIERLOOSE]})*))`),f("BUILDIDENTIFIER","[a-zA-Z0-9-]+"),f("BUILD",`(?:\\+(${a[u.BUILDIDENTIFIER]}(?:\\.${a[u.BUILDIDENTIFIER]})*))`),f("FULLPLAIN",`v?${a[u.MAINVERSION]}${a[u.PRERELEASE]}?${a[u.BUILD]}?`),f("FULL",`^${a[u.FULLPLAIN]}$`),f("LOOSEPLAIN",`[v=\\s]*${a[u.MAINVERSIONLOOSE]}${a[u.PRERELEASELOOSE]}?${a[u.BUILD]}?`),f("LOOSE",`^${a[u.LOOSEPLAIN]}$`),f("GTLT","((?:<|>)?=?)"),f("XRANGEIDENTIFIERLOOSE",`${a[u.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`),f("XRANGEIDENTIFIER",`${a[u.NUMERICIDENTIFIER]}|x|X|\\*`),f("XRANGEPLAIN",`[v=\\s]*(${a[u.XRANGEIDENTIFIER]})(?:\\.(${a[u.XRANGEIDENTIFIER]})(?:\\.(${a[u.XRANGEIDENTIFIER]})(?:${a[u.PRERELEASE]})?${a[u.BUILD]}?)?)?`),f("XRANGEPLAINLOOSE",`[v=\\s]*(${a[u.XRANGEIDENTIFIERLOOSE]})(?:\\.(${a[u.XRANGEIDENTIFIERLOOSE]})(?:\\.(${a[u.XRANGEIDENTIFIERLOOSE]})(?:${a[u.PRERELEASELOOSE]})?${a[u.BUILD]}?)?)?`),f("XRANGE",`^${a[u.GTLT]}\\s*${a[u.XRANGEPLAIN]}$`),f("XRANGELOOSE",`^${a[u.GTLT]}\\s*${a[u.XRANGEPLAINLOOSE]}$`),f("COERCE",`(^|[^\\d])(\\d{1,${r}})(?:\\.(\\d{1,${r}}))?(?:\\.(\\d{1,${r}}))?(?:$|[^\\d])`),f("COERCERTL",a[u.COERCE],!0),f("LONETILDE","(?:~>?)"),f("TILDETRIM",`(\\s*)${a[u.LONETILDE]}\\s+`,!0),t.tildeTrimReplace="$1~",f("TILDE",`^${a[u.LONETILDE]}${a[u.XRANGEPLAIN]}$`),f("TILDELOOSE",`^${a[u.LONETILDE]}${a[u.XRANGEPLAINLOOSE]}$`),f("LONECARET","(?:\\^)"),f("CARETTRIM",`(\\s*)${a[u.LONECARET]}\\s+`,!0),t.caretTrimReplace="$1^",f("CARET",`^${a[u.LONECARET]}${a[u.XRANGEPLAIN]}$`),f("CARETLOOSE",`^${a[u.LONECARET]}${a[u.XRANGEPLAINLOOSE]}$`),f("COMPARATORLOOSE",`^${a[u.GTLT]}\\s*(${a[u.LOOSEPLAIN]})$|^$`),f("COMPARATOR",`^${a[u.GTLT]}\\s*(${a[u.FULLPLAIN]})$|^$`),f("COMPARATORTRIM",`(\\s*)${a[u.GTLT]}\\s*(${a[u.LOOSEPLAIN]}|${a[u.XRANGEPLAIN]})`,!0),t.comparatorTrimReplace="$1$2$3",f("HYPHENRANGE",`^\\s*(${a[u.XRANGEPLAIN]})\\s+-\\s+(${a[u.XRANGEPLAIN]})\\s*$`),f("HYPHENRANGELOOSE",`^\\s*(${a[u.XRANGEPLAINLOOSE]})\\s+-\\s+(${a[u.XRANGEPLAINLOOSE]})\\s*$`),f("STAR","(<|>)?=?\\s*\\*"),f("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$"),f("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")});const Tt=Object.freeze({loose:!0}),Lt=Object.freeze({});var xt=e=>e?"object"!=typeof e?Tt:e:Lt;const kt=/^[0-9]+$/,Dt=(e,t)=>{const r=kt.test(e),n=kt.test(t);return r&&n&&(e=+e,t=+t),e===t?0:r&&!n?-1:n&&!r?1:e<t?-1:1};var _t={compareIdentifiers:Dt,rcompareIdentifiers:(e,t)=>Dt(t,e)};const{MAX_LENGTH:Ct,MAX_SAFE_INTEGER:Ft}=$t,{safeRe:Gt,t:Bt}=jt,{compareIdentifiers:Mt}=_t;class Ut{constructor(e,t){if(t=xt(t),e instanceof Ut){if(e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease)return e;e=e.version}else if("string"!=typeof e)throw new TypeError(`Invalid version. Must be a string. Got type "${typeof e}".`);if(e.length>Ct)throw new TypeError(`version is longer than ${Ct} characters`);Nt("SemVer",e,t),this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease;const r=e.trim().match(t.loose?Gt[Bt.LOOSE]:Gt[Bt.FULL]);if(!r)throw new TypeError(`Invalid Version: ${e}`);if(this.raw=e,this.major=+r[1],this.minor=+r[2],this.patch=+r[3],this.major>Ft||this.major<0)throw new TypeError("Invalid major version");if(this.minor>Ft||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>Ft||this.patch<0)throw new TypeError("Invalid patch version");this.prerelease=r[4]?r[4].split(".").map(e=>{if(/^[0-9]+$/.test(e)){const t=+e;if(t>=0&&t<Ft)return t}return e}):[],this.build=r[5]?r[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(e){if(Nt("SemVer.compare",this.version,this.options,e),!(e instanceof Ut)){if("string"==typeof e&&e===this.version)return 0;e=new Ut(e,this.options)}return e.version===this.version?0:this.compareMain(e)||this.comparePre(e)}compareMain(e){return e instanceof Ut||(e=new Ut(e,this.options)),Mt(this.major,e.major)||Mt(this.minor,e.minor)||Mt(this.patch,e.patch)}comparePre(e){if(e instanceof Ut||(e=new Ut(e,this.options)),this.prerelease.length&&!e.prerelease.length)return-1;if(!this.prerelease.length&&e.prerelease.length)return 1;if(!this.prerelease.length&&!e.prerelease.length)return 0;let t=0;do{const r=this.prerelease[t],n=e.prerelease[t];if(Nt("prerelease compare",t,r,n),void 0===r&&void 0===n)return 0;if(void 0===n)return 1;if(void 0===r)return-1;if(r!==n)return Mt(r,n)}while(++t)}compareBuild(e){e instanceof Ut||(e=new Ut(e,this.options));let t=0;do{const r=this.build[t],n=e.build[t];if(Nt("prerelease compare",t,r,n),void 0===r&&void 0===n)return 0;if(void 0===n)return 1;if(void 0===r)return-1;if(r!==n)return Mt(r,n)}while(++t)}inc(e,t,r){switch(e){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",t,r);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",t,r);break;case"prepatch":this.prerelease.length=0,this.inc("patch",t,r),this.inc("pre",t,r);break;case"prerelease":0===this.prerelease.length&&this.inc("patch",t,r),this.inc("pre",t,r);break;case"major":0===this.minor&&0===this.patch&&0!==this.prerelease.length||this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":0===this.patch&&0!==this.prerelease.length||this.minor++,this.patch=0,this.prerelease=[];break;case"patch":0===this.prerelease.length&&this.patch++,this.prerelease=[];break;case"pre":{const e=Number(r)?1:0;if(!t&&!1===r)throw new Error("invalid increment argument: identifier is empty");if(0===this.prerelease.length)this.prerelease=[e];else{let n=this.prerelease.length;for(;--n>=0;)"number"==typeof this.prerelease[n]&&(this.prerelease[n]++,n=-2);if(-1===n){if(t===this.prerelease.join(".")&&!1===r)throw new Error("invalid increment argument: identifier already exists");this.prerelease.push(e)}}if(t){let n=[t,e];!1===r&&(n=[t]),0===Mt(this.prerelease[0],t)?isNaN(this.prerelease[1])&&(this.prerelease=n):this.prerelease=n}break}default:throw new Error(`invalid increment argument: ${e}`)}return this.raw=this.format(),this.build.length&&(this.raw+=`+${this.build.join(".")}`),this}}var Kt=Ut,qt=(e,t,r)=>new Kt(e,r).compare(new Kt(t,r)),Ht=(e,t,r,n)=>{switch(t){case"===":return"object"==typeof e&&(e=e.version),"object"==typeof r&&(r=r.version),e===r;case"!==":return"object"==typeof e&&(e=e.version),"object"==typeof r&&(r=r.version),e!==r;case"":case"=":case"==":return((e,t,r)=>0===qt(e,t,r))(e,r,n);case"!=":return((e,t,r)=>0!==qt(e,t,r))(e,r,n);case">":return((e,t,r)=>qt(e,t,r)>0)(e,r,n);case">=":return((e,t,r)=>qt(e,t,r)>=0)(e,r,n);case"<":return((e,t,r)=>qt(e,t,r)<0)(e,r,n);case"<=":return((e,t,r)=>qt(e,t,r)<=0)(e,r,n);default:throw new TypeError(`Invalid operator: ${t}`)}},Vt=Jt;function Jt(e){var t=this;if(t instanceof Jt||(t=new Jt),t.tail=null,t.head=null,t.length=0,e&&"function"==typeof e.forEach)e.forEach(function(e){t.push(e)});else if(arguments.length>0)for(var r=0,n=arguments.length;r<n;r++)t.push(arguments[r]);return t}function Xt(e,t,r){var n=t===e.head?new Yt(r,null,t,e):new Yt(r,t,t.next,e);return null===n.next&&(e.tail=n),null===n.prev&&(e.head=n),e.length++,n}function zt(e,t){e.tail=new Yt(t,e.tail,null,e),e.head||(e.head=e.tail),e.length++}function Wt(e,t){e.head=new Yt(t,null,e.head,e),e.tail||(e.tail=e.head),e.length++}function Yt(e,t,r,n){if(!(this instanceof Yt))return new Yt(e,t,r,n);this.list=n,this.value=e,t?(t.next=this,this.prev=t):this.prev=null,r?(r.prev=this,this.next=r):this.next=null}Jt.Node=Yt,Jt.create=Jt,Jt.prototype.removeNode=function(e){if(e.list!==this)throw new Error("removing node which does not belong to this list");var t=e.next,r=e.prev;return t&&(t.prev=r),r&&(r.next=t),e===this.head&&(this.head=t),e===this.tail&&(this.tail=r),e.list.length--,e.next=null,e.prev=null,e.list=null,t},Jt.prototype.unshiftNode=function(e){if(e!==this.head){e.list&&e.list.removeNode(e);var t=this.head;e.list=this,e.next=t,t&&(t.prev=e),this.head=e,this.tail||(this.tail=e),this.length++}},Jt.prototype.pushNode=function(e){if(e!==this.tail){e.list&&e.list.removeNode(e);var t=this.tail;e.list=this,e.prev=t,t&&(t.next=e),this.tail=e,this.head||(this.head=e),this.length++}},Jt.prototype.push=function(){for(var e=0,t=arguments.length;e<t;e++)zt(this,arguments[e]);return this.length},Jt.prototype.unshift=function(){for(var e=0,t=arguments.length;e<t;e++)Wt(this,arguments[e]);return this.length},Jt.prototype.pop=function(){if(this.tail){var e=this.tail.value;return this.tail=this.tail.prev,this.tail?this.tail.next=null:this.head=null,this.length--,e}},Jt.prototype.shift=function(){if(this.head){var e=this.head.value;return this.head=this.head.next,this.head?this.head.prev=null:this.tail=null,this.length--,e}},Jt.prototype.forEach=function(e,t){t=t||this;for(var r=this.head,n=0;null!==r;n++)e.call(t,r.value,n,this),r=r.next},Jt.prototype.forEachReverse=function(e,t){t=t||this;for(var r=this.tail,n=this.length-1;null!==r;n--)e.call(t,r.value,n,this),r=r.prev},Jt.prototype.get=function(e){for(var t=0,r=this.head;null!==r&&t<e;t++)r=r.next;if(t===e&&null!==r)return r.value},Jt.prototype.getReverse=function(e){for(var t=0,r=this.tail;null!==r&&t<e;t++)r=r.prev;if(t===e&&null!==r)return r.value},Jt.prototype.map=function(e,t){t=t||this;for(var r=new Jt,n=this.head;null!==n;)r.push(e.call(t,n.value,this)),n=n.next;return r},Jt.prototype.mapReverse=function(e,t){t=t||this;for(var r=new Jt,n=this.tail;null!==n;)r.push(e.call(t,n.value,this)),n=n.prev;return r},Jt.prototype.reduce=function(e,t){var r,n=this.head;if(arguments.length>1)r=t;else{if(!this.head)throw new TypeError("Reduce of empty list with no initial value");n=this.head.next,r=this.head.value}for(var i=0;null!==n;i++)r=e(r,n.value,i),n=n.next;return r},Jt.prototype.reduceReverse=function(e,t){var r,n=this.tail;if(arguments.length>1)r=t;else{if(!this.tail)throw new TypeError("Reduce of empty list with no initial value");n=this.tail.prev,r=this.tail.value}for(var i=this.length-1;null!==n;i--)r=e(r,n.value,i),n=n.prev;return r},Jt.prototype.toArray=function(){for(var e=new Array(this.length),t=0,r=this.head;null!==r;t++)e[t]=r.value,r=r.next;return e},Jt.prototype.toArrayReverse=function(){for(var e=new Array(this.length),t=0,r=this.tail;null!==r;t++)e[t]=r.value,r=r.prev;return e},Jt.prototype.slice=function(e,t){(t=t||this.length)<0&&(t+=this.length),(e=e||0)<0&&(e+=this.length);var r=new Jt;if(t<e||t<0)return r;e<0&&(e=0),t>this.length&&(t=this.length);for(var n=0,i=this.head;null!==i&&n<e;n++)i=i.next;for(;null!==i&&n<t;n++,i=i.next)r.push(i.value);return r},Jt.prototype.sliceReverse=function(e,t){(t=t||this.length)<0&&(t+=this.length),(e=e||0)<0&&(e+=this.length);var r=new Jt;if(t<e||t<0)return r;e<0&&(e=0),t>this.length&&(t=this.length);for(var n=this.length,i=this.tail;null!==i&&n>t;n--)i=i.prev;for(;null!==i&&n>e;n--,i=i.prev)r.push(i.value);return r},Jt.prototype.splice=function(e,t,...r){e>this.length&&(e=this.length-1),e<0&&(e=this.length+e);for(var n=0,i=this.head;null!==i&&n<e;n++)i=i.next;var s=[];for(n=0;i&&n<t;n++)s.push(i.value),i=this.removeNode(i);for(null===i&&(i=this.tail),i!==this.head&&i!==this.tail&&(i=i.prev),n=0;n<r.length;n++)i=Xt(this,i,r[n]);return s},Jt.prototype.reverse=function(){for(var e=this.head,t=this.tail,r=e;null!==r;r=r.prev){var n=r.prev;r.prev=r.next,r.next=n}return this.head=t,this.tail=e,this};try{!function(e){e.prototype[Symbol.iterator]=function*(){for(let e=this.head;e;e=e.next)yield e.value}}(Jt)}catch(e){}const Zt=Symbol("max"),Qt=Symbol("length"),er=Symbol("lengthCalculator"),tr=Symbol("allowStale"),rr=Symbol("maxAge"),nr=Symbol("dispose"),ir=Symbol("noDisposeOnSet"),sr=Symbol("lruList"),or=Symbol("cache"),ar=Symbol("updateAgeOnGet"),ur=()=>1,cr=(e,t,r)=>{const n=e[or].get(t);if(n){const t=n.value;if(lr(e,t)){if(hr(e,n),!e[tr])return}else r&&(e[ar]&&(n.value.now=Date.now()),e[sr].unshiftNode(n));return t.value}},lr=(e,t)=>{if(!t||!t.maxAge&&!e[rr])return!1;const r=Date.now()-t.now;return t.maxAge?r>t.maxAge:e[rr]&&r>e[rr]},fr=e=>{if(e[Qt]>e[Zt])for(let t=e[sr].tail;e[Qt]>e[Zt]&&null!==t;){const r=t.prev;hr(e,t),t=r}},hr=(e,t)=>{if(t){const r=t.value;e[nr]&&e[nr](r.key,r.value),e[Qt]-=r.length,e[or].delete(r.key),e[sr].removeNode(t)}};class pr{constructor(e,t,r,n,i){this.key=e,this.value=t,this.length=r,this.now=n,this.maxAge=i||0}}const dr=(e,t,r,n)=>{let i=r.value;lr(e,i)&&(hr(e,r),e[tr]||(i=void 0)),i&&t.call(n,i.value,i.key,e)};var vr=Kr;class mr{constructor(e,t){if(t=xt(t),e instanceof mr)return e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease?e:new mr(e.raw,t);if(e instanceof vr)return this.raw=e.value,this.set=[[e]],this.format(),this;if(this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease,this.raw=e.trim().split(/\s+/).join(" "),this.set=this.raw.split("||").map(e=>this.parseRange(e.trim())).filter(e=>e.length),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${this.raw}`);if(this.set.length>1){const e=this.set[0];if(this.set=this.set.filter(e=>!Pr(e[0])),0===this.set.length)this.set=[e];else if(this.set.length>1)for(const e of this.set)if(1===e.length&&Or(e[0])){this.set=[e];break}}this.format()}format(){return this.range=this.set.map(e=>e.join(" ").trim()).join("||").trim(),this.range}toString(){return this.range}parseRange(e){const t=((this.options.includePrerelease&&Ir)|(this.options.loose&&Ar))+":"+e,r=gr.get(t);if(r)return r;const n=this.options.loose;e=e.replace(n?Er[wr.HYPHENRANGELOOSE]:Er[wr.HYPHENRANGE],Gr(this.options.includePrerelease)),Nt("hyphen replace",e),e=e.replace(Er[wr.COMPARATORTRIM],br),Nt("comparator trim",e),e=e.replace(Er[wr.TILDETRIM],Sr),Nt("tilde trim",e),e=e.replace(Er[wr.CARETTRIM],Rr),Nt("caret trim",e);let i=e.split(" ").map(e=>Nr(e,this.options)).join(" ").split(/\s+/).map(e=>Fr(e,this.options));n&&(i=i.filter(e=>(Nt("loose invalid filter",e,this.options),!!e.match(Er[wr.COMPARATORLOOSE])))),Nt("range list",i);const s=new Map,o=i.map(e=>new vr(e,this.options));for(const e of o){if(Pr(e))return[e];s.set(e.value,e)}s.size>1&&s.has("")&&s.delete("");const a=[...s.values()];return gr.set(t,a),a}intersects(e,t){if(!(e instanceof mr))throw new TypeError("a Range is required");return this.set.some(r=>$r(r,t)&&e.set.some(e=>$r(e,t)&&r.every(r=>e.every(e=>r.intersects(e,t)))))}test(e){if(!e)return!1;if("string"==typeof e)try{e=new Kt(e,this.options)}catch(e){return!1}for(let t=0;t<this.set.length;t++)if(Br(this.set[t],e,this.options))return!0;return!1}}var yr=mr;const gr=new class{constructor(e){if("number"==typeof e&&(e={max:e}),e||(e={}),e.max&&("number"!=typeof e.max||e.max<0))throw new TypeError("max must be a non-negative number");this[Zt]=e.max||Infinity;const t=e.length||ur;if(this[er]="function"!=typeof t?ur:t,this[tr]=e.stale||!1,e.maxAge&&"number"!=typeof e.maxAge)throw new TypeError("maxAge must be a number");this[rr]=e.maxAge||0,this[nr]=e.dispose,this[ir]=e.noDisposeOnSet||!1,this[ar]=e.updateAgeOnGet||!1,this.reset()}set max(e){if("number"!=typeof e||e<0)throw new TypeError("max must be a non-negative number");this[Zt]=e||Infinity,fr(this)}get max(){return this[Zt]}set allowStale(e){this[tr]=!!e}get allowStale(){return this[tr]}set maxAge(e){if("number"!=typeof e)throw new TypeError("maxAge must be a non-negative number");this[rr]=e,fr(this)}get maxAge(){return this[rr]}set lengthCalculator(e){"function"!=typeof e&&(e=ur),e!==this[er]&&(this[er]=e,this[Qt]=0,this[sr].forEach(e=>{e.length=this[er](e.value,e.key),this[Qt]+=e.length})),fr(this)}get lengthCalculator(){return this[er]}get length(){return this[Qt]}get itemCount(){return this[sr].length}rforEach(e,t){t=t||this;for(let r=this[sr].tail;null!==r;){const n=r.prev;dr(this,e,r,t),r=n}}forEach(e,t){t=t||this;for(let r=this[sr].head;null!==r;){const n=r.next;dr(this,e,r,t),r=n}}keys(){return this[sr].toArray().map(e=>e.key)}values(){return this[sr].toArray().map(e=>e.value)}reset(){this[nr]&&this[sr]&&this[sr].length&&this[sr].forEach(e=>this[nr](e.key,e.value)),this[or]=new Map,this[sr]=new Vt,this[Qt]=0}dump(){return this[sr].map(e=>!lr(this,e)&&{k:e.key,v:e.value,e:e.now+(e.maxAge||0)}).toArray().filter(e=>e)}dumpLru(){return this[sr]}set(e,t,r){if((r=r||this[rr])&&"number"!=typeof r)throw new TypeError("maxAge must be a number");const n=r?Date.now():0,i=this[er](t,e);if(this[or].has(e)){if(i>this[Zt])return hr(this,this[or].get(e)),!1;const s=this[or].get(e).value;return this[nr]&&(this[ir]||this[nr](e,s.value)),s.now=n,s.maxAge=r,s.value=t,this[Qt]+=i-s.length,s.length=i,this.get(e),fr(this),!0}const s=new pr(e,t,i,n,r);return s.length>this[Zt]?(this[nr]&&this[nr](e,t),!1):(this[Qt]+=s.length,this[sr].unshift(s),this[or].set(e,this[sr].head),fr(this),!0)}has(e){if(!this[or].has(e))return!1;const t=this[or].get(e).value;return!lr(this,t)}get(e){return cr(this,e,!0)}peek(e){return cr(this,e,!1)}pop(){const e=this[sr].tail;return e?(hr(this,e),e.value):null}del(e){hr(this,this[or].get(e))}load(e){this.reset();const t=Date.now();for(let r=e.length-1;r>=0;r--){const n=e[r],i=n.e||0;if(0===i)this.set(n.k,n.v);else{const e=i-t;e>0&&this.set(n.k,n.v,e)}}}prune(){this[or].forEach((e,t)=>cr(this,t,!1))}}({max:1e3}),{safeRe:Er,t:wr,comparatorTrimReplace:br,tildeTrimReplace:Sr,caretTrimReplace:Rr}=jt,{FLAG_INCLUDE_PRERELEASE:Ir,FLAG_LOOSE:Ar}=$t,Pr=e=>"<0.0.0-0"===e.value,Or=e=>""===e.value,$r=(e,t)=>{let r=!0;const n=e.slice();let i=n.pop();for(;r&&n.length;)r=n.every(e=>i.intersects(e,t)),i=n.pop();return r},Nr=(e,t)=>(Nt("comp",e,t),e=xr(e,t),Nt("caret",e),e=Tr(e,t),Nt("tildes",e),e=Dr(e,t),Nt("xrange",e),e=Cr(e,t),Nt("stars",e),e),jr=e=>!e||"x"===e.toLowerCase()||"*"===e,Tr=(e,t)=>e.trim().split(/\s+/).map(e=>Lr(e,t)).join(" "),Lr=(e,t)=>e.replace(t.loose?Er[wr.TILDELOOSE]:Er[wr.TILDE],(t,r,n,i,s)=>{let o;return Nt("tilde",e,t,r,n,i,s),jr(r)?o="":jr(n)?o=`>=${r}.0.0 <${+r+1}.0.0-0`:jr(i)?o=`>=${r}.${n}.0 <${r}.${+n+1}.0-0`:s?(Nt("replaceTilde pr",s),o=`>=${r}.${n}.${i}-${s} <${r}.${+n+1}.0-0`):o=`>=${r}.${n}.${i} <${r}.${+n+1}.0-0`,Nt("tilde return",o),o}),xr=(e,t)=>e.trim().split(/\s+/).map(e=>kr(e,t)).join(" "),kr=(e,t)=>{Nt("caret",e,t);const r=t.includePrerelease?"-0":"";return e.replace(t.loose?Er[wr.CARETLOOSE]:Er[wr.CARET],(t,n,i,s,o)=>{let a;return Nt("caret",e,t,n,i,s,o),jr(n)?a="":jr(i)?a=`>=${n}.0.0${r} <${+n+1}.0.0-0`:jr(s)?a="0"===n?`>=${n}.${i}.0${r} <${n}.${+i+1}.0-0`:`>=${n}.${i}.0${r} <${+n+1}.0.0-0`:o?(Nt("replaceCaret pr",o),a="0"===n?"0"===i?`>=${n}.${i}.${s}-${o} <${n}.${i}.${+s+1}-0`:`>=${n}.${i}.${s}-${o} <${n}.${+i+1}.0-0`:`>=${n}.${i}.${s}-${o} <${+n+1}.0.0-0`):(Nt("no pr"),a="0"===n?"0"===i?`>=${n}.${i}.${s}${r} <${n}.${i}.${+s+1}-0`:`>=${n}.${i}.${s}${r} <${n}.${+i+1}.0-0`:`>=${n}.${i}.${s} <${+n+1}.0.0-0`),Nt("caret return",a),a})},Dr=(e,t)=>(Nt("replaceXRanges",e,t),e.split(/\s+/).map(e=>_r(e,t)).join(" ")),_r=(e,t)=>(e=e.trim()).replace(t.loose?Er[wr.XRANGELOOSE]:Er[wr.XRANGE],(r,n,i,s,o,a)=>{Nt("xRange",e,r,n,i,s,o,a);const u=jr(i),c=u||jr(s),l=c||jr(o);return"="===n&&l&&(n=""),a=t.includePrerelease?"-0":"",u?r=">"===n||"<"===n?"<0.0.0-0":"*":n&&l?(c&&(s=0),o=0,">"===n?(n=">=",c?(i=+i+1,s=0,o=0):(s=+s+1,o=0)):"<="===n&&(n="<",c?i=+i+1:s=+s+1),"<"===n&&(a="-0"),r=`${n+i}.${s}.${o}${a}`):c?r=`>=${i}.0.0${a} <${+i+1}.0.0-0`:l&&(r=`>=${i}.${s}.0${a} <${i}.${+s+1}.0-0`),Nt("xRange return",r),r}),Cr=(e,t)=>(Nt("replaceStars",e,t),e.trim().replace(Er[wr.STAR],"")),Fr=(e,t)=>(Nt("replaceGTE0",e,t),e.trim().replace(Er[t.includePrerelease?wr.GTE0PRE:wr.GTE0],"")),Gr=e=>(t,r,n,i,s,o,a,u,c,l,f,h,p)=>`${r=jr(n)?"":jr(i)?`>=${n}.0.0${e?"-0":""}`:jr(s)?`>=${n}.${i}.0${e?"-0":""}`:o?`>=${r}`:`>=${r}${e?"-0":""}`} ${u=jr(c)?"":jr(l)?`<${+c+1}.0.0-0`:jr(f)?`<${c}.${+l+1}.0-0`:h?`<=${c}.${l}.${f}-${h}`:e?`<${c}.${l}.${+f+1}-0`:`<=${u}`}`.trim(),Br=(e,t,r)=>{for(let r=0;r<e.length;r++)if(!e[r].test(t))return!1;if(t.prerelease.length&&!r.includePrerelease){for(let r=0;r<e.length;r++)if(Nt(e[r].semver),e[r].semver!==vr.ANY&&e[r].semver.prerelease.length>0){const n=e[r].semver;if(n.major===t.major&&n.minor===t.minor&&n.patch===t.patch)return!0}return!1}return!0},Mr=Symbol("SemVer ANY");class Ur{static get ANY(){return Mr}constructor(e,t){if(t=xt(t),e instanceof Ur){if(e.loose===!!t.loose)return e;e=e.value}e=e.trim().split(/\s+/).join(" "),Nt("comparator",e,t),this.options=t,this.loose=!!t.loose,this.parse(e),this.value=this.semver===Mr?"":this.operator+this.semver.version,Nt("comp",this)}parse(e){const t=e.match(this.options.loose?qr[Hr.COMPARATORLOOSE]:qr[Hr.COMPARATOR]);if(!t)throw new TypeError(`Invalid comparator: ${e}`);this.operator=void 0!==t[1]?t[1]:"","="===this.operator&&(this.operator=""),this.semver=t[2]?new Kt(t[2],this.options.loose):Mr}toString(){return this.value}test(e){if(Nt("Comparator.test",e,this.options.loose),this.semver===Mr||e===Mr)return!0;if("string"==typeof e)try{e=new Kt(e,this.options)}catch(e){return!1}return Ht(e,this.operator,this.semver,this.options)}intersects(e,t){if(!(e instanceof Ur))throw new TypeError("a Comparator is required");return""===this.operator?""===this.value||new yr(e.value,t).test(this.value):""===e.operator?""===e.value||new yr(this.value,t).test(e.semver):!((t=xt(t)).includePrerelease&&("<0.0.0-0"===this.value||"<0.0.0-0"===e.value)||!t.includePrerelease&&(this.value.startsWith("<0.0.0")||e.value.startsWith("<0.0.0"))||(!this.operator.startsWith(">")||!e.operator.startsWith(">"))&&(!this.operator.startsWith("<")||!e.operator.startsWith("<"))&&(this.semver.version!==e.semver.version||!this.operator.includes("=")||!e.operator.includes("="))&&!(Ht(this.semver,"<",e.semver,t)&&this.operator.startsWith(">")&&e.operator.startsWith("<"))&&!(Ht(this.semver,">",e.semver,t)&&this.operator.startsWith("<")&&e.operator.startsWith(">")))}}var Kr=Ur;const{safeRe:qr,t:Hr}=jt;new vr(">=0.0.0-0"),new vr(">=0.0.0");var Vr=(e,t,r)=>{try{t=new yr(t,r)}catch(e){return!1}return t.test(e)},Jr=Vr(process.version,">=15.7.0"),Xr=Vr(process.version,">=16.9.0");const zr={ec:["ES256","ES384","ES512"],rsa:["RS256","PS256","RS384","PS384","RS512","PS512"],"rsa-pss":["PS256","PS384","PS512"]},Wr={ES256:"prime256v1",ES384:"secp384r1",ES512:"secp521r1"};var Yr=function(e,t){if(!e||!t)return;const r=t.asymmetricKeyType;if(!r)return;const n=zr[r];if(!n)throw new Error(`Unknown key type "${r}".`);if(!n.includes(e))throw new Error(`"alg" parameter for "${r}" key type must be one of: ${n.join(", ")}.`);if(Jr)switch(r){case"ec":const r=Wr[e];if(t.asymmetricKeyDetails.namedCurve!==r)throw new Error(`"alg" parameter "${e}" requires curve "${r}".`);break;case"rsa-pss":if(Xr){const r=parseInt(e.slice(-3),10),{hashAlgorithm:n,mgf1HashAlgorithm:i,saltLength:s}=t.asymmetricKeyDetails;if(n!==`sha${r}`||i!==n)throw new Error(`Invalid key for this operation, its RSA-PSS parameters do not meet the requirements of "alg" ${e}.`);if(void 0!==s&&s>r>>3)throw new Error(`Invalid key for this operation, its RSA-PSS parameter saltLength does not meet the requirements of "alg" ${e}.`)}}},Zr=Vr(process.version,"^6.12.0 || >=8.0.0");const{KeyObject:Qr,createSecretKey:en,createPublicKey:tn}=K.default,rn=["RS256","RS384","RS512"],nn=["ES256","ES384","ES512"],sn=["RS256","RS384","RS512"],on=["HS256","HS384","HS512"];Zr&&(rn.splice(rn.length,0,"PS256","PS384","PS512"),sn.splice(sn.length,0,"PS256","PS384","PS512"));var an=9007199254740991,un=/^\s+|\s+$/g,cn=/^[-+]0x[0-9a-f]+$/i,ln=/^0b[01]+$/i,fn=/^0o[0-7]+$/i,hn=/^(?:0|[1-9]\d*)$/,pn=parseInt;function dn(e){return e!=e}var vn,mn,yn=Object.prototype,gn=yn.hasOwnProperty,En=yn.toString,wn=yn.propertyIsEnumerable,bn=(vn=Object.keys,mn=Object,function(e){return vn(mn(e))}),Sn=Math.max;function Rn(e,t){return!!(t=null==t?an:t)&&("number"==typeof e||hn.test(e))&&e>-1&&e%1==0&&e<t}var In=Array.isArray;function An(e){return null!=e&&function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=an}(e.length)&&!function(e){var t=Pn(e)?En.call(e):"";return"[object Function]"==t||"[object GeneratorFunction]"==t}(e)}function Pn(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function On(e){return!!e&&"object"==typeof e}var $n=Object.prototype.toString,Nn=function(e){return!0===e||!1===e||function(e){return!!e&&"object"==typeof e}(e)&&"[object Boolean]"==$n.call(e)},jn=/^\s+|\s+$/g,Tn=/^[-+]0x[0-9a-f]+$/i,Ln=/^0b[01]+$/i,xn=/^0o[0-7]+$/i,kn=parseInt,Dn=Object.prototype.toString;function _n(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}var Cn=function(e){return"number"==typeof e&&e==function(e){var t=function(e){return e?Infinity===(e=function(e){if("number"==typeof e)return e;if(function(e){return"symbol"==typeof e||function(e){return!!e&&"object"==typeof e}(e)&&"[object Symbol]"==Dn.call(e)}(e))return NaN;if(_n(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=_n(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(jn,"");var r=Ln.test(e);return r||xn.test(e)?kn(e.slice(2),r?2:8):Tn.test(e)?NaN:+e}(e))||-Infinity===e?17976931348623157e292*(e<0?-1:1):e==e?e:0:0===e?e:0}(e),r=t%1;return t==t?r?t-r:t:0}(e)},Fn=Object.prototype.toString,Gn=function(e){return"number"==typeof e||function(e){return!!e&&"object"==typeof e}(e)&&"[object Number]"==Fn.call(e)},Bn=Object.prototype,Mn=Function.prototype.toString,Un=Bn.hasOwnProperty,Kn=Mn.call(Object),qn=Bn.toString,Hn=function(e,t){return function(r){return e(t(r))}}(Object.getPrototypeOf,Object),Vn=function(e){if(!function(e){return!!e&&"object"==typeof e}(e)||"[object Object]"!=qn.call(e)||function(e){var t=!1;if(null!=e&&"function"!=typeof e.toString)try{t=!!(e+"")}catch(e){}return t}(e))return!1;var t=Hn(e);if(null===t)return!0;var r=Un.call(t,"constructor")&&t.constructor;return"function"==typeof r&&r instanceof r&&Mn.call(r)==Kn},Jn=Object.prototype.toString,Xn=Array.isArray,zn=function(e){return"string"==typeof e||!Xn(e)&&function(e){return!!e&&"object"==typeof e}(e)&&"[object String]"==Jn.call(e)},Wn=/^\s+|\s+$/g,Yn=/^[-+]0x[0-9a-f]+$/i,Zn=/^0b[01]+$/i,Qn=/^0o[0-7]+$/i,ei=parseInt,ti=Object.prototype.toString;function ri(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}const{KeyObject:ni,createSecretKey:ii,createPrivateKey:si}=K.default,oi=["RS256","RS384","RS512","ES256","ES384","ES512","HS256","HS384","HS512","none"];Zr&&oi.splice(3,0,"PS256","PS384","PS512");const ai={expiresIn:{isValid:function(e){return Cn(e)||zn(e)&&e},message:'"expiresIn" should be a number of seconds or string representing a timespan'},notBefore:{isValid:function(e){return Cn(e)||zn(e)&&e},message:'"notBefore" should be a number of seconds or string representing a timespan'},audience:{isValid:function(e){return zn(e)||Array.isArray(e)},message:'"audience" must be a string or array'},algorithm:{isValid:function(e,t,r,n){var i;e=An(e)?e:(i=e)?function(e,t){return function(t,r){for(var n=-1,i=t?t.length:0,s=Array(i);++n<i;)s[n]=e[t[n]];return s}(t)}(i,function(e){return An(e)?function(e,t){var r=In(e)||function(e){return function(e){return On(e)&&An(e)}(e)&&gn.call(e,"callee")&&(!wn.call(e,"callee")||"[object Arguments]"==En.call(e))}(e)?function(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n}(e.length,String):[],n=r.length,i=!!n;for(var s in e)!gn.call(e,s)||i&&("length"==s||Rn(s,n))||r.push(s);return r}(e):function(e){if((t=e)!==("function"==typeof(r=t&&t.constructor)&&r.prototype||yn))return bn(e);var t,r,n=[];for(var i in Object(e))gn.call(e,i)&&"constructor"!=i&&n.push(i);return n}(e)}(i)):[],r=r&&!n?function(e){var t=function(e){return e?Infinity===(e=function(e){if("number"==typeof e)return e;if(function(e){return"symbol"==typeof e||On(e)&&"[object Symbol]"==En.call(e)}(e))return NaN;if(Pn(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=Pn(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(un,"");var r=ln.test(e);return r||fn.test(e)?pn(e.slice(2),r?2:8):cn.test(e)?NaN:+e}(e))||-Infinity===e?17976931348623157e292*(e<0?-1:1):e==e?e:0:0===e?e:0}(e),r=t%1;return t==t?r?t-r:t:0}(r):0;var s=e.length;return r<0&&(r=Sn(s+r,0)),function(e){return"string"==typeof e||!In(e)&&On(e)&&"[object String]"==En.call(e)}(e)?r<=s&&e.indexOf(t,r)>-1:!!s&&function(e,t,r){if(t!=t)return function(e,t,r,n){for(var i=e.length,s=r+-1;++s<i;)if(t(e[s],s,e))return s;return-1}(e,dn,r);for(var n=r-1,i=e.length;++n<i;)if(e[n]===t)return n;return-1}(e,t,r)>-1}.bind(null,oi),message:'"algorithm" must be a valid string enum value'},header:{isValid:Vn,message:'"header" must be an object'},encoding:{isValid:zn,message:'"encoding" must be a string'},issuer:{isValid:zn,message:'"issuer" must be a string'},subject:{isValid:zn,message:'"subject" must be a string'},jwtid:{isValid:zn,message:'"jwtid" must be a string'},noTimestamp:{isValid:Nn,message:'"noTimestamp" must be a boolean'},keyid:{isValid:zn,message:'"keyid" must be a string'},mutatePayload:{isValid:Nn,message:'"mutatePayload" must be a boolean'},allowInsecureKeySizes:{isValid:Nn,message:'"allowInsecureKeySizes" must be a boolean'},allowInvalidAsymmetricKeyTypes:{isValid:Nn,message:'"allowInvalidAsymmetricKeyTypes" must be a boolean'}},ui={iat:{isValid:Gn,message:'"iat" should be a number of seconds'},exp:{isValid:Gn,message:'"exp" should be a number of seconds'},nbf:{isValid:Gn,message:'"nbf" should be a number of seconds'}};function ci(e,t,r,n){if(!Vn(r))throw new Error('Expected "'+n+'" to be a plain object.');Object.keys(r).forEach(function(i){const s=e[i];if(s){if(!s.isValid(r[i]))throw new Error(s.message)}else if(!t)throw new Error('"'+i+'" is not allowed in "'+n+'"')})}const li={audience:"aud",issuer:"iss",subject:"sub",jwtid:"jti"},fi=["expiresIn","notBefore","noTimestamp","audience","issuer","subject","jwtid"];var hi=function(e,t,r,n){let i;if("function"!=typeof r||n||(n=r,r={}),r||(r={}),r=Object.assign({},r),i=n||function(e,t){if(e)throw e;return t},r.clockTimestamp&&"number"!=typeof r.clockTimestamp)return i(new yt("clockTimestamp must be a number"));if(void 0!==r.nonce&&("string"!=typeof r.nonce||""===r.nonce.trim()))return i(new yt("nonce must be a non-empty string"));if(void 0!==r.allowInvalidAsymmetricKeyTypes&&"boolean"!=typeof r.allowInvalidAsymmetricKeyTypes)return i(new yt("allowInvalidAsymmetricKeyTypes must be a boolean"));const s=r.clockTimestamp||Math.floor(Date.now()/1e3);if(!e)return i(new yt("jwt must be provided"));if("string"!=typeof e)return i(new yt("jwt must be a string"));const o=e.split(".");if(3!==o.length)return i(new yt("jwt malformed"));let a;try{a=function(e,t){var r=vt.decode(e,t=t||{});if(!r)return null;var n=r.payload;if("string"==typeof n)try{var i=JSON.parse(n);null!==i&&"object"==typeof i&&(n=i)}catch(e){}return!0===t.complete?{header:r.header,payload:n,signature:r.signature}:n}(e,{complete:!0})}catch(e){return i(e)}if(!a)return i(new yt("invalid token"));const u=a.header;let c;if("function"==typeof t){if(!n)return i(new yt("verify must be called asynchronous if secret or public key is provided as a callback"));c=t}else c=function(e,r){return r(null,t)};return c(u,function(t,n){if(t)return i(new yt("error in secret or public key callback: "+t.message));const c=""!==o[2].trim();if(!c&&n)return i(new yt("jwt signature is required"));if(c&&!n)return i(new yt("secret or public key must be provided"));if(!c&&!r.algorithms)return i(new yt('please specify "none" in "algorithms" to verify unsigned tokens'));if(null!=n&&!(n instanceof Qr))try{n=tn(n)}catch(e){try{n=en("string"==typeof n?Buffer.from(n):n)}catch(e){return i(new yt("secretOrPublicKey is not valid key material"))}}if(r.algorithms||(r.algorithms="secret"===n.type?on:["rsa","rsa-pss"].includes(n.asymmetricKeyType)?sn:"ec"===n.asymmetricKeyType?nn:rn),-1===r.algorithms.indexOf(a.header.alg))return i(new yt("invalid algorithm"));if(u.alg.startsWith("HS")&&"secret"!==n.type)return i(new yt(`secretOrPublicKey must be a symmetric key when using ${u.alg}`));if(/^(?:RS|PS|ES)/.test(u.alg)&&"public"!==n.type)return i(new yt(`secretOrPublicKey must be an asymmetric key when using ${u.alg}`));if(!r.allowInvalidAsymmetricKeyTypes)try{Yr(u.alg,n)}catch(e){return i(e)}let l;try{l=vt.verify(e,a.header.alg,n)}catch(e){return i(e)}if(!l)return i(new yt("invalid signature"));const f=a.payload;if(void 0!==f.nbf&&!r.ignoreNotBefore){if("number"!=typeof f.nbf)return i(new yt("invalid nbf value"));if(f.nbf>s+(r.clockTolerance||0))return i(new Et("jwt not active",new Date(1e3*f.nbf)))}if(void 0!==f.exp&&!r.ignoreExpiration){if("number"!=typeof f.exp)return i(new yt("invalid exp value"));if(s>=f.exp+(r.clockTolerance||0))return i(new bt("jwt expired",new Date(1e3*f.exp)))}if(r.audience){const e=Array.isArray(r.audience)?r.audience:[r.audience];if(!(Array.isArray(f.aud)?f.aud:[f.aud]).some(function(t){return e.some(function(e){return e instanceof RegExp?e.test(t):e===t})}))return i(new yt("jwt audience invalid. expected: "+e.join(" or ")))}if(r.issuer&&("string"==typeof r.issuer&&f.iss!==r.issuer||Array.isArray(r.issuer)&&-1===r.issuer.indexOf(f.iss)))return i(new yt("jwt issuer invalid. expected: "+r.issuer));if(r.subject&&f.sub!==r.subject)return i(new yt("jwt subject invalid. expected: "+r.subject));if(r.jwtid&&f.jti!==r.jwtid)return i(new yt("jwt jwtid invalid. expected: "+r.jwtid));if(r.nonce&&f.nonce!==r.nonce)return i(new yt("jwt nonce invalid. expected: "+r.nonce));if(r.maxAge){if("number"!=typeof f.iat)return i(new yt("iat required when maxAge is specified"));const e=Ot(r.maxAge,f.iat);if(void 0===e)return i(new yt('"maxAge" should be a number of seconds or string representing a timespan eg: "1d", "20h", 60'));if(s>=e+(r.clockTolerance||0))return i(new bt("maxAge exceeded",new Date(1e3*e)))}return i(null,!0===r.complete?{header:u,payload:f,signature:a.signature}:f)})},pi=function(e,t,r,n){"function"==typeof r?(n=r,r={}):r=r||{};const i="object"==typeof e&&!Buffer.isBuffer(e),s=Object.assign({alg:r.algorithm||"HS256",typ:i?"JWT":void 0,kid:r.keyid},r.header);function o(e){if(n)return n(e);throw e}if(!t&&"none"!==r.algorithm)return o(new Error("secretOrPrivateKey must have a value"));if(null!=t&&!(t instanceof ni))try{t=si(t)}catch(e){try{t=ii("string"==typeof t?Buffer.from(t):t)}catch(e){return o(new Error("secretOrPrivateKey is not valid key material"))}}if(s.alg.startsWith("HS")&&"secret"!==t.type)return o(new Error(`secretOrPrivateKey must be a symmetric key when using ${s.alg}`));if(/^(?:RS|PS|ES)/.test(s.alg)){if("private"!==t.type)return o(new Error(`secretOrPrivateKey must be an asymmetric key when using ${s.alg}`));if(!r.allowInsecureKeySizes&&!s.alg.startsWith("ES")&&void 0!==t.asymmetricKeyDetails&&t.asymmetricKeyDetails.modulusLength<2048)return o(new Error(`secretOrPrivateKey has a minimum key size of 2048 bits for ${s.alg}`))}if(void 0===e)return o(new Error("payload is required"));if(i){try{!function(e){ci(ui,!0,e,"payload")}(e)}catch(e){return o(e)}r.mutatePayload||(e=Object.assign({},e))}else{const t=fi.filter(function(e){return void 0!==r[e]});if(t.length>0)return o(new Error("invalid "+t.join(",")+" option for "+typeof e+" payload"))}if(void 0!==e.exp&&void 0!==r.expiresIn)return o(new Error('Bad "options.expiresIn" option the payload already has an "exp" property.'));if(void 0!==e.nbf&&void 0!==r.notBefore)return o(new Error('Bad "options.notBefore" option the payload already has an "nbf" property.'));try{!function(e){ci(ai,!1,e,"options")}(r)}catch(e){return o(e)}if(!r.allowInvalidAsymmetricKeyTypes)try{Yr(s.alg,t)}catch(e){return o(e)}const a=e.iat||Math.floor(Date.now()/1e3);if(r.noTimestamp?delete e.iat:i&&(e.iat=a),void 0!==r.notBefore){try{e.nbf=Ot(r.notBefore,a)}catch(e){return o(e)}if(void 0===e.nbf)return o(new Error('"notBefore" should be a number of seconds or string representing a timespan eg: "1d", "20h", 60'))}if(void 0!==r.expiresIn&&"object"==typeof e){try{e.exp=Ot(r.expiresIn,a)}catch(e){return o(e)}if(void 0===e.exp)return o(new Error('"expiresIn" should be a number of seconds or string representing a timespan eg: "1d", "20h", 60'))}Object.keys(li).forEach(function(t){const n=li[t];if(void 0!==r[t]){if(void 0!==e[n])return o(new Error('Bad "options.'+t+'" option. The payload already has an "'+n+'" property.'));e[n]=r[t]}});const u=r.encoding||"utf8";if("function"!=typeof n){let n=vt.sign({header:s,payload:e,secret:t,encoding:u});if(!r.allowInsecureKeySizes&&/^(?:RS|PS)/.test(s.alg)&&n.length<256)throw new Error(`secretOrPrivateKey has a minimum key size of 2048 bits for ${s.alg}`);return n}n=n&&function(e){return function(e,t){var r;if("function"!=typeof t)throw new TypeError("Expected a function");return e=function(e){var t=function(e){return e?Infinity===(e=function(e){if("number"==typeof e)return e;if(function(e){return"symbol"==typeof e||function(e){return!!e&&"object"==typeof e}(e)&&"[object Symbol]"==ti.call(e)}(e))return NaN;if(ri(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=ri(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(Wn,"");var r=Zn.test(e);return r||Qn.test(e)?ei(e.slice(2),r?2:8):Yn.test(e)?NaN:+e}(e))||-Infinity===e?17976931348623157e292*(e<0?-1:1):e==e?e:0:0===e?e:0}(e),r=t%1;return t==t?r?t-r:t:0}(e),function(){return--e>0&&(r=t.apply(this,arguments)),e<=1&&(t=void 0),r}}(2,e)}(n),vt.createSign({header:s,privateKey:t,payload:e,encoding:u}).once("error",n).once("done",function(e){if(!r.allowInsecureKeySizes&&/^(?:RS|PS)/.test(s.alg)&&e.length<256)return n(new Error(`secretOrPrivateKey has a minimum key size of 2048 bits for ${s.alg}`));n(null,e)})},di=/*#__PURE__*/function(){function e(e,t){this.privateKey=e,this.options=t}var t=e.prototype;return t.sign=function(e){var t=oe({},this.options,{jwtid:J.v4()});return pi(e,this.privateKey,t)},t.verify=function(e){return hi(e,this.privateKey,this.options)},t.refresh=function(e){var t=hi(e,this.privateKey,this.options);delete t.sub,delete t.iss,delete t.aud,delete t.iat,delete t.exp,delete t.nbf,delete t.jti;var r=oe({},this.options,{jwtid:J.v4()});return pi(t,this.privateKey,r)},e}(),vi=/*#__PURE__*/function(){function e(e,t,r){this.app=D.default(),this.express_config=B.default.defaultsDeep(e,{helmet:!0,json:!0,urlencoded:!0,compression:!0,cors:{origin:!0,credentials:!0},fileupload:!0,socketio:{transports:["websocket"]},traceRequests:!1}),this.statics=t,this.routes=r}var t=e.prototype;return t.initialize=function(){try{var e=function(){return Promise.resolve(t.configureRoutes(t.routes)).then(function(){return Promise.resolve(t.errorHandler()).then(function(){})})},t=this;t.config(t.express_config);var r=function(){if(t.customizeExpress)return Promise.resolve(t.customizeExpress(t.app)).then(function(){})}();return Promise.resolve(r&&r.then?r.then(e):e())}catch(e){return Promise.reject(e)}},t.customizeExpress=function(){},t.config=function(e){if(e&&e.helmet&&this.app.use(k.default(e&&B.default.isObject(e.helmet)&&e.helmet)),e&&e.json&&this.app.use(D.default.json()),e&&e.urlencoded&&this.app.use(D.default.urlencoded({extended:!0})),e&&e.compression&&this.app.use(_.default()),e&&e.cors&&(this.app.options("*",C.default(e&&B.default.isObject(e.cors)&&e.cors)),this.app.use(C.default(e&&B.default.isObject(e.cors)&&e.cors))),e&&e.fileupload&&this.app.use(F.default()),this.statics)for(var t in this.statics)this.app.use(t,D.default.static(this.statics[t]));e&&!0===e.traceRequests&&"true"!=process.env.DISABLE_LOGGER&&this.app.use(function(e,t,r){e.requestTime=Date.now(),t.on("finish",function(){var t=G.default.parse(e.url).pathname,r=Date.now()-e.requestTime;console.debug("APIRequest["+process.pid+"]::. ["+e.method+"] (user:"+(e&&e.session&&e.session.user_id||"")+")  "+t+" |-> took: "+r+" ms"),console.debug(JSON.stringify(e.body))}),r()})},t.configureRoutes=function(e){var t=D.default.Router();this.app.use(t),this.loadRoutes(this.app,e)},t.loadRoutes=function(e,t){if(t)for(var r,n=le(t);!(r=n()).done;){var i=r.value;if(i){var s=i.configure();if(i.entity&&(s=i.configure(i.entity,{service:i.service,table:i.table})),!B.default.isEmpty(i.routes)){var o=fe.expressHandler();for(var a in i.routes){var u=i.routes[a];for(var c in u){var l=u[c];Array.isArray(l)?s[c](a,l[0],o(l[1])):s[c](a,o(l))}}}s&&e.use(s)}else console.warn("Empty route")}},t.errorHandler=function(){this.app.use(function(e,t,r,n){var i=new pe;i.success=!1,i.message=e.message,console.error(e),r.status(500).json(i.toJson())})},e}(),mi=/*#__PURE__*/function(e){function t(t){var r;return r=e.call(this)||this,process.env.PORT||console.log("Using 3000 as default port. Customize via env PORT."),r.port=r.normalizePort(process.env.PORT||3e3),r.clustered=process.env.CLUSTERED,r.workers=[],r.app=t,r.executeOnlyMain=function(){},r}ae(t,e);var r=t.prototype;return r.setServerCls=function(e){this.server=e},r.start=function(){try{var e=this,t=function(){if("true"!=e.clustered)return e.configureSocketIO(),e.executeOnlyMain(),Promise.resolve(e.initUnclustered()).then(function(){});e.initClustered()}();return Promise.resolve(t&&t.then?t.then(function(){}):void 0)}catch(e){return Promise.reject(e)}},r.configureSocketIO=function(){this.server.express_config&&this.server.express_config.socketio&&(this.app.io=new E.Server(this.server.express_config&&this.server.express_config.socketio),this.app.io.listen(this.port+1))},r.initClustered=function(){try{var e=this,t=function(){if(!Y.default.isPrimary)return Promise.resolve(e.initUnclustered()).then(function(){console.log("Worker "+process.pid+" started")});e.configureSocketIO(),e.executeOnlyMain(),(new Q.default).on("event",function(t,r){t&&t.event&&(1==process.env.DEBUG_EVENTS&&console.debug("Received '"+t.event+"' from "+t.props.owner+" at Master"),e.app.events.emit(t.event,t.props,r))});for(var t=Z.default.cpus().length,r=0;r<t;r+=1)e.initWorker();Y.default.on("exit",function(t){console.log("Worker "+t.id+" died :("),e.initWorker()})}();return Promise.resolve(t&&t.then?t.then(function(){}):void 0)}catch(e){return Promise.reject(e)}},r.initWorker=function(){var e=Y.default.fork();console.log("Running worker "+e.process.pid),this.workers.push(e)},r.initUnclustered=function(){try{var e=this;e.server.port=e.port;var t=X.default.Server(e.server.app);return Promise.resolve(e.server.initialize()).then(function(){function r(){function r(){if(t.on("error",function(t){e.handleErrors(t,e.server.port)}),t.on("listening",function(){console.log("Server Worker running on port: "+e.port+"!"),e.emit("listening",e.port)}),process.env.SSL&&"true"==process.env.SSL){process.env.SSL_KEY&&process.env.SSL_CERT&&process.env.SSL_PASS||(console.error("Invalid SSL configuration. SLL_KEY, SSL_CERT and SSL_PASS needed"),process.exit(0));var r={key:M.default.readFileSync(W.default.resolve(process.cwd(),process.env.SSL_KEY||"key.pem")),cert:M.default.readFileSync(W.default.resolve(process.cwd(),process.env.SSL_CERT||"cert.pem")),passphrase:process.env.SSL_PASS};process.env.SSL_PORT||console.log("Using 3443 as ssl default port. Customize via env SSL_PORT.");var n=e.normalizePort(process.env.SSL_PORT||3443),i=z.default.createServer(r,e.server.app);i.listen(n),i.on("error",function(t){e.handleErrors(t,n)}),i.on("listening",function(){console.log("Server Worker running on port: "+n+"!"),e.emit("listening_ssl",n)})}}t.listen(e.server.port);var n=function(){if(e.server.afterListen)return Promise.resolve(e.server.afterListen()).then(function(){})}();return n&&n.then?n.then(r):r()}var n=function(){if(e.server.beforeListen)return Promise.resolve(e.server.beforeListen()).then(function(){})}();return n&&n.then?n.then(r):r()})}catch(e){return Promise.reject(e)}},r.normalizePort=function(e){var t=parseInt(e,10);return isNaN(t)?e:t>=0&&t},r.handleErrors=function(e,t){if("listen"!==e.syscall)throw e;var r="string"==typeof t?"Pipe "+t:"Port "+t;switch(e.code){case"EACCES":console.error(r+" requires elevated privileges"),process.exit(1);break;case"EADDRINUSE":console.error(r+" is already in use"),process.exit(1);break;default:throw e}},t}(b.EventEmitter),yi=/*#__PURE__*/function(e){function t(t){var r;return(r=e.call(this)||this).messages=new Q.default,r.app=t,Y.default.isWorker&&r.messages.on("event",function(t,n){t&&t.event&&process.pid!==t.props.owner&&(1==process.env.DEBUG_EVENTS&&console.debug("Receiving broadcast "+t.event+" - "+process.pid),e.prototype.emit.call(function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(r),t.event,oe({},t.props),n))}),r}return ae(t,e),t.prototype.emit=function(t,r,n){e.prototype.emit.call(this,t,r,n),t&&r&&Y.default.isWorker&&process.pid!==r.owner&&(1==process.env.DEBUG_EVENTS&&console.debug(t+" -> Firing from "+process.pid+" to master"),r||(r={}),r.owner=process.pid,this.messages.send("event",{event:t,props:oe({},r)},n)),t&&r&&Y.default.isPrimary&&this.app&&this.app.server&&this.app.server.workers&&(1==process.env.DEBUG_EVENTS&&console.debug(t+" -> Firing from master to workers"),this.messages.send("event",{event:t,props:oe({},r)},n))},t}(b.EventEmitter),gi=ee.default.configure,Ei=ee.default.getLogger,wi=/*#__PURE__*/function(){function e(){}return e.configure=function(){try{var e=U.default.promisify(M.default.readFile);return Promise.resolve(e(W.default.resolve(process.cwd(),"./log4js.json"),"utf8")).then(function(e){var t,r,n;gi(JSON.parse(e)),t=Ei("log"),r=Ei("error"),n=Ei("debug"),console.log=function(){var e=Array.prototype.slice.call(arguments);t.log("info",e[0])},console.error=function(){var e=Array.prototype.slice.call(arguments);r.log("error",e[0])},console.info=function(){var e=Array.prototype.slice.call(arguments);t.log("info",e[0])},console.debug=function(){var e=Array.prototype.slice.call(arguments);n.log("debug",e[0])},console.custom=function(e,t,r){Ei(e).log(t,r)}})}catch(e){return Promise.reject(e)}},e}();function bi(e,t){try{var r=e()}catch(e){return t(e)}return r&&r.then?r.then(void 0,t):r}var Si=/*#__PURE__*/function(){function e(e,t){this.router=D.default.Router(),this.publicPathsList=[].concat(e,["/login"]),this.AuthHandler=t}var t=e.prototype;return t.configure=function(){var e=this,t=fe.expressHandler();return this.router.use(t(function(){return e.check.apply(e,[].slice.call(arguments))})),this.router.post("/login",t(function(){return e.loginPost.apply(e,[].slice.call(arguments))})),this.router.post("/logout",t(function(){return e.logout.apply(e,[].slice.call(arguments))})),this.router},t.check=function(e,t,r){try{var n=this;return Promise.resolve(bi(function(){for(var i,s=le(n.publicPathsList);!(i=s()).done;)if(null!==I.pathToRegexp(i.value).exec(G.default.parse(e.url).pathname))return r();return Promise.resolve(n.AuthHandler.check(e)).then(function(e){return e?r():t.status(403).json(new pe(!1,null,"Forbidden").toJson())})},function(e){return console.error(e),t.status(403).json(new pe(!1,null,"Forbidden").toJson())}))}catch(e){return Promise.reject(e)}},t.loginPost=function(e,t){try{var r,n=function(e){return r?e:t.status(401).json(new pe(!1,null,"Unauthorized - Missing parameters").toJson())},i=this,s=function(){if(e.body.username)return bi(function(){return Promise.resolve(i.AuthHandler.validate(e,e.body.username,e.body.password)).then(function(e){if(e){var n=t.status(200).json(new pe(!0,e).toJson());return r=1,n}var i=t.status(401).json(new pe(!1,null,"Unauthorized - Incorrect credentials").toJson());return r=1,i})},function(e){console.error(e);var n=t.status(401).json(new pe(!1,null,"Unauthorized - Error, check log").toJson());return r=1,n})}();return Promise.resolve(s&&s.then?s.then(n):n(s))}catch(e){return Promise.reject(e)}},t.logout=function(e,t){try{var r,n=function(e){return r?e:t.status(200).json(new pe(!0).toJson())},i=this,s=function(){if(i.AuthHandler.logout)return bi(function(){return Promise.resolve(i.AuthHandler.logout(e)).then(function(){var e=t.status(200).json(new pe(!0).toJson());return r=1,e})},function(e){console.error(e);var n=t.status(500).json(new pe(!1,null,e).toJson());return r=1,n})}();return Promise.resolve(s&&s.then?s.then(n):n(s))}catch(e){return Promise.reject(e)}},e}(),Ri=function(){if(!this.check)throw new Error("AuthHandler must have 'check' vethod");if(!this.validate)throw new Error("AuthHandler must have 'validate' vethod")},Ii=/*#__PURE__*/function(e){function t(t){var r;if((r=e.call(this)||this).tokenGenerator=new di(process.env.JWT_SECRET,{audience:process.env.JWT_AUDIENCE,issuer:process.env.JWT_ISSUER,subject:process.env.JWT_SUBJECT,algorithm:process.env.JWT_ALGORITHM,expiresIn:process.env.JWT_EXPIRES}),!t)throw new Error("Need 'UserDao' for user validation. Create 'UserDao' class extending 'IUserDao'");return r.userDao=t,r}ae(t,e);var r=t.prototype;return r.check=function(e){try{if(e.headers.authorization){var t=(e.headers.authorization||"").split(" ")[1]||"";if(!t)return console.error("Token needed"),Promise.resolve(!1);try{var r=this.tokenGenerator.verify(t);return r.sub&&r.username&&!te.default(r.exp).isAfter(new Date)?(e.session=oe({},e.session,r),Promise.resolve(!0)):Promise.resolve(!1)}catch(e){return console.error(e),Promise.resolve(!1)}}return Promise.resolve(!1)}catch(e){return Promise.reject(e)}},r.validate=function(e,t,r){try{var n=this;return Promise.resolve(n.userDao.findByUsername(t)).then(function(e){return!(!e||e.username!==t||e.password!==fe.encrypt(r))&&n.tokenGenerator.sign(B.default.omit(e,["password"]))})}catch(e){return Promise.reject(e)}},t}(Ri),Ai=/*#__PURE__*/function(e){function t(t){var r;if(r=e.call(this)||this,!t)throw new Error("Need 'UserDao' for user validation. Create 'UserDao' class extending 'IUserDao'");return r.userDao=t,r}ae(t,e);var r=t.prototype;return r.check=function(e){try{var t,r=function(r){return t?r:!(!e.session||!e.session.username)},n=this,i=function(){if(e.headers.authorization){var r=(e.headers.authorization||"").split(" ")[1]||"",i=Buffer.from(r,"base64").toString().split(":");return Promise.resolve(n.validate(e,i[0],i[1])).then(function(e){return e?t=!0:(t=1,!1)})}}();return Promise.resolve(i&&i.then?i.then(r):r(i))}catch(e){return Promise.reject(e)}},r.validate=function(e,t,r){try{return Promise.resolve(this.userDao.findByUsername(t)).then(function(n){return!(!n||n.username!==t||n.password!==fe.encrypt(r)||(e.session=oe({},e.session,B.default.omit(n,["password"])),0))})}catch(e){return Promise.reject(e)}},r.logout=function(e){return new Promise(function(t){e.session&&e.session.destroy(t)})},t}(Ri),Pi=new(/*#__PURE__*/function(){function e(){}var t=e.prototype;return t.init=function(e){this.connection=re.default(e)},t.setColumnAliases=function(e){this.columnAliases=e},t.test=function(){return this.connection.raw("select 1+1 as result")},e}()),Oi=/*#__PURE__*/function(){function e(){}return e.parseQueryString=function(e,t,r){var n={allowGlobalSearch:!0,caseInsensitive:!0};Pi.columnAliases&&Pi.columnAliases[r]&&(n.aliases=Pi.columnAliases[r]),void 0!==Pi.caseInsensitive&&(n.caseInsensitive=Pi.caseInsensitive),void 0!==Pi.allowGlobalSearch&&(n.allowGlobalSearch=Pi.allowGlobalSearch);var i=new P.FQLParser(n).parse(t);return new P.KnexParser(r).toKnex(e,i)},e.parseFilters=function(t,r,n){var i=t;for(var s in r){var o=r[s];if("object"==typeof o)switch(o.type){case"fql":i=e.parseQueryString(i,o.value,n);break;case"date":case"between":o.start&&o.end&&(i=i.whereBetween(s,[o.start,o.end])),o.start&&!o.end&&(i=i.where(s,">=",o.start)),!o.start&&o.end&&(i=i.where(s,">=",o.end));break;case"dateraw":case"betweenraw":o.start&&o.end&&(i=i.whereRaw(s+" BETWEEN ? AND ?",[o.start,o.end])),o.start&&!o.end&&(i=i.whereRaw(s+" >= ?",[o.start])),!o.start&&o.end&&(i=i.whereRaw(s+" >= ?",[o.end]));break;case"jsonb":i=i.whereRaw(s+" ILIKE ?",["%"+o.value+"%"]);break;case"full-text-psql":i=i.whereRaw("to_tsvector("+s+"::text) @@ to_tsquery(?)",[o.value]);break;case"greater":case"greaterraw":i=i.whereRaw(s+" > ?",[o.value]);break;case"greaterEq":case"greaterEqraw":i=i.whereRaw(s+" >= ?",[o.value]);break;case"less":case"lessraw":i=i.whereRaw(s+" < ?",[o.value]);break;case"lessEq":case"lessEqraw":i=i.whereRaw(s+" <= ?",[o.value]);break;case"exists":i=i.whereExists(s);break;case"notexists":i=i.whereNotExists(s);break;case"exact":case"exactraw":i=i.whereRaw(s+" = ?",[o.value]);break;case"in":var a=s;a.includes(",")&&(a=s.split(",")),Array.isArray(o.value)||null==o.value?null!=o.value&&(i=i.whereIn(a,o.value)):i=i.whereIn(a,o.value.split(","));break;case"inraw":Array.isArray(o.value)||null==o.value?null!=o.value&&(i=i.whereRaw(s+" IN (?)",[o.value.map(function(e){return"'"+e+"'"}).join(",")])):i=i.whereRaw(s+" IN (?)",[o.value.split(",").map(function(e){return"'"+e+"'"}).join(",")]);break;case"not":case"notraw":i=i.whereRaw(s+" != ?",[o.value]);break;case"like":case"likeraw":var u=fe.replaceAll(o.value,"*","%");i=i.whereRaw(" "+s+" LIKE ?",[u]);break;case"notlike":case"notlikeraw":var c=fe.replaceAll(o.value,"*","%");i=i.whereRaw(" "+s+" NOT LIKE ?",[c]);break;case"likeI":var l=fe.replaceAll(o.value,"*","%");i=i.whereRaw(" "+s+" ILIKE ?",[l]);break;case"notlikeI":var f=fe.replaceAll(o.value,"*","%");i=i.whereRaw(" "+s+" NOT ILIKE ?",[f]);break;case"null":case"nullraw":i=i.whereRaw(s+" is NULL");break;case"notnull":case"notnullraw":i=i.whereRaw(s+" is not NULL")}else i=i.where(s,o)}return i},e.parseSort=function(e){if(!e.field||!e.direction)return 1;var t="ASC";return"descend"===e.direction&&(t="DESC"),e.field+" "+t},e}(),$i=/*#__PURE__*/function(){function e(){this.tableName=""}var t=e.prototype;return t.loadAllData=function(e,t){return Pi.connection.select("*").from(this.tableName).limit(t||1e4).offset(e)},t.loadFilteredData=function(e,t,r){try{var n=this,i=1;return e.sort&&(i=Oi.parseSort(e.sort)),Promise.resolve(Pi.connection.from(n.tableName).where(function(t){return Oi.parseFilters(t,B.default.omit(e,["sort","start","limit"]),n.tableName)}).orderByRaw(i).limit(r).offset(t))}catch(e){return Promise.reject(e)}},t.countFilteredData=function(e){try{var t=this;return Promise.resolve(Pi.connection.from(t.tableName).where(function(r){return Oi.parseFilters(r,B.default.omit(e,["sort","start","limit"]),t.tableName)}).count("id",{as:"total"})).then(function(e){return e&&e[0].total})}catch(e){return Promise.reject(e)}},t.loadById=function(e){try{return Promise.resolve(Pi.connection.from(this.tableName).where("id",e)).then(function(e){return e&&e[0]?e[0]:null})}catch(e){return Promise.reject(e)}},t.save=function(e){return Pi.connection.from(this.tableName).insert(e).returning("*")},t.update=function(e,t){return Pi.connection.from(this.tableName).where("id",e).update(t).returning("*")},t.delete=function(e){try{var t=this;return Promise.resolve(t.loadById(e)).then(function(r){if(!r)throw"NotFound";return Pi.connection.from(t.tableName).where("id",e).delete()})}catch(e){return Promise.reject(e)}},e}(),Ni=/*#__PURE__*/function(e){function t(t){var r;if(!(r=e.call(this,t)||this).findByUsername)throw new Error("AuthHandler must have 'findByUsername' method");return r}return ae(t,e),t}($i);function ji(e,t){try{var r=e()}catch(e){return t(e)}return r&&r.then?r.then(void 0,t):r}var Ti=/*#__PURE__*/function(){function e(){this.router=D.default.Router(),this.routes={}}var t=e.prototype;return t.configure=function(e,t){var r=this;if(!e)return this.router;var n=fe.expressHandler();return this.router.get("/"+e,n(function(){return r.listEntidad.apply(r,[].slice.call(arguments))})),this.router.post("/"+e+"/list",n(function(){return r.listEntidad.apply(r,[].slice.call(arguments))})),this.router.get("/"+e+"/:id",n(function(){return r.getEntidad.apply(r,[].slice.call(arguments))})),this.router.post("/"+e,n(function(){return r.saveEntidad.apply(r,[].slice.call(arguments))})),this.router.put("/"+e+"/:id",n(function(){return r.updateEntidad.apply(r,[].slice.call(arguments))})),this.router.delete("/"+e+"/:id",n(function(){return r.deleteEntidad.apply(r,[].slice.call(arguments))})),this.service=t.service,this.table=t.table,this.router},t.listEntidad=function(e,t,r){try{var n=this,i=ji(function(){var r=new n.service(null,n.table),i="POST"===e.method?e.body:e.query&&e.query.filters?JSON.parse(e.query.filters):{};return Promise.resolve(r.list(i,i.start,i.limit)).then(function(e){var r=new pe(!0,e.data,null,e.total);t.json(r.toJson())})},function(e){r(e)});return Promise.resolve(i&&i.then?i.then(function(){}):void 0)}catch(e){return Promise.reject(e)}},t.getEntidad=function(e,t,r){try{var n=this,i=ji(function(){var r=new n.service(null,n.table);return Promise.resolve(r.loadById(e.params.id)).then(function(e){var r=new pe(!0,e),n=200;null==e&&(n=404,r=new pe(!1,null,"Element not found",0)),t.status(n).json(r.toJson())})},function(e){console.error(e);var r="";"22P02"==e.code&&(r="Expected uiid");var n=new pe(!1,null,r,0);t.status(400).json(n.toJson())});return Promise.resolve(i&&i.then?i.then(function(){}):void 0)}catch(e){return Promise.reject(e)}},t.saveEntidad=function(e,t,r){try{var n=this,i=ji(function(){var r=new n.service(null,n.table);return Promise.resolve(r.save(e.body)).then(function(r){var n=new pe(!0,r&&r[0]||{id:e.body.id});t.setHeader("Location","/entity/"+n.data.id),t.status(201).json(n.toJson())})},function(e){r(e)});return Promise.resolve(i&&i.then?i.then(function(){}):void 0)}catch(e){return Promise.reject(e)}},t.updateEntidad=function(e,t,r){try{var n=this,i=ji(function(){var r=new n.service(null,n.table);return Promise.resolve(r.update(e.params.id,e.body)).then(function(r){var n=new pe(!0,r&&r[0]||{id:e.body.id});t.json(n.toJson())})},function(e){r(e)});return Promise.resolve(i&&i.then?i.then(function(){}):void 0)}catch(e){return Promise.reject(e)}},t.deleteEntidad=function(e,t,r){try{var n=this,i=ji(function(){var r=new n.service(null,n.table);return Promise.resolve(r.delete(e.params.id)).then(function(e){var r=new pe(!0,e);t.status(204).json(r.toJson())})},function(e){if(console.error(e),"NotFound"==e){var n=new pe(!1,null,"Element not found",0);t.status(404).json(n.toJson())}else r(e)});return Promise.resolve(i&&i.then?i.then(function(){}):void 0)}catch(e){return Promise.reject(e)}},e}(),Li=/*#__PURE__*/function(){function e(e,t){this.dao=e?new e:new $i,t&&(this.dao.tableName=t)}var t=e.prototype;return t.list=function(e,t,r){try{var n=this,i=t||0,s=r||1e3,o={};return Promise.resolve(n.dao.countFilteredData(e,i,s)).then(function(a){var u;function c(e){return u?e:Promise.resolve(n.dao.loadAllData(t,r)).then(function(e){return o.data=e,o})}o.total=a;var l=function(){if(e&&0!==Object.keys(e).length)return Promise.resolve(n.dao.loadFilteredData(e,i,s)).then(function(e){return o.data=e,u=1,o})}();return l&&l.then?l.then(c):c(l)})}catch(e){return Promise.reject(e)}},t.loadById=function(e){return this.dao.loadById(e)},t.save=function(e){return this.dao.save(e)},t.update=function(e,t){if(e)return this.dao.update(e,t)},t.delete=function(e){if(e)return this.dao.delete(e)},e}();function xi(e,t,r){if(!e.s){if(r instanceof ki){if(!r.s)return void(r.o=xi.bind(null,e,t));1&t&&(t=r.s),r=r.v}if(r&&r.then)return void r.then(xi.bind(null,e,t),xi.bind(null,e,2));e.s=t,e.v=r;var n=e.o;n&&n(e)}}const ki=/*#__PURE__*/function(){function e(){}return e.prototype.then=function(t,r){const n=new e,i=this.s;if(i){const e=1&i?t:r;if(e){try{xi(n,1,e(this.v))}catch(e){xi(n,2,e)}return n}return this}return this.o=function(e){try{const i=e.v;1&e.s?xi(n,1,t?t(i):i):r?xi(n,1,r(i)):xi(n,2,i)}catch(e){xi(n,2,e)}},n},e}();function Di(e){return e instanceof ki&&1&e.s}var _i=new(/*#__PURE__*/function(){function e(){this.serverClass=vi,this.clusterClass=mi}var t=e.prototype;return t.runtime=function(e){return function(e){try{var t,r,n,i,s,o,a,u=se.default(T.hideBin(process.argv)).usage("Como usar: \n            node $0 [options] \n            \n            ** Si no se especifican parámetros el servidor arrancará normalmente. **").alias("g","generateKeys").describe("g","Genera unas claves para la aplicación").alias("c","encrypt").describe("c","Codifica el String proporcionado en base a la contraseña de .env").nargs("c",1).help("h").alias("h","help"),c=[];if(e)for(r=le(e);!(n=r()).done;)u.alias((i=n.value).key,i.alias),i.describe&&u.describe(i.key,i.describe),0!==i.nargs&&u.nargs(i.key,i.nargs),i.boolean&&u.boolean(i.key),i.choices&&u.choices(i.key,i.choices),i.required&&c.push(i.key);0!==c.length&&u.demandOption(c);var l=u.argv;return l.generateKeys?(console.log("Generando claves para encriptación:"),console.log(fe.generateKeys()),Promise.resolve(process.exit(1))):l.encrypt?(console.log("Resultado encryptación:"),console.log(fe.encrypt(l.encrypt)),Promise.resolve(process.exit(1))):Promise.resolve(function(){if(e)return s=le(e),function(e,t,r){for(var n;;){var i=e();if(Di(i)&&(i=i.v),!i)return s;if(i.then){n=0;break}var s=r();if(s&&s.then){if(!Di(s)){n=1;break}s=s.s}}var o=new ki,a=xi.bind(null,o,2);return(0===n?i.then(c):1===n?s.then(u):(void 0).then(function(){(i=e())?i.then?i.then(c).then(void 0,a):c(i):xi(o,1,s)})).then(void 0,a),o;function u(t){s=t;do{if(!(i=e())||Di(i)&&!i.v)return void xi(o,1,s);if(i.then)return void i.then(c).then(void 0,a);Di(s=r())&&(s=s.v)}while(!s||!s.then);s.then(u).then(void 0,a)}function c(e){e?(s=r())&&s.then?s.then(u).then(void 0,a):u(s):xi(o,1,s)}}(function(){return!t&&!(o=s()).done},0,function(){return a=o.value,function(){if(l[a.key])return Promise.resolve(a.fn(l)).then(function(){var e=process.exit(1);return t=1,e})}()})}())}catch(e){return Promise.reject(e)}}(e)},t.init=function(e){try{var t=function(){var t=new r.serverClass(e,r.statics,r.routes);return r.customizeExpress&&(t.customizeExpress=r.customizeExpress),r.beforeListen&&(t.beforeListen=r.beforeListen),r.afterListen&&(t.afterListen=r.afterListen),r.events=new yi(r),r.i18n=new he(null==e?void 0:e.disableI18nWatcher),Promise.resolve(r.i18n.load()).then(function(){r.server=new r.clusterClass(r),r.server.setServerCls(t),r.server.executeOnlyMain=function(){r.executeOnlyMain&&r.executeOnlyMain(),"true"==process.env.REPL_ENABLED&&r.startRepl()}})},r=this,n=function(){if("true"!=process.env.DISABLE_LOGGER)return Promise.resolve(wi.configure()).then(function(){})}();return Promise.resolve(n&&n.then?n.then(t):t())}catch(e){return Promise.reject(e)}},t.start=function(){try{if(!this.server)throw new Error("Call init first");return Promise.resolve(this.server.start()).then(function(){})}catch(e){return Promise.reject(e)}},t.startRepl=function(){var e=this;try{ne.default.createServer(function(t){var r=ie.default.start({prompt:"lisco::remote> ",input:t,output:t,terminal:!0,useColors:!0,preview:!1});r.context.app=e,r.context.Utils=fe,r.context.db=Pi.connection,r.on("exit",t.end.bind(t))}).listen(process.env.REPL_PORT||5001)}catch(e){console.log("Remote REPL Conn: "+e)}console.log("Remote REPL started on port "+(process.env.REPL_PORT||5001))},e}());e.App=_i,e.AuthController=Si,e.BaseController=Ti,e.BaseKnexDao=$i,e.BaseService=Li,e.ClusterServer=mi,e.CookieAuthHandler=Ai,e.EventHandler=yi,e.I18nLoader=he,e.IAuthHandler=Ri,e.IUserDao=Ni,e.JsonResponse=pe,e.JwtAuthHandler=Ii,e.KnexConnector=Pi,e.KnexFilterParser=Oi,e.Logger=wi,e.Server=vi,e.TokenGenerator=di,e.Utils=fe});
//# sourceMappingURL=lisco.umd.js.map
